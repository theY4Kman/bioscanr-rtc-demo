/*
 * Copyright Â© Acision 2014. All rights reserved.
 */

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.AcisionSDK=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c){!function(b){var d=function(){"use strict";var a={};return Object.defineProperties(a,{version:{get:function(){return"0.3.0-crocodile-3-devel"}},name:{get:function(){return"JsSIP"}}}),a}();!function(a){var b,c,d=a.name+" | EVENT EMITTER | ";b=function(){},b.prototype={initEvents:function(a){var b=a.length;for(this.events={},this.onceNotFired=[],this.maxListeners=10,this.events.newListener=function(a){console.log(d+"new listener added to event "+a)};b--;)console.log(d+"adding event "+a[b]),this.events[a[b]]=[]},checkEvent:function(a){return this.events[a]?!0:(console.error(d+"no event named "+a),!1)},addListener:function(a,b){this.checkEvent(a)&&(this.events[a].length>=this.maxListeners&&console.warn(d+"max listeners exceeded for event "+a),this.events[a].push(b),this.events.newListener.call(null,a))},on:function(a,b){this.addListener(a,b)},once:function(a,b){this.events[a].unshift(b),this.onceNotFired.push(a)},removeListener:function(a,b){if(this.checkEvent(a))for(var c=this.events[a],d=0,e=c.length;e>d;)c[d]&&c[d].toString()===b.toString()?c.splice(d,1):d++},removeAllListener:function(a){this.checkEvent(a)&&(this.events[a]=[])},setMaxListeners:function(a){Number(a)&&(this.maxListeners=a)},listeners:function(a){return this.events[a]},emit:function(b,c,e){var f,g,h=0;if(this.checkEvent(b)){console.log(d+"emitting event "+b),f=this.events[b],g=f.length;var i=new a.Event(b,c,e);if(i)for(h;g>h;h++)try{f[h].apply(null,[i])}catch(j){console.warn(d+"event handler threw exception:\n",j.stack)}else for(h;g>h;h++)try{f[h].call()}catch(j){console.warn(d+"event handler threw exception:\n",j.stack)}h=this.onceNotFired.indexOf(b),-1!==h&&(this.onceNotFired.splice(h,1),this.events[b].shift())}},newListener:function(a){this.events.newListener=a}},c=function(a,b,c){this.type=a,this.sender=b,this.data=c},a.EventEmitter=b,a.Event=c}(d),d.C={USER_AGENT:d.name+" "+d.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INVALID_REFER_TO_TARGET:"Invalid Refer-To Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout",SESSION_TIMER:"Session Timer Expired"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",SIP_EXTENSIONS:{TIMER:"timer",TARGET_DIALOG:"tdialog",GRUU:"gruu"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(a){var c;c={ConfigurationError:function(){var a=function(a,c){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=a,this.value=c,this.message=this.value?"Invalid value "+b.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return a.prototype=new Error,a}(),InvalidTargetError:function(){var a=function(a){this.code=2,this.name="INVALID_TARGET_ERROR",this.target=a,this.message="Invalid target: "+this.target};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=3,this.name="INVALID_STATE_ERROR",this.status=a};return a.prototype=new Error,a}(),RemoteSupportError:function(){var a=function(a){this.code=4,this.name="REMOTE_SUPPORT_ERROR",this.option=a,this.message="Remote UA does not support method/extension: "+a};return a.prototype=new Error,a}()},a.Exceptions=c}(d),function(a){var b,c=500,d=4e3,e=5e3;b={T1:c,T2:d,T4:e,TIMER_B:64*c,TIMER_D:0*c,TIMER_F:64*c,TIMER_H:64*c,TIMER_I:0*c,TIMER_J:0*c,TIMER_K:0*e,TIMER_L:64*c,TIMER_M:64*c},a.Timers=b}(d),function(a){var c,d=a.name+" | TRANSPORT | ",e={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};c=function(a,b){this.ua=a,this.ws=null,this.server=b,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.ua.transport=this,this.connect()},c.prototype={send:function(a){var b=a.toString();return this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ua.configuration.trace_sip===!0&&console.log(d+"sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0):(console.warn(d+"unable to send message, WebSocket is not open"),!1)},disconnect:function(){this.ws&&(this.closed=!0,console.log(d+"closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(b.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var a=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return console.log(d+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),console.log(d+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(b){console.warn(d+"error connecting to WebSocket "+this.server.ws_uri+": "+b)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(b){a.onClose(b)},this.ws.onmessage=function(b){a.onMessage(b)},this.ws.onerror=function(b){a.onError(b)}},onOpen:function(){this.connected=!0,console.log(d+"WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(b.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(a){var b=this.connected;this.connected=!1,this.lastTransportError.code=a.code,this.lastTransportError.reason=a.reason,console.log(d+"WebSocket disconnected (code: "+a.code+(a.reason?"| reason: "+a.reason:"")+")"),a.wasClean===!1&&console.warn(d+"WebSocket abrupt disconnection"),b===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reConnect()):this.ua.onTransportError(this)},onMessage:function(b){var c,e,f=b.data;if("\r\n"===f)return void(this.ua.configuration.trace_sip===!0&&console.log(d+"received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof f){try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(g){return void console.warn(d+"received WebSocket binary message failed to be converted into string, message discarded")}this.ua.configuration.trace_sip===!0&&console.log(d+"received WebSocket binary message:\n\n"+f+"\n")}else this.ua.configuration.trace_sip===!0&&console.log(d+"received WebSocket text message:\n\n"+f+"\n");if(c=a.Parser.parseMessage(f),!(this.ua.status===a.UA.C.STATUS_USER_CLOSED&&c instanceof a.IncomingRequest)&&c&&a.sanityCheck(c,this.ua,this))if(c instanceof a.IncomingRequest)c.transport=this,this.ua.receiveRequest(c);else if(c instanceof a.IncomingResponse)switch(c.method){case a.C.INVITE:e=this.ua.transactions.ict[c.via_branch],e&&e.receiveResponse(c);break;case a.C.ACK:break;default:e=this.ua.transactions.nict[c.via_branch],e&&e.receiveResponse(c)}},onError:function(a){console.warn(d+"WebSocket connection error: "+a)},reConnect:function(){var a=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(d+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(d+"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=b.setTimeout(function(){a.connect(),a.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}},c.C=e,a.Transport=c}(d),function(a){function b(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(e=a.indexOf("\r\n",c),-1===e)return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function c(b,c,d,e){var f,g,h,i=c.indexOf(":",d),j=c.substring(d,i).trim(),k=c.substring(i+1,e).trim();switch(j.toLowerCase()){case"via":case"v":b.addHeader("via",k),1===b.countHeader("via")?(h=b.parseHeader("Via"),h&&(b.via=h,b.via_branch=h.branch)):h=0;break;case"from":case"f":b.setHeader("from",k),h=b.parseHeader("from"),h&&(b.from=h,b.from_tag=h.getParam("tag"));break;case"to":case"t":b.setHeader("to",k),h=b.parseHeader("to"),h&&(b.to=h,b.to_tag=h.getParam("tag"));break;case"record-route":h=a.Grammar.parse(k,"Record_Route"),-1===h&&(h=void 0);for(g in h)f=h[g],b.addHeader("record-route",k.substring(f.possition,f.offset)),b.headers["Record-Route"][b.countHeader("record-route")-1].parsed=f.parsed;break;case"call-id":case"i":b.setHeader("call-id",k),h=b.parseHeader("call-id"),h&&(b.call_id=k);break;case"contact":case"m":h=a.Grammar.parse(k,"Contact"),-1===h&&(h=void 0);for(g in h)f=h[g],b.addHeader("contact",k.substring(f.possition,f.offset)),b.headers.Contact[b.countHeader("contact")-1].parsed=f.parsed;break;case"content-length":case"l":b.setHeader("content-length",k),h=b.parseHeader("content-length");break;case"content-type":case"c":b.setHeader("content-type",k),h=b.parseHeader("content-type");break;case"cseq":b.setHeader("cseq",k),h=b.parseHeader("cseq"),h&&(b.cseq=h.value),b instanceof a.IncomingResponse&&(b.method=h.method);break;case"max-forwards":b.setHeader("max-forwards",k),h=b.parseHeader("max-forwards");break;case"www-authenticate":b.setHeader("www-authenticate",k),h=b.parseHeader("www-authenticate");break;case"proxy-authenticate":b.setHeader("proxy-authenticate",k),h=b.parseHeader("proxy-authenticate");break;case"session-expires":case"x":b.setHeader("session-expires",k),h=b.parseHeader("session-expires");break;case"min-se":b.setHeader("min-se",k),h=b.parseHeader("min-se");break;case"supported":case"k":b.setHeader("supported",k),h=b.parseHeader("supported");break;case"require":b.setHeader("require",k),h=b.parseHeader("require");break;case"allow":b.setHeader("allow",k),h=b.parseHeader("allow");break;case"refer-to":case"r":b.setHeader("refer-to",k),h=b.parseHeader("refer-to");break;case"target-dialog":b.setHeader("target-dialog",k),h=b.parseHeader("target-dialog");break;case"event":case"o":b.setHeader("event",k),h=b.parseHeader("event");break;case"subscription-state":b.setHeader("subscription-state",k),h=b.parseHeader("subscription-state");break;default:b.setHeader(j,k),h=0}return void 0===h?!1:!0}var d,e=a.name+" | PARSER | ";d={},d.parseMessage=function(d,f){var g,h,i,j,k,l=0,m=d.indexOf("\r\n");if(-1===m)return void console.warn(e+"no CRLF found, not a SIP message, discarded");if(h=d.substring(0,m),k=a.Grammar.parse(h,"Request_Response"),-1===k)return void console.warn(e+'error parsing first line of SIP message: "'+h+'"');for(k.status_code?(g=new a.IncomingResponse,g.status_code=k.status_code,g.reason_phrase=k.reason_phrase):(g=new a.IncomingRequest,g.method=k.method,g.ruri=k.uri),g.data=d,l=m+2;l<d.length;){if(m=b(d,l),-2===m){j=l+2;break}if(-1===m){if(f)break;return void console.warn(e+"error parsing message: no empty line terminating headers")}if(k=c(g,d,l,m),!k)return void console.warn(e+'error parsing header: "'+d.substring(l,m)+'"');l=m+2}return j&&(g.hasHeader("content-length")?(i=g.getHeader("content-length"),g.body=d.substr(j,i)):g.body=d.substring(j)),g},a.Parser=d}(d),function(a){var b,c,d,e,f=a.name+" | SIP MESSAGE | ";b=function(b,c,d,e,f,g){var h,i,j,k,l;return e=e||{},b&&c&&d?(this.headers={},this.method=b,this.ruri=c,this.body=g,this.extraHeaders=f||[],e.route_set?this.setHeader("route",e.route_set):d.configuration.use_preloaded_route&&this.setHeader("route",d.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",a.UA.C.MAX_FORWARDS),h=e.to_display_name||0===e.to_display_name?'"'+e.to_display_name+'" ':"",h+="<"+(e.to_uri||c)+">",h+=e.to_tag?";tag="+e.to_tag:"",this.to=new a.NameAddrHeader.parse(h),this.setHeader("to",h),i=e.from_display_name||0===e.from_display_name?'"'+e.from_display_name+'" ':d.configuration.display_name?'"'+d.configuration.display_name+'" ':"",i+="<"+(e.from_uri||d.configuration.uri)+">;tag=",i+=e.from_tag||a.Utils.newTag(),this.from=new a.NameAddrHeader.parse(i),this.setHeader("from",i),j=e.call_id||d.configuration.jssip_id+a.Utils.createRandomToken(15),this.call_id=j,this.setHeader("call-id",j),k=e.cseq||Math.floor(1e4*Math.random()),this.cseq=k,this.setHeader("cseq",k+" "+b),b!==a.C.CANCEL&&b!==a.C.ACK&&this.setHeader("allow",a.Utils.getAllowedMethods(d)),void(b!==a.C.ACK&&(l=a.Utils.getSupportedExtensions(d,e.extra_supported),this.setHeader("supported",l.join(","))))):null},b.prototype={setHeader:function(b,c){this.headers[a.Utils.headerize(b)]=c instanceof Array?c:[c]},toString:function(){var b,c,d,e="";e+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(b in this.headers)for(d in this.headers[b])e+=b+": "+this.headers[b][d]+"\r\n";for(c=this.extraHeaders.length,d=0;c>d;d++)e+=this.extraHeaders[d]+"\r\n";return e+="User-Agent: "+a.C.USER_AGENT+"\r\n",this.body?(c=a.Utils.str_utf8_length(this.body),e+="Content-Length: "+c+"\r\n\r\n",e+=this.body):e+="Content-Length: 0\r\n\r\n",e}},c=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},c.prototype={addHeader:function(b,c){var d={raw:c};b=a.Utils.headerize(b),this.headers[b]?this.headers[b].push(d):this.headers[b]=[d]},countHeader:function(b){var c=this.headers[a.Utils.headerize(b)];return c?c.length:0},getHeader:function(b,c){var d=this.headers[a.Utils.headerize(b)];return c=c||0,d&&d[c]?d[c].raw:void 0},getHeaderAll:function(b){var c,d=this.headers[a.Utils.headerize(b)],e=[];if(!d)return[];for(c in d)e.push(d[c].raw);return e},hasHeader:function(b){return this.headers[a.Utils.headerize(b)]?!0:!1},parseHeader:function(b,c){var d,e,g;return b=a.Utils.headerize(b),c=c||0,this.headers[b]?c>=this.headers[b].length?void console.log(f+'not so many "'+b+'" headers present'):(d=this.headers[b][c],e=d.raw,d.parsed?d.parsed:(g=a.Grammar.parse(e,b.replace(/-/g,"_")),-1===g?(this.headers[b].splice(c,1),void console.warn(f+'error parsing "'+b+'" header field with value "'+e+'"')):(d.parsed=g,g))):void console.log(f+'header "'+b+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(b,c){var d={raw:c};this.headers[a.Utils.headerize(b)]=[d]},toString:function(){return this.data}},d=function(){this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},d.prototype=new c,d.prototype.reply=function(b,c,d,e,f,g){var h,i,j,k,l,m=this.getHeader("To"),n=0,o=0;if(b=b||null,c=c||null,!b||100>b||b>699)throw new TypeError("Invalid status_code: "+b);if(c&&"string"!=typeof c&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: "+c);switch(c=c||a.C.REASON_PHRASE[b]||"",d=d||[],l="SIP/2.0 "+b+" "+c+"\r\n",this.method){case a.C.INVITE:case a.C.REFER:case a.C.SUBSCRIBE:case a.C.NOTIFY:if(b>100&&200>=b)for(h=this.countHeader("record-route"),n;h>n;n++)l+="Record-Route: "+this.getHeader("record-route",n)+"\r\n"}for(i=this.countHeader("via"),o;i>o;o++)l+="Via: "+this.getHeader("via",o)+"\r\n";for(this.to_tag&&!this.s("to").hasParam("tag")&&(m+=";tag="+this.to_tag),l+="To: "+m+"\r\n",l+="From: "+this.getHeader("From")+"\r\n",l+="Call-ID: "+this.call_id+"\r\n",l+="CSeq: "+this.cseq+" "+this.method+"\r\n",j=d.length,k=0;j>k;k++)l+=d[k]+"\r\n";l+="User-Agent: "+a.C.USER_AGENT+"\r\n",e?(j=a.Utils.str_utf8_length(e),l+="Content-Type: application/sdp\r\n",l+="Content-Length: "+j+"\r\n\r\n",l+=e):l+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(b,l,f,g)},d.prototype.reply_sl=function(b,c){var d,e,f=this.countHeader("via");if(b=b||null,c=c||null,!b||100>b||b>699)throw new TypeError("Invalid status_code: "+b);if(c&&"string"!=typeof c&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: "+c);c=c||a.C.REASON_PHRASE[b]||"",e="SIP/2.0 "+b+" "+c+"\r\n";for(var g=0;f>g;g++)e+="Via: "+this.getHeader("via",g)+"\r\n";d=this.getHeader("To"),this.to_tag&&!this.s("to").hasParam("tag")&&(d+=";tag="+this.to_tag),e+="To: "+d+"\r\n",e+="From: "+this.getHeader("From")+"\r\n",e+="Call-ID: "+this.call_id+"\r\n",e+="CSeq: "+this.cseq+" "+this.method+"\r\n",e+="User-Agent: "+a.C.USER_AGENT+"\r\n",e+="Content-Length: 0\r\n\r\n",this.transport.send(e)},e=function(){this.headers={},this.status_code=null,this.reason_phrase=null},e.prototype=new c,a.OutgoingRequest=b,a.IncomingRequest=d,a.IncomingResponse=e}(d),function(a){var c;c=function(b,c,d,e,f,g){var h,i;if(!d)throw new TypeError('missing or invalid "host" parameter');b=b||a.C.SIP,this.parameters={},this.headers={};for(h in f)this.setParam(h,f[h]);for(i in g)this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return b},set:function(a){b=a.toLowerCase()}},user:{get:function(){return c},set:function(a){c=a}},host:{get:function(){return d},set:function(a){d=a.toLowerCase()}},port:{get:function(){return e},set:function(a){e=0===a?a:parseInt(a,10)||null}}})},c.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString().toLowerCase())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={}},setHeader:function(b,c){this.headers[a.Utils.headerize(b)]=c instanceof Array?c:[c]},getHeader:function(b){return b?this.headers[a.Utils.headerize(b)]:void 0},hasHeader:function(b){return b?this.headers.hasOwnProperty(a.Utils.headerize(b))&&!0||!1:void 0},deleteHeader:function(b){var c;return b=a.Utils.headerize(b),this.headers.hasOwnProperty(b)?(c=this.headers[b],delete this.headers[b],c):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new c(this.scheme,this.user,this.host,this.port,b.JSON.parse(b.JSON.stringify(this.parameters)),b.JSON.parse(b.JSON.stringify(this.headers)))},toString:function(){var b,c,d,e,f=[];e=this.scheme+":",this.user&&(e+=a.Utils.escapeUser(this.user)+"@"),e+=this.host,(this.port||0===this.port)&&(e+=":"+this.port);for(c in this.parameters)e+=";"+c,null!==this.parameters[c]&&(e+="="+this.parameters[c]);for(b in this.headers)for(d in this.headers[b])f.push(b+"="+this.headers[b][d]);return f.length>0&&(e+="?"+f.join("&")),e},toAor:function(b){var c;return c=this.scheme+":",this.user&&(c+=a.Utils.escapeUser(this.user)+"@"),c+=this.host,b&&(this.port||0===this.port)&&(c+=":"+this.port),c}},c.parse=function(b){return b=a.Grammar.parse(b,"SIP_URI"),-1!==b?b:void 0},a.URI=c}(d),function(a){var c;c=function(b,c,d){var e;if(!(b&&b instanceof a.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=b,this.parameters={};for(e in d)this.setParam(e,d[e]);Object.defineProperties(this,{display_name:{get:function(){return c},set:function(a){c=0===a?"0":a}}})},c.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={}},clone:function(){return new c(this.uri.clone(),this.display_name,b.JSON.parse(b.JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]);return a}},c.parse=function(b){return b=a.Grammar.parse(b,"Name_Addr_Header"),-1!==b?b:void 0},a.NameAddrHeader=c}(d),function(a){var c,d=a.name+" | TRANSACTION | ",e={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};c={};var f=function(){this.init=function(a,b,c){var d;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+(a.ua.configuration.hack_via_tcp?"TCP":c.server.scheme),d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d)}},g=function(){this.send=function(){var c=this;this.state=e.STATUS_TRYING,this.F=b.setTimeout(function(){c.timer_F()},a.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){switch(console.log(d+"transport error occurred, deleting non-INVITE client transaction "+this.id),b.clearTimeout(this.F),b.clearTimeout(this.K),delete this.request_sender.ua.transactions.nict[this.id],this.state){case e.STATUS_COMPLETED:case e.STATUS_TERMINATED:return}this.request_sender.onTransportError()},this.timer_F=function(){console.log(d+"Timer F expired for non-INVITE client transaction "+this.id),this.state=e.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.nict[this.id]},this.timer_K=function(){this.state=e.STATUS_TERMINATED,delete this.request_sender.ua.transactions.nict[this.id]},this.receiveResponse=function(c){var d=this,f=c.status_code;if(200>f)switch(this.state){case e.STATUS_TRYING:case e.STATUS_PROCEEDING:this.state=e.STATUS_PROCEEDING,this.request_sender.receiveResponse(c)}else switch(this.state){case e.STATUS_TRYING:case e.STATUS_PROCEEDING:this.state=e.STATUS_COMPLETED,b.clearTimeout(this.F),408===f?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(c),this.K=b.setTimeout(function(){d.timer_K()},a.Timers.TIMER_K);break;case e.STATUS_COMPLETED:}}};g.prototype=new f;var h=function(){this.send=function(){var c=this;this.state=e.STATUS_CALLING,this.B=b.setTimeout(function(){c.timer_B()},a.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){switch(console.log(d+"transport error occurred, deleting INVITE client transaction "+this.id),b.clearTimeout(this.B),b.clearTimeout(this.D),b.clearTimeout(this.M),delete this.request_sender.ua.transactions.ict[this.id],this.state){case e.STATUS_ACCEPTED:case e.STATUS_COMPLETED:case e.STATUS_TERMINATED:return}this.request_sender.onTransportError()},this.timer_M=function(){console.log(d+"Timer M expired for INVITE client transaction "+this.id),this.state===e.STATUS_ACCEPTED&&(this.state=e.STATUS_TERMINATED,b.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_B=function(){console.log(d+"Timer B expired for INVITE client transaction "+this.id),this.state===e.STATUS_CALLING&&(this.state=e.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_D=function(){console.log(d+"Timer D expired for INVITE client transaction "+this.id),this.state=e.STATUS_TERMINATED,b.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id]},this.sendACK=function(c){var d=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+c.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=b.setTimeout(function(){d.timer_D()},a.Timers.TIMER_D),this.transport.send(this.ack)},this.cancel_request=function(b,c){var d=b.request;this.cancel=a.C.CANCEL+" "+d.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+d.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+d.headers.Route.toString()+"\r\n"),this.cancel+="To: "+d.headers.To.toString()+"\r\n",this.cancel+="From: "+d.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+d.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+d.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",c&&(this.cancel+="Reason: "+c+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===e.STATUS_PROCEEDING&&this.transport.send(this.cancel)},this.receiveResponse=function(c){var d=this,f=c.status_code;if(f>=100&&199>=f)switch(this.state){case e.STATUS_CALLING:this.state=e.STATUS_PROCEEDING,this.request_sender.receiveResponse(c),this.cancel&&this.transport.send(this.cancel);break;case e.STATUS_PROCEEDING:this.request_sender.receiveResponse(c)}else if(f>=200&&299>=f)switch(this.state){case e.STATUS_CALLING:case e.STATUS_PROCEEDING:this.state=e.STATUS_ACCEPTED,this.M=b.setTimeout(function(){d.timer_M()},a.Timers.TIMER_M),this.request_sender.receiveResponse(c);break;case e.STATUS_ACCEPTED:this.request_sender.receiveResponse(c)}else if(f>=300&&699>=f)switch(this.state){case e.STATUS_CALLING:case e.STATUS_PROCEEDING:this.state=e.STATUS_COMPLETED,this.sendACK(c),this.request_sender.receiveResponse(c);break;case e.STATUS_COMPLETED:this.sendACK(c)}}};h.prototype=new f;var i=function(){this.init=function(a,b){this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this}},j=function(){this.timer_J=function(){console.log(d+"Timer J expired for non-INVITE server transaction "+this.id),this.state=e.STATUS_TERMINATED,delete this.ua.transactions.nist[this.id]},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(d+"transport error occurred, deleting non-INVITE server transaction "+this.id),b.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])},this.receiveResponse=function(c,d,f,g){var h=this;if(100===c)switch(this.state){case e.STATUS_TRYING:this.state=e.STATUS_PROCEEDING,this.transport.send(d)||this.onTransportError();break;case e.STATUS_PROCEEDING:this.last_response=d,this.transport.send(d)?f&&f():(this.onTransportError(),g&&g())}else if(c>=200&&699>=c)switch(this.state){case e.STATUS_TRYING:case e.STATUS_PROCEEDING:this.state=e.STATUS_COMPLETED,this.last_response=d,this.J=b.setTimeout(function(){h.timer_J()},a.Timers.TIMER_J),this.transport.send(d)?f&&f():(this.onTransportError(),g&&g());break;case e.STATUS_COMPLETED:}}};j.prototype=new i;var k=function(){this.timer_H=function(){console.log(d+"Timer H expired for INVITE server transaction "+this.id),this.state===e.STATUS_COMPLETED&&(console.warn(d+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=e.STATUS_TERMINATED),delete this.ua.transactions.ist[this.id]},this.timer_I=function(){this.state=e.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id]},this.timer_L=function(){console.log(d+"Timer L expired for INVITE server transaction "+this.id),this.state===e.STATUS_ACCEPTED&&(this.state=e.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(d+"transport error occurred, deleting INVITE server transaction "+this.id),b.clearInterval(this.resendProvisionalTimer),b.clearTimeout(this.L),b.clearTimeout(this.H),b.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])},this.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},this.receiveResponse=function(c,d,f,g){var h=this;if(c>=100&&199>=c)switch(this.state){case e.STATUS_PROCEEDING:this.transport.send(d)||this.onTransportError(),this.last_response=d}if(c>100&&199>=c)this.resendProvisionalTimer||(this.resendProvisionalTimer=b.setInterval(function(){h.resend_provisional()},60*a.Timers.T1));else if(c>=200&&299>=c)switch(this.state){case e.STATUS_PROCEEDING:this.state=e.STATUS_ACCEPTED,this.last_response=d,this.L=b.setTimeout(function(){h.timer_L()},a.Timers.TIMER_L),b.clearInterval(this.resendProvisionalTimer);case e.STATUS_ACCEPTED:this.transport.send(d)?f&&f():(this.onTransportError(),g&&g())}else if(c>=300&&699>=c)switch(this.state){case e.STATUS_PROCEEDING:b.clearInterval(this.resendProvisionalTimer),this.transport.send(d)?(this.state=e.STATUS_COMPLETED,this.H=b.setTimeout(function(){h.timer_H()},a.Timers.TIMER_H),f&&f()):(this.onTransportError(),g&&g())}}};k.prototype=new i,c.NonInviteClientTransaction=function(a,b,c){this.init(a,b,c),this.request_sender.ua.transactions.nict[this.id]=this},c.NonInviteClientTransaction.prototype=new g,c.InviteClientTransaction=function(a,b,c){var d=this;this.init(a,b,c),this.request_sender.ua.transactions.ict[this.id]=this,this.request.cancel=function(a){d.cancel_request(d,a)}},c.InviteClientTransaction.prototype=new h,c.AckClientTransaction=function(a,b,c){this.init(a,b,c),this.send=function(){this.transport.send(b)}},c.AckClientTransaction.prototype=new g,
c.NonInviteServerTransaction=function(a,b){this.init(a,b),this.state=e.STATUS_TRYING,b.transactions.nist[this.id]=this},c.NonInviteServerTransaction.prototype=new j,c.InviteServerTransaction=function(a,b){this.init(a,b),this.state=e.STATUS_PROCEEDING,b.transactions.ist[this.id]=this,this.resendProvisionalTimer=null,a.reply(100)},c.InviteServerTransaction.prototype=new k,c.checkTransaction=function(c,d){var f;switch(d.method){case a.C.INVITE:if(f=c.transactions.ist[d.via_branch]){switch(f.state){case e.STATUS_PROCEEDING:f.transport.send(f.last_response);break;case e.STATUS_ACCEPTED:}return!0}break;case a.C.ACK:if(f=c.transactions.ist[d.via_branch],!f)return!1;if(f.state===e.STATUS_ACCEPTED)return!1;if(f.state===e.STATUS_COMPLETED)return f.state=e.STATUS_CONFIRMED,f.I=b.setTimeout(function(){f.timer_I()},a.Timers.TIMER_I),!0;break;case a.C.CANCEL:return f=c.transactions.ist[d.via_branch],f&&f.state===e.STATUS_PROCEEDING?!1:(d.reply_sl(481),!0);default:if(f=c.transactions.nist[d.via_branch]){switch(f.state){case e.STATUS_TRYING:break;case e.STATUS_PROCEEDING:case e.STATUS_COMPLETED:f.transport.send(f.last_response)}return!0}}},c.C=e,a.Transactions=c}(d),function(a){var c,d,e=a.name+" | DIALOG | ",f={STATUS_EARLY:1,STATUS_CONFIRMED:2,DEFAULT_MIN_SE:90};c=function(a,b,c){this.call_id=a,this.local_tag=b,this.remote_tag=c},c.prototype.toString=function(){return this.call_id+this.local_tag+this.remote_tag},c.prototype.toTargetDialogHeader=function(){return this.call_id+";remote-tag="+this.local_tag+";local-tag="+this.remote_tag},d=function(b,d,g,h){var i;return d.hasHeader("contact")?(d instanceof a.IncomingResponse?h=d.status_code<200?f.STATUS_EARLY:f.STATUS_CONFIRMED:(h=h||f.STATUS_CONFIRMED,d.method===a.C.INVITE&&(this.last_invite_tx=d.server_transaction)),i=d.parseHeader("contact"),"UAS"===g?(this.id=new c(d.call_id,d.to_tag,d.from_tag),this.state=h,this.remote_seqnum=d.cseq,this.local_uri=d.parseHeader("to").uri,this.remote_uri=d.parseHeader("from").uri,this.remote_target=i.uri,this.route_set=d.getHeaderAll("record-route")):"UAC"===g&&(this.id=new c(d.call_id,d.from_tag,d.to_tag),this.state=h,this.local_seqnum=d.cseq,this.local_uri=d.parseHeader("from").uri,this.remote_uri=d.parseHeader("to").uri,this.remote_target=i.uri,this.route_set=d.getHeaderAll("record-route").reverse()),this.session_timer={localRefresher:!0,interval:null,min_interval:f.DEFAULT_MIN_SE,timer_id:null},this.owner=b,b.ua.dialogs[this.id.toString()]=this,void console.log(e+"new "+g+" dialog created with status "+(this.state===f.STATUS_EARLY?"EARLY":"CONFIRMED"))):(console.error(e+"unable to create a Dialog without Contact header field"),!1)},d.prototype={update:function(a,b){this.state=f.STATUS_CONFIRMED,console.log(e+"dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaderAll("record-route").reverse())},isConfirmed:function(){return this.state===f.STATUS_CONFIRMED},terminate:function(){console.log(e+"dialog "+this.id.toString()+" deleted"),this.clearSessionRefreshTimer(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(b,c){var d,e,g=null;if(c=c||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),d=b===a.C.CANCEL||b===a.C.ACK?this.local_seqnum:this.local_seqnum+=1,b===a.C.INVITE||b===a.C.UPDATE){var h=this.session_timer.min_interval,i=this.session_timer.interval;if(h>f.DEFAULT_MIN_SE&&c.push("Min-SE: "+h),null!==i){var j=h>i?h:i,k=this.session_timer.localRefresher?"uac":"uas";c.push("Session-Expires: "+j+";refresher="+k)}}return this.owner instanceof a.RTCSession&&(g=a.Utils.getSessionExtensions(this.owner,b)),e=new a.OutgoingRequest(b,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set,extra_supported:g},c),e.dialog=this,e},checkInDialogRequest:function(b){var c;if(this.remote_seqnum){if(b.cseq<this.remote_seqnum)return b.method!==a.C.ACK&&b.reply(500),!1;b.cseq>this.remote_seqnum&&(this.remote_seqnum=b.cseq)}else this.remote_seqnum=b.cseq;switch(b.method){case a.C.INVITE:if(this.last_invite_tx&&this.last_invite_tx.state===a.Transactions.C.STATUS_PROCEEDING)return c=(10*Math.random()|0)+1,b.reply(500,null,["Retry-After:"+c]),!1;this.last_invite_tx=b.server_transaction;break;case a.C.UPDATE:if(this.last_update_tx)switch(this.last_update_tx.state){case a.Transactions.C.STATUS_TRYING:case a.Transactions.C.STATUS_PROCEEDING:return c=(10*Math.random()|0)+1,b.reply(500,null,["Retry-After:"+c]),!1}this.last_update_tx=b.server_transaction}return!0},receiveRequest:function(b){if(this.checkInDialogRequest(b)&&this.owner.receiveRequest(b))switch(b.method){case a.C.INVITE:case a.C.UPDATE:case a.C.NOTIFY:b.hasHeader("contact")&&(this.remote_target=b.parseHeader("contact").uri)}},updateMinSessionExpires:function(a){a>this.session_timer.min_interval&&(this.session_timer.min_interval=a)},setSessionRefreshTimer:function(){var c,d,e=this.session_timer.localRefresher,f=this.session_timer.interval,g=this;e?(c=f/2,d=function(){g.session_timer.timer_id=null,g.owner.emit("refresh",g.owner,{})}):(c=f-Math.max(f/3,32),d=function(){g.session_timer.timer_id=null,g.owner.sendBye({status_code:408,reason_phrase:a.C.causes.SESSION_TIMER}),g.owner.ended("system",null,a.C.causes.SESSION_TIMER)}),this.session_timer.timer_id=b.setTimeout(d,1e3*c)},clearSessionRefreshTimer:function(){null!==this.session_timer.timer_id&&(b.clearTimeout(this.session_timer.timer_id),this.session_timer.timer_id=null)},disableSessionRefresh:function(){this.session_timer.interval=null,this.clearSessionRefreshTimer()},processSessionTimerHeaders:function(b){if(b.hasHeader("min-se")&&this.updateMinSessionExpires(b.parseHeader("min-se")),!b.hasHeader("session-expires"))return void this.disableSessionRefresh();this.clearSessionRefreshTimer();var c=b.parseHeader("session-expires"),d=!0;if(b instanceof a.IncomingRequest)c.params&&c.params.refresher&&(d="uas"===c.params.refresher);else{if(!(b instanceof a.IncomingResponse))throw new TypeError("Unexpected message type");d="uac"===c.params.refresher}this.session_timer.interval=c.interval,this.session_timer.localRefresher=d,this.setSessionRefreshTimer()},addSessionTimerResponseHeaders:function(a){var b=this.session_timer.interval;if(b){var c=this.session_timer.localRefresher?"uas":"uac";a.push("Session-Expires: "+b+";refresher="+c)}}},d.C=f,a.DialogId=c,a.Dialog=d}(d),function(a){var b,c=a.name+" | REQUEST SENDER | ";b=function(b,c){this.ua=c,this.applicant=b,this.method=b.request.method,this.request=b.request,this.credentials=null,this.challenged=!1,this.staled=!1,c.status!==a.UA.C.STATUS_USER_CLOSED||this.method===a.C.BYE&&this.method===a.C.ACK||this.onTransportError()},b.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new a.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new a.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new a.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(b){var d,e,f,g=b.status_code;if(401!==g&&407!==g||null===this.ua.configuration.password)this.applicant.receiveResponse(b);else{if(401===b.status_code?(e=b.parseHeader("www-authenticate"),f="authorization"):(e=b.parseHeader("proxy-authenticate"),f="proxy-authorization"),!e)return console.warn(c+b.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(b);if(!this.challenged||!this.staled&&e.stale===!0){if(this.credentials||(this.credentials=new a.DigestAuthentication(this.ua)),!this.credentials.authenticate(this.request,e))return void this.applicant.receiveResponse(b);this.challenged=!0,e.stale&&(this.staled=!0),b.method===a.C.REGISTER?d=this.applicant.cseq+=1:this.request.dialog?d=this.request.dialog.local_seqnum+=1:(d=this.request.cseq+1,this.request.cseq=d),this.request.setHeader("cseq",d+" "+this.method),this.request.setHeader(f,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(b)}}},a.RequestSender=b}(d),function(a){var b;b=function(a){this.applicant=a,this.request=a.request},b.prototype={send:function(){var b=new a.RequestSender(this,this.applicant.session.ua);b.send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout(),this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError(),this.applicant.onTransportError()},receiveResponse:function(b){(408===b.status_code||481===b.status_code)&&(this.request.method!==a.C.BYE&&this.applicant.session.sendBye({status_code:b.status_code,reason_phrase:b.reason_phrase}),this.applicant.session.ended("remote",b,a.C.causes.DIALOG_ERROR)),this.applicant.receiveResponse(b)}},a.InDialogRequestSender=b}(d),function(a){var c,d=a.name+" | REGISTRATOR | ";c=function(b,c){var d=1;this.ua=b,this.transport=c,this.registrar=b.configuration.registrar_server,this.expires=b.configuration.register_expires,this.call_id=a.Utils.createRandomToken(22),this.cseq=80,this.to_uri=b.configuration.uri,this.registrationTimer=null,this.registered=this.registered_before=!1,this.ua.registrator=this,this.contact=this.ua.contact.toString(),d&&(this.contact+=";reg-id="+d,this.contact+=';+sip.instance="<urn:'+this.ua.configuration.instance_id+'>"')},c.prototype={register:function(c){var e,f,g,h=this;c=c||{},g=c.extraHeaders||[],g.push("Contact: "+this.contact+";expires="+this.expires),this.request=new a.OutgoingRequest(a.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},g),e=new a.RequestSender(this,this.ua),this.receiveResponse=function(c){var e,g,i=c.countHeader("contact");if(c.cseq===this.cseq)switch(!0){case/^1[0-9]{2}$/.test(c.status_code):break;case/^2[0-9]{2}$/.test(c.status_code):if(c.hasHeader("expires")&&(g=c.getHeader("expires")),!i){console.warn(d+"no Contact header in response to REGISTER, response ignored");break}for(;i--;){if(e=c.parseHeader("contact",i),e.uri.user===this.ua.contact.uri.user){g=e.getParam("expires");break}e=null}if(!e){console.warn(d+"no Contact header pointing to us, response ignored");break}g||(g=this.expires),this.registrationTimer=b.setTimeout(function(){h.register()},1e3*g-3e3),e.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.getParam("temp-gruu").replace(/"/g,"")),e.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.getParam("pub-gruu").replace(/"/g,"")),this.registered=!0,this.ua.emit("registered",this.ua,{response:c});break;case/^423$/.test(c.status_code):c.hasHeader("min-expires")?(this.expires=c.getHeader("min-expires"),this.registrationTimer=b.setTimeout(function(){h.register()},0)):(console.warn(d+"423 response received for REGISTER without Min-Expires"),this.registrationFailure(c,a.C.causes.SIP_FAILURE_CODE));break;default:f=a.Utils.sipErrorCause(c.status_code),this.registrationFailure(c,f)}},this.onRequestTimeout=function(){this.registrationFailure(null,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,a.C.causes.CONNECTION_ERROR)},e.send()},unregister:function(c){var e;if(!this.registered)return void console.warn(d+"already unregistered");c=c||{},e=c.extraHeaders||[],this.registered=!1,b.clearTimeout(this.registrationTimer),c.all?(e.push("Contact: *"),e.push("Expires: 0"),this.request=new a.OutgoingRequest(a.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},e)):(e.push("Contact: "+this.contact+";expires=0"),this.request=new a.OutgoingRequest(a.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},e));var f=new a.RequestSender(this,this.ua);this.receiveResponse=function(b){var c;switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):this.unregistered(b);break;default:c=a.Utils.sipErrorCause(b.status_code),this.unregistered(b,c)}},this.onRequestTimeout=function(){this.unregistered(null,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,a.C.causes.CONNECTION_ERROR)},f.send()},registrationFailure:function(a,b){this.ua.emit("registrationFailed",this.ua,{response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b}))},unregistered:function(a,b){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b||null})},onTransportClosed:function(){this.registered_before=this.registered,b.clearTimeout(this.registrationTimer),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered,this.unregister()}},a.Registrator=c}(d),function(a){var c,d=function(a){var c=function(b,c){this.applicant=b,this.request=c||b.request,this.session=b instanceof a.RTCSession?b:b.session,this.reattempt=!1,this.reatemptTimer=null,this.request_sender=new a.InDialogRequestSender(this)};return c.prototype={receiveResponse:function(c){var d=this,e=c.status_code;c.method===a.C.INVITE&&491===e?this.reattempt?this.applicant.receiveResponse(c):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=b.setTimeout(function(){d.session.status!==a.RTCSession.C.STATUS_TERMINATED&&(d.reattempt=!0,d.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(c)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}},c}(a),e=function(a){var b=function(a,b){b=b||{},this.session=a,this.localMedia=null,this.peerConnection=null,this.init(b)};return b.prototype={createOffer:function(a,b){var c=this,d=!1;this.onIceCompleted=function(){d||(d=!0,a(c.peerConnection.localDescription.sdp))},this.peerConnection.createOffer(function(a){c.setLocalDescription(a,b)},function(a){console.error(j+"unable to create offer"),console.error(a),b()})},createAnswer:function(a,b){var c=this,d=!1;this.onIceCompleted=function(){d||(d=!0,a(c.peerConnection.localDescription.sdp))},this.peerConnection.createAnswer(function(a){c.setLocalDescription(a,b)},function(a){console.error(j+"unable to create answer"),console.error(a),b()})},setLocalDescription:function(a,b){this.peerConnection.setLocalDescription(a,null,function(a){console.error(j+"unable to set local description"),console.error(a),b()})},addStream:function(a,b,c,d){try{this.peerConnection.addStream(a,d)}catch(e){return console.error(j+"error adding stream"),console.error(e),void c()}b()},init:function(b){var c,d,e,f,g=this,h=[];for(c in this.session.ua.configuration.stun_servers)d=this.session.ua.configuration.stun_servers[c],h.push({url:d});for(c in this.session.ua.configuration.turn_servers)d=this.session.ua.configuration.turn_servers[c],f=d.server,e=f.substr(0,f.indexOf(":")),h.push({url:e+":"+d.username+"@"+f.substr(e.length+1),credential:d.password});this.peerConnection=new a.WebRTC.RTCPeerConnection({iceServers:h},b),this.peerConnection.onaddstream=function(a){console.log(j+"stream added: "+a.stream.id)},this.peerConnection.onremovestream=function(a){console.log(j+"stream removed: "+a.stream.id)},this.peerConnection.onicecandidate=function(a){a.candidate?console.log(j+"ICE candidate received: "+a.candidate.candidate):g.onIceCompleted()},this.peerConnection.ongatheringchange=function(a){"complete"===a.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState&&g.onIceCompleted()},this.peerConnection.onicechange=function(){console.log(j+'ICE connection state changed to "'+this.iceConnectionState+'"')},this.peerConnection.onstatechange=function(){console.log(j+'PeerConnection state changed to "'+this.readyState+'"')}},close:function(){console.log(j+"closing PeerConnection"),this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.stop())},getUserMedia:function(b,c,d){var e=this;console.log(j+"requesting access to local media"),a.WebRTC.getUserMedia(d,function(a){console.log(j+"got local media stream"),e.localMedia=a,b(a)},function(a){console.error(j+"unable to get user media"),console.error(a),c()})},onMessage:function(b,c,d,e){this.peerConnection.setRemoteDescription(new a.WebRTC.RTCSessionDescription({type:b,sdp:c}),d,e)}},b}(a),f=function(a){var b,c={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return b=function(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.tone=null,this.duration=null,this.initEvents(b)},b.prototype=new a.EventEmitter,b.prototype.send=function(b,c){var e,f,g,h;if(void 0===b)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==a.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==a.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.session.status);if(c=c||{},h=c.extraHeaders?c.extraHeaders.slice():[],g=c.eventHandlers||{},"string"==typeof b)b=b.toUpperCase();else{if("number"!=typeof b)throw new TypeError("Invalid tone: "+b);b=b.toString()}if(!b.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+b);this.tone=b,this.duration=c.duration;for(f in g)this.on(f,g[f]);h.push("Content-Type: application/dtmf-relay"),this.request=this.session.dialog.createRequest(a.C.INFO,h),this.request.body="Signal= "+this.tone+"\r\n",this.request.body+="Duration= "+this.duration,e=new d(this),this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request}),e.send()},b.prototype.receiveResponse=function(b){var c;switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):this.emit("succeeded",this,{originator:"remote",response:b});break;default:c=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",response:b,cause:c})}},b.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})},b.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})},b.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\r\n"),2===b.length&&(c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10)))),this.tone&&this.duration?this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:a}):console.warn(j+"invalid INFO DTMF received, discarded")},b.C=c,b}(a),g=function(a){var c,e=a.name+" | REINVITE | ";return c=function(b){var c=["succeeded","failed","completed"];this.session=b,this.direction=null,this.status=a.RTCSession.C.STATUS_NULL,this.timers={},this.initEvents(c)},c.prototype=new a.EventEmitter,c.prototype.send=function(b,c){var e,f,g,h;if(void 0===b)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==a.RTCSession.C.STATUS_CONFIRMED)throw new a.Exceptions.InvalidStateError(this.session.status);c=c||{},h=c.extraHeaders?c.extraHeaders.slice():[],g=c.eventHandlers||{};for(f in g)this.on(f,g[f]);h.push("Contact: "+this.session.contact),b&&h.push("Content-Type: application/sdp"),this.request=this.session.dialog.createRequest(a.C.INVITE,h),this.request.body=b,e=new d(this),this.session.emit("reinvite",this.session,{originator:"local",reinvite:this,request:this.request}),e.send(),this.status=a.RTCSession.C.STATUS_INVITE_SENT},c.prototype.receiveResponse=function(b){var c,d=b.status_code;switch(this.status){case a.RTCSession.C.STATUS_CONFIRMED:case a.RTCSession.C.STATUS_CANCELED:return void(this.session.status===a.RTCSession.C.STATUS_CONFIRMED&&(console.info(e+"Retransmitting ACK"),this.session.sendACK()))}return d>=100&&200>d?void(this.status=a.RTCSession.C.STATUS_1XX_RECEIVED):(d>=200&&300>d?(this.status=a.RTCSession.C.STATUS_CONFIRMED,this.session.status===a.RTCSession.C.STATUS_CONFIRMED&&(this.session.sendACK(),console.log(e+"re-INVITE ACK sent",Date.now()),this.session.dialog.processSessionTimerHeaders(b),this.emit("succeeded",this,{originator:"remote",response:b,sdp:b.body}))):(this.status=a.RTCSession.C.STATUS_CANCELED,c=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",response:b,cause:c})),void this.emit("completed",this,{originator:"local"}))},c.prototype.receiveAck=function(){this.status=a.RTCSession.C.STATUS_CONFIRMED,console.log(e+"re-INVITE ACK received",Date.now()),this.timers.invite2xxTimer&&(b.clearTimeout(this.timers.invite2xxTimer),delete this.timers.invite2xxTimer),this.timers.ackTimer&&(b.clearTimeout(this.timers.ackTimer),delete this.timers.ackTimer),this.emit("completed",this,{originator:"remote"})},c.prototype.onRequestTimeout=function(){this.status=a.RTCSession.C.STATUS_TERMINATED,this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})},c.prototype.onTransportError=function(){switch(this.status){case a.RTCSession.C.STATUS_CONFIRMED:case a.RTCSession.C.STATUS_CANCELED:case a.RTCSession.C.STATUS_TERMINATED:return}this.status=a.RTCSession.C.STATUS_TERMINATED,this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})},c.prototype.init_incoming=function(b){var c=null,d=b.getHeader("Content-Type");this.direction="incoming",this.request=b,this.status=a.RTCSession.C.STATUS_INVITE_RECEIVED,b.body&&"application/sdp"===d&&(c=b.body),this.session.emit("reinvite",this.session,{originator:"remote",reinvite:this,request:b,sdp:c})},c.prototype.successResponseSent=function(c,d,f){var g=this.session,h=1,i=a.Timers.T1;this.timers.invite2xxTimer=b.setTimeout(function j(){g.status===a.RTCSession.C.STATUS_WAITING_FOR_ACK&&(console.log(e+"Retransmitting 2xx:",h++),c.reply(200,null,d,f),i<a.Timers.T2&&(i=2*i,i>a.Timers.T2&&(i=a.Timers.T2)),g.timers.invite2xxTimer=b.setTimeout(j,i))},i),console.log(e+"re-INVITE response sent",Date.now()),this.timers.ackTimer=b.setTimeout(function(){g.status===a.RTCSession.C.STATUS_WAITING_FOR_ACK&&(console.log(e+"no ACK received, terminating the call"),g.timers.invite2xxTimer&&(b.clearTimeout(g.timers.invite2xxTimer),delete g.timers.invite2xxTimer),g.session.sendBye(),g.session.ended("remote",null,a.C.causes.NO_ACK))},a.Timers.TIMER_H)},c.prototype.sdpValid=function(){var c=this,d=this.request,e=null,f=c.session.ua.configuration.no_answer_timeout;if("incoming"!==this.direction)throw new TypeError('Invalid method "sdpValid" for an outgoing reINVITE');this.status=a.RTCSession.C.STATUS_WAITING_FOR_ANSWER,d.hasHeader("expires")&&(e=1e3*d.getHeader("expires")),this.timers.provisionalResponse=b.setTimeout(function(){d.reply(180,null,["Contact: "+c.session.contact]),delete c.timers.provisionalResponse},1e3),this.timers.answer=e&&f>e?b.setTimeout(function(){d.reply(487),c.emit("failed",c,{originator:"system",cause:a.C.causes.EXPIRES})},e):b.setTimeout(function(){d.reply(480),c.emit("failed",c,{originator:"local",cause:a.C.causes.NO_ANSWER})},f)},c.prototype.sdpInvalid=function(){if("incoming"!==this.direction)throw new TypeError('Invalid method "sdpInvalid" for an outgoing reINVITE');this.request.reply(488),this.status=a.RTCSession.C.STATUS_WAITING_FOR_ACK,this.emit("failed",this,{originator:"remote",cause:a.C.causes.BAD_MEDIA_DESCRIPTION})},c.prototype.accept=function(c){c=c||{};var d=this,e=this.request,f=c.extraHeaders||[],g=c.sdp;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing reINVITE');this.timers.provisionalResponse&&(b.clearTimeout(this.timers.provisionalResponse),delete this.timers.provisionalResponse),this.timers.answer&&(b.clearTimeout(this.timers.answer),delete this.timers.answer),this.session.dialog.processSessionTimerHeaders(e),this.session.dialog.addSessionTimerResponseHeaders(f),f.push("Contact: "+d.session.contact),f.push("Allow: "+a.Utils.getAllowedMethods(d.session.ua)),f.push("Content-Type: application/sdp");var h=function(){d.session.onTransportError(),d.onTransportError()};e.reply(200,null,f,g,this.successResponseSent.bind(this,e,f,g),h),this.status=a.RTCSession.C.STATUS_WAITING_FOR_ACK},c.prototype.reject=function(c){c=c||{};var d=c.status_code||480,e=c.reason_phrase,f=c.extraHeaders||[];if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing reINVITE');if(300>d||d>=700)throw new TypeError("Invalid status_code: "+d);this.timers.provisionalResponse&&(b.clearTimeout(this.timers.provisionalResponse),delete this.timers.provisionalResponse),this.timers.answer&&(b.clearTimeout(this.timers.answer),delete this.timers.answer),this.request.reply(d,e,f),this.status=a.RTCSession.C.STATUS_WAITING_FOR_ACK},c.C=k,c}(a),h=function(a){var b;return b=function(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.accepted=null,this.initEvents(b)},b.prototype=new a.EventEmitter,b.prototype.send=function(b){var c,e,f,g,h;if(this.direction="outgoing",this.session.status!==a.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==a.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.session.status);b=b||{},g=b.extraHeaders?b.extraHeaders.slice():[],f=b.eventHandlers||{},h=b.sdp;for(e in f)this.on(e,f[e]);g.push("Contact: "+this.session.contact),h&&g.push("Content-Type: application/sdp"),this.request=this.session.dialog.createRequest(a.C.UPDATE,g),this.request.body=h,c=new d(this),this.session.emit("update",this.session,{originator:"local",update:this,request:this.request}),c.send()},b.prototype.receiveResponse=function(b){var c;if(this.session.status===a.RTCSession.C.STATUS_CONFIRMED)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):this.session.dialog.processSessionTimerHeaders(b),this.emit("succeeded",this,{originator:"remote",response:b});break;default:c=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",response:b,cause:c})}},b.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})},b.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})},b.prototype.init_incoming=function(a){if(this.direction="incoming",this.request=a,this.session.emit("update",this.session,{originator:"remote",update:this,request:a}),null===this.accepted){var b=a.getHeader("content-type");b||a.body?this.reject({status_code:488}):this.accept()}return this.accepted},b.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing update');this.session.dialog.processSessionTimerHeaders(this.request),this.session.dialog.addSessionTimerResponseHeaders(b),b.push("Contact: "+this.session.contact),this.request.reply(200,null,b,c),this.accepted=!0},b.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing update');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e),this.accepted=!1},b}(a),i=function(a){var b,c=a.name+" | IN-DIALOG REFER | ",e=18e4;return b=function(a){var b=["accepted","failed","notify"];this.session=a,this.ua=a.ua,this.closed=!1,this.request=null,this.id=null,this.contact=a.contact,this.notify_timer=null,this.dialog=a.dialog,this.subscription_state="pending",this.subscription_expires=null,this.expire_timer=null,this.last_notify_body=null,this.accepted=!1,this.rejected=!1,this.direction=null,this.refer_uri=null,this.data={},this.initEvents(b)},b.prototype=new a.EventEmitter,b.prototype.send=function(b,e){var f,g,h,i,j,k,l=null;if(void 0===b)throw new TypeError("Not enough arguments");if(this.session.status!==a.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==a.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.session.status);e=e||{},j=e.extraHeaders||[],i=e.eventHandlers||{},h=e.contentType||"text/plain";for(g in i)this.on(g,i[g]);try{b=a.Utils.normalizeURI(b,this.ua.configuration.hostport_params)}catch(m){b=a.URI.parse(a.C.INVALID_TARGET_URI),l=a.C.causes.INVALID_REFER_TO_TARGET}this.direction="outgoing",this.refer_uri=b,k=this.dialog.createRequest(a.C.REFER,j),this.request=k,this.id=k.call_id+this.dialog.id.local_tag,k.setHeader("contact",this.contact),k.setHeader("refer-to",b),e.body&&(k.setHeader("content-type",h),k.body=e.body),f=new d(this),this.ua.emit("newRefer",this.ua,{originator:"local",refer:this,request:this.request}),l?this.emit("failed",this,{originator:"local",cause:l}):(f.send(),console.log(c+this.id+" sent"),this.notify_timer=setTimeout(this.onNotifyTimeout.bind(this),a.Timers.TIMER_F))},b.prototype.receiveResponse=function(b){var d;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):console.log(c+this.id+" accepted"),this.emit("accepted",this,{originator:"remote",response:b});break;default:console.log(c+this.id+" rejected (early)"),this.close(),d=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",message:b,cause:d})}},b.prototype.onRequestTimeout=function(){this.closed||(console.log(c+this.id+" request timeout"),this.close(),this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT}))},b.prototype.onTransportError=function(){this.closed||(console.log(c+this.id+" transport error"),this.close(),this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR}))},b.prototype.onNotifyTimeout=function(){this.closed||"pending"!==this.subscription_state||(console.log(c+this.id+" notify timeout"),this.emitFinalNotify(),this.close())},b.prototype.emitFinalNotify=function(){var b,c=this.last_notify_body;c||(c=a.Parser.parseMessage("SIP/2.0 100 Trying\r\n",!0)),b=c.status_code<200?"progress":c.status_code<300?"started":"failed",this.emit("notify",this,{originator:"system",request:null,sipFrag:c,sessionEvent:b,finalNotify:!0})},b.prototype.close=function(){"active"===this.subscription_state&&(console.warn(c+this.id+" closed with active subscription"),"incoming"===this.direction?this.notify({body:this.last_notify_body,finalNotify:!0}):this.emitFinalNotify()),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),this.closed=!0,console.log(c+this.id+" closed")},b.prototype.subscriptionExpired=function(){"terminated"!==this.subscription_state&&(this.notify({body:this.last_notify_body,finalNotify:!0,terminateReason:"timeout"}),this.expire_timer=null,console.log(c+this.id+" subscription expired"))},b.prototype.init_incoming=function(a){return this.direction="incoming",this.request=a,this.id=a.call_id+a.from_tag,a.hasHeader("refer-to")?a.countHeader("refer-to")>1?(a.reply(400,"Too many Refer-To header fields"),!1):(this.refer_uri=a.parseHeader("refer-to").uri,console.log(c+this.id+" received"),this.ua.emit("newRefer",this.ua,{originator:"remote",refer:this,request:a,session:this.session}),this.accepted||this.rejected||this.accept(),this.accepted):(a.reply(400,"Missing Refer-To header field"),!1)},b.prototype.call=function(b){var c,d=this.refer_uri;if(d.scheme!==a.C.SIP)throw new a.Exceptions.InvalidTargetError(d);return this.accepted||this.accept(),c=new a.RTCSession(this.ua),c.connect(d,b),this.addSessionNotifyHandlers(c),c},b.prototype.addSessionNotifyHandlers=function(b){var c=this;

b.on("progress",function(a){var b=a.data.response;c.notify({status_code:b.status_code,reason_phrase:b.reason_phrase})}),b.once("started",function(a){var b=a.data.response;c.notify({status_code:b.status_code,reason_phrase:b.reason_phrase}),c.close()}),b.once("failed",function(b){var d=500,e=null,f=b.data.message;f&&f instanceof a.IncomingResponse&&(d=f.status_code,e=f.reason_phrase),c.notify({status_code:d,reason_phrase:e}),c.close()})},b.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],d=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing refer');this.closed||(this.subscription_state="active",this.subscription_expires=Date.now()+e,this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),e),b.push("Contact: "+this.contact),this.request.reply(202,null,b,d),this.notify(),this.accepted=!0,console.log(c+this.id+" accepted"))},b.prototype.reject=function(a){a=a||{};var b=a.status_code||603,d=a.reason_phrase,e=a.extraHeaders||[],f=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing refer');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.closed||(this.accepted?(console.log(c+this.id+" rejected (late)"),this.notify({status_code:b,reason_phrase:d})):(console.log(c+this.id+" rejected (early)"),this.request.reply(b,d,e,f),this.rejected=!0),this.close())},b.prototype.notify=function(b){var d,e,f,g,h,i,j,k,l=this;if("incoming"!==this.direction)throw new TypeError('Invalid method "notify" for an outgoing refer');if(b=b||{},b.body&&"undefined"==typeof b.finalNotify)throw new TypeError("Must specify finalNotify when providing notify body");"active"===this.subscription_state&&(d=b.status_code||100,e=b.reason_phrase||a.C.REASON_PHRASE[d]||"",f=b.finalNotify||d>=200,f?(g="terminated",h=b.terminateReason||"noresource",i=g+";reason="+h):(g="active",i=g+";expires="+Math.round((this.subscription_expires-Date.now())/1e3)),j=b.body||"SIP/2.0 "+d+" "+e+"\r\n",this.last_notify_body=j,k=new a.Notify(this),k.send("refer;id="+this.request.cseq,i,{extraHeaders:b.extraHeaders,eventHandlers:b.eventHandlers,content_type:"message/sipfrag",body:j}),this.subscription_state=g,f||k.on("failed",function(){l.subscription_state="terminated",console.log(c+l.id+" unsubscribed (rejected notify)"),l.close()}))},b.prototype.receiveRequest=function(b){switch(b.method){case a.C.NOTIFY:return this.receiveNotify(b);case a.C.SUBSCRIBE:return this.receiveSubscribe(b)}return b.reply(405,null,["Allow: "+a.Utils.getAllowedMethods(this.ua)]),!1},b.prototype.receiveNotify=function(b){var d,e,f,g,h,i,j,k=!1;return"outgoing"!==this.direction||"active"!==this.subscription_state&&"pending"!==this.subscription_state?(b.reply(481,"Subscription Does Not Exist"),!1):(d=b.parseHeader("event"),d&&"refer"===d.event?(e=b.parseHeader("subscription-state"))?(f=b.getHeader("content-type"),f&&f.indexOf("message/sipfrag")<0?(b.reply(415),this.close(),!1):(j=b.body,/\r\n$/.test(j)||(j+="\r\n"),g=a.Parser.parseMessage(j,!0),!g||!g instanceof a.IncomingResponse?(b.reply(400,"Bad Message Body"),this.close(),!1):0===this.listeners("notify").length?(console.log(c+this.id+" no notify listeners; unsubscribing"),b.reply(603),this.subscription_state="terminated",this.close(),!1):(this.subscription_state=e.state,this.subscription_expires=Date.now()+1e3*e.expires,this.last_notify_body=g,null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),i=["Contact: "+this.contact],b.reply(200,null,i),h=g.status_code<200?"progress":g.status_code<300?"started":"failed",console.log(c+this.id+" notify: "+h),"terminated"===this.subscription_state?(k=!0,this.close()):this.expire_timer=setTimeout(this.close.bind(this),1e3*(e.expires+a.Timers.T4)),this.emit("notify",this,{originator:"remote",request:b,sipFrag:g,sessionEvent:h,finalNotify:k}),!0))):(b.reply(400,"Missing Subscription-State Header"),this.close(),!1):(b.reply(489),this.close(),!1))},b.prototype.receiveSubscribe=function(a){var b,d,f;return"incoming"!==this.direction?(a.reply(481),!1):"active"!==this.subscription_state&&"terminated"!==this.subscription_state?(a.reply(403),!1):(b=a.parseHeader("event"),b&&"refer"===b.event?(d=a.parseHeader("expires"),0===d?(console.log(c+this.id+" unsubscribed (expires=0)"),this.notify({body:this.last_notify_body,finalNotify:!0}),f=["Contact: "+this.contact],a.reply(200,null,f),this.close(),!0):(d=d>0?1e3*d:e,this.subscription_state="active",this.subscription_expires=Date.now()+d,null!==this.expire_timer&&clearTimeout(this.expire_timer),this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),d),f=["Contact: "+this.contact,"Expires: "+d/1e3],a.reply(200,null,f),console.log(c+this.id+" subscription extended"),!0)):(a.reply(489),!1))},b}(a),j=a.name+" | RTC SESSION | ",k={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};c=function(a){var b=["progress","failed","started","ended","newDTMF","reinvite","refresh","update"];this.ua=a,this.status=k.STATUS_NULL,this.lastReinvite=null,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.tones=null,this.allowed=null,this.supported=null,this.incoming_refer=null,this.outgoing_refer=null,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.data={},this.initEvents(b)},c.prototype=new a.EventEmitter,c.prototype.terminate=function(b){b=b||{};var c,d=b.status_code,e=b.reason_phrase,f=b.extraHeaders||[],g=b.body;if(this.status===k.STATUS_TERMINATED)throw new a.Exceptions.InvalidStateError(this.status);switch(this.status){case k.STATUS_NULL:case k.STATUS_INVITE_SENT:case k.STATUS_1XX_RECEIVED:if(console.log(j+"canceling RTCSession"),d&&(200>d||d>=700))throw new TypeError("Invalid status_code: "+d);d&&(e=e||a.C.REASON_PHRASE[d]||"",c="SIP ;cause="+d+' ;text="'+e+'"'),this.status===k.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=c):this.status===k.STATUS_INVITE_SENT?this.received_100?this.request.cancel(c):(this.isCanceled=!0,this.cancelReason=c):this.status===k.STATUS_1XX_RECEIVED&&this.request.cancel(c),this.failed("local",null,a.C.causes.CANCELED);break;case k.STATUS_WAITING_FOR_ANSWER:if(console.log(j+"rejecting RTCSession"),d=d||480,300>d||d>=700)throw new TypeError("Invalid status_code: "+d);this.request.reply(d,e,f,g),this.failed("local",null,a.C.causes.REJECTED);break;case k.STATUS_WAITING_FOR_ACK:case k.STATUS_CONFIRMED:console.log(j+"terminating RTCSession"),this.sendBye(b),this.ended("local",null,a.C.causes.BYE)}this.close()},c.prototype.answer=function(c){c=c||{};var d=this,e=this.request,f=c.extraHeaders||[],g=c.mediaConstraints||{audio:!0,video:!0},h=c.sdp,i=function(a){d.rtcMediaHandler.addStream(a,m,n)},l=function(){e.reply(480),d.failed("local",null,a.C.causes.USER_DENIED_MEDIA_ACCESS)},m=function(){d.rtcMediaHandler.createAnswer(o,p)},n=function(){d.status!==k.STATUS_TERMINATED&&d.failed("local",null,a.C.causes.WEBRTC_ERROR)},o=function(c){var g,h=function(){var f=1,g=a.Timers.T1;d.status=k.STATUS_WAITING_FOR_ACK,d.timers.invite2xxTimer=b.setTimeout(function h(){d.status===a.RTCSession.C.STATUS_WAITING_FOR_ACK&&(console.log(j+"Retransmitting 2xx:",f++),e.reply(200,null,["Contact: "+d.contact],c),g<a.Timers.T2&&(g=2*g,g>a.Timers.T2&&(g=a.Timers.T2)),d.timers.invite2xxTimer=b.setTimeout(h,g))},g),d.timers.ackTimer=b.setTimeout(function(){d.status===k.STATUS_WAITING_FOR_ACK&&(console.log(j+"no ACK received, terminating the call"),b.clearTimeout(d.timers.invite2xxTimer),d.sendBye(),d.ended("remote",null,a.C.causes.NO_ACK))},a.Timers.TIMER_H),d.started("local")},i=function(){d.failed("system",null,a.C.causes.CONNECTION_ERROR)};f.push("Contact: "+d.contact),f.push("Allow: "+a.Utils.getAllowedMethods(d.ua)),g=a.Utils.getSupportedExtensions(d.ua,a.Utils.getSessionExtensions(d,a.C.INVITE)),f.push("Supported: "+g.join(",")),e.reply(200,null,f,c,h,i)},p=function(){d.status!==k.STATUS_TERMINATED&&d.failed("local",null,a.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==k.STATUS_WAITING_FOR_ANSWER)throw new a.Exceptions.InvalidStateError(this.status);return this.createDialog(e,"UAS")?(b.clearTimeout(this.timers.userNoAnswerTimer),this.dialog.processSessionTimerHeaders(e),this.dialog.addSessionTimerResponseHeaders(f),void(h?o(h):this.rtcMediaHandler.getUserMedia(i,l,g))):void e.reply(500,"Missing Contact header field")},c.prototype.sendDTMF=function(c,d){var e,g,h=0,i=this;if(d=d||{},e=d.duration||null,g=d.interToneGap||null,void 0===c)throw new TypeError("Not enough arguments");if(this.status!==k.STATUS_CONFIRMED&&this.status!==k.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.status);if(!c||"string"!=typeof c&&"number"!=typeof c||!c.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+c);if(c=c.toString(),e&&!a.Utils.isDecimal(e))throw new TypeError("Invalid tone duration: "+e);if(e?e<f.C.MIN_DURATION?(console.warn(j+'"duration" value is lower than the minimum allowed, setting it to '+f.C.MIN_DURATION+" milliseconds"),e=f.C.MIN_DURATION):e>f.C.MAX_DURATION?(console.warn(j+'"duration" value is greater than the maximum allowed, setting it to '+f.C.MAX_DURATION+" milliseconds"),e=f.C.MAX_DURATION):e=Math.abs(e):e=f.C.DEFAULT_DURATION,d.duration=e,g&&!a.Utils.isDecimal(g))throw new TypeError("Invalid interToneGap: "+g);if(g?g<f.C.MIN_INTER_TONE_GAP?(console.warn(j+'"interToneGap" value is lower than the minimum allowed, setting it to '+f.C.MIN_INTER_TONE_GAP+" milliseconds"),g=f.C.MIN_INTER_TONE_GAP):g=Math.abs(g):g=f.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=c);this.tones=c;var l=function(){var a,c,j=i.tones;if(i.status===k.STATUS_TERMINATED||!j||h>=j.length)return void(i.tones=null);if(a=j[h],h+=1,","===a)c=2e3;else{var m=new f(i);m.on("failed",function(){i.tones=null}),m.send(a,d),c=e+g}b.setTimeout(l,c)};l()},c.prototype.sendReinvite=function(b){var c;if(b=b||{},c=b.sdp,this.lastReinvite)switch(this.lastReinvite.status){case k.STATUS_CONFIRMED:case k.STATUS_CANCELED:case k.STATUS_TERMINATED:break;default:throw new a.Exceptions.InvalidStateError(this.lastReinvite.status)}var d=new g(this);d.send(c,b),this.lastReinvite=d},c.prototype.sendUpdate=function(a){var b;a=a||{},b=a.sdp;var c=new h(this);c.send(a)},c.prototype.sendRefer=function(b,c){var d,e=this.dialog.remote_target;if(c=c||{},c.targetDialog=this.dialog,!this.isMethodAllowed(a.C.REFER,!1))throw new a.Exceptions.RemoteSupportError(a.C.REFER);if(this.isOptionSupported(a.C.SIP_EXTENSIONS.GRUU)&&e.hasParam("gr")&&this.isOptionSupported(a.C.SIP_EXTENSIONS.TARGET_DIALOG))return d=new a.Refer(this.ua),void d.send(e,b,c);if(d=this.outgoing_refer,d&&!d.closed)throw new a.Exceptions.InvalidStateError("Refer in progress");d=new i(this),d.send(b,c),this.outgoing_refer=d},c.prototype.isMethodAllowed=function(a,b){return this.allowed?this.allowed.indexOf(a)>=0?!0:!1:b},c.prototype.isOptionSupported=function(a){return this.supported&&this.supported.indexOf(a)>=0?!0:!1},c.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},c.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},c.prototype.init_incoming=function(c){var d,f=this,g=c.getHeader("Content-Type");if(!c.body||"application/sdp"!==g)return void c.reply(415);if(this.status=k.STATUS_INVITE_RECEIVED,this.from_tag=c.from_tag,this.id=c.call_id+this.from_tag,this.request=c,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,c.hasHeader("allow")&&(this.allowed=c.parseHeader("allow")),c.hasHeader("supported")&&(this.supported=c.parseHeader("supported")),c.hasHeader("expires")&&(d=1e3*c.getHeader("expires")),c.to_tag=a.Utils.newTag(),!this.createDialog(c,"UAS",!0))return void c.reply(500,"Missing Contact header field");var h=function(){c.reply(180,null,["Contact: "+f.contact]),f.status=k.STATUS_WAITING_FOR_ANSWER,f.timers.userNoAnswerTimer=b.setTimeout(function(){c.reply(480),f.failed("local",null,a.C.causes.NO_ANSWER)},f.ua.configuration.no_answer_timeout),d&&(f.timers.expiresTimer=b.setTimeout(function(){f.status===k.STATUS_WAITING_FOR_ANSWER&&(c.reply(487),f.failed("system",null,a.C.causes.EXPIRES))},d))},i=function(){c.reply(488),f.failed("remote",c,a.C.causes.BAD_MEDIA_DESCRIPTION)},l=function(){f.rtcMediaHandler=new e(f),f.rtcMediaHandler.onMessage("offer",c.body,function(){h(),f.newRTCSession("remote",c)},function(a){console.warn(j+"invalid SDP"),console.warn(a),i()})};this.ua.configuration.handle_media?l():this.newRTCSession("remote",c,h,i,l)},c.prototype.connect=function(b,c){c=c||{};var d,f,g,h=!1,i=c.eventHandlers||{},j=c.extraHeaders||[],l=c.mediaConstraints||{audio:!0,video:!0},m=c.RTCConstraints||{},n=c.featureTags||"",o=c.sdp;if(void 0===b)throw new TypeError("Not enough arguments");if(this.status!==k.STATUS_NULL)throw new a.Exceptions.InvalidStateError(this.status);for(d in i)this.on(d,i[d]);try{b=a.Utils.normalizeURI(b,this.ua.configuration.hostport_params)}catch(p){b=a.URI.parse(a.C.INVALID_TARGET_URI),h=!0}if(this.from_tag=a.Utils.newTag(),o||(this.rtcMediaHandler=new e(this,m)),this.anonymous=c.anonymous,this.isCanceled=!1,this.received_100=!1,f={from_tag:this.from_tag,extra_supported:a.Utils.getSessionExtensions(this,a.C.INVITE)},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0})+n,this.anonymous&&(f.from_display_name="Anonymous",f.from_uri="sip:anonymous@anonymous.invalid",j.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),j.push("Privacy: id")),g=new a.OutgoingRequest(a.C.INVITE,b,this.ua,f,j),this.request=g,g.setHeader("contact",this.contact),g.setHeader("content-type","application/sdp"),this.id=this.request.call_id+this.from_tag,this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),h)this.failed("local",null,a.C.causes.INVALID_TARGET);else if(o){var q=new a.RequestSender(this,this.ua);this.request.body=o,this.status=k.STATUS_INVITE_SENT,q.send()}else this.sendInitialRequest(l)},c.prototype.close=function(){var a;if(this.status!==k.STATUS_TERMINATED){console.log(j+"closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close(),this.incoming_refer&&this.incoming_refer.close(),this.outgoing_refer&&this.outgoing_refer.close();for(a in this.timers)b.clearTimeout(this.timers[a]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=k.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},c.prototype.calcDialogId=function(a,b){var c="UAS"===b?a.to_tag:a.from_tag,d="UAS"===b?a.from_tag:a.to_tag;return a.call_id+c+d},c.prototype.createDialog=function(b,c,d){var e,f,g=this.calcDialogId(b,c);return f=this.earlyDialogs[g],d?f?!0:(f=new a.Dialog(this,b,c,a.Dialog.C.STATUS_EARLY),f.id?(this.earlyDialogs[g]=f,!0):(this.failed("remote",b,a.C.causes.INTERNAL_ERROR),!1)):f?(f.update(b,c),this.dialog=f,delete this.earlyDialogs[g],!0):(e=new a.Dialog(this,b,c),e.id?(this.to_tag=b.to_tag,this.dialog=e,!0):(this.failed("remote",b,a.C.causes.INTERNAL_ERROR),!1))},c.prototype.receiveRequest=function(c){var d,e,j,l,m;if(c.method===a.C.CANCEL)return this.status===k.STATUS_WAITING_FOR_ANSWER?(this.status=k.STATUS_CANCELED,this.request.reply(487),c.reply(200),this.failed("remote",c,a.C.causes.CANCELED),!0):(c.reply(481),!1);switch(c.method){case a.C.ACK:this.status===k.STATUS_WAITING_FOR_ACK?(b.clearTimeout(this.timers.ackTimer),b.clearTimeout(this.timers.invite2xxTimer),this.status=k.STATUS_CONFIRMED):this.lastReinvite&&this.lastReinvite.status===k.STATUS_WAITING_FOR_ACK&&this.lastReinvite.receiveAck();break;case a.C.BYE:this.status===k.STATUS_CONFIRMED&&(c.reply(200),this.ended("remote",c,a.C.causes.BYE));break;case a.C.INVITE:if(this.status!==k.STATUS_CONFIRMED)return c.reply(491),!1;if(this.lastReinvite)switch(this.lastReinvite.status){case k.STATUS_CONFIRMED:case k.STATUS_CANCELED:case k.STATUS_TERMINATED:break;default:return c.reply(491),!1}e=new g(this),e.init_incoming(c),this.lastReinvite=e;break;case a.C.INFO:(this.status===k.STATUS_CONFIRMED||this.status===k.STATUS_WAITING_FOR_ACK)&&(d=c.getHeader("content-type"),d&&d.match(/^application\/dtmf-relay/i)&&new f(this).init_incoming(c));break;case a.C.UPDATE:return j=new h(this),j.init_incoming(c);case a.C.REFER:return this.incoming_refer&&!this.incoming_refer.closed?(c.reply(491,"Existing Refer In Progress"),!1):(l=new i(this),this.incoming_refer=l,l.init_incoming(c));case a.C.NOTIFY:return c.hasHeader("event")?(m=c.parseHeader("event"),m&&"refer"===m.event?(l=this.outgoing_refer)?l.receiveRequest(c):(c.reply(481,"Subscription Does Not Exist"),!1):(c.reply(489),!1)):(c.reply(400,"Missing Event Header"),!1);case a.C.SUBSCRIBE:return c.hasHeader("event")?(m=c.parseHeader("event"),m&&"refer"===m.event?(l=this.incoming_refer)?l.receiveRequest(c):(c.reply(403),!1):(c.reply(489),!1)):(c.reply(400,"Missing Event Header"),!1)}return!0},c.prototype.sendInitialRequest=function(b){var c=this,d=new a.RequestSender(c,this.ua),e=function(a){c.rtcMediaHandler.addStream(a,g,h)},f=function(){c.status!==k.STATUS_TERMINATED&&c.failed("local",null,a.C.causes.USER_DENIED_MEDIA_ACCESS)},g=function(){c.rtcMediaHandler.createOffer(i,j)},h=function(){c.status!==k.STATUS_TERMINATED&&c.failed("local",null,a.C.causes.WEBRTC_ERROR)},i=function(a){c.isCanceled||c.status===k.STATUS_TERMINATED||(c.request.body=a,c.status=k.STATUS_INVITE_SENT,d.send())},j=function(){c.status!==k.STATUS_TERMINATED&&c.failed("local",null,a.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(e,f,b)},c.prototype.receiveResponse=function(b){switch(b.method){case a.C.INVITE:this.receiveInviteResponse(b);break;case a.C.BYE:break;default:console.warn(j+"Unexpected response received:",b)}},c.prototype.receiveInviteResponse=function(b){var c,d=this;if(this.status!==k.STATUS_INVITE_SENT&&this.status!==k.STATUS_1XX_RECEIVED&&this.status!==k.STATUS_CONFIRMED)return void console.warn(j+"Unexpected INVITE response:",b);if(this.isCanceled)return void(b.status_code>=100&&b.status_code<200?this.request.cancel(this.cancelReason):b.status_code>=200&&b.status_code<299&&this.acceptAndTerminate(b));switch(!0){case/^100$/.test(b.status_code):this.received_100=!0;break;case/^1[0-9]{2}$/.test(b.status_code):if(!b.to_tag){console.warn(j+"1xx response received without to tag");break}b.hasHeader("contact")&&this.createDialog(b,"UAC",!0),this.status=k.STATUS_1XX_RECEIVED,this.progress("remote",b);break;case/^2[0-9]{2}$/.test(b.status_code):if(this.status===k.STATUS_CONFIRMED){var e=this.calcDialogId(b,"UAC");e===this.dialog.id.toString()?(console.info(j+"Retransmitting ACK"),this.sendACK()):(console.info(j+"Accepting and terminating fork, did:",e),this.acceptAndTerminate(b));break}if(this.status=k.STATUS_CONFIRMED,!b.body){this.acceptAndTerminate(b,400,"Missing session description"),this.failed("remote",b,a.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(b,"UAC"))break;this.sendACK(),b.hasHeader("allow")&&(this.allowed=b.parseHeader("allow")),b.hasHeader("supported")&&(this.supported=b.parseHeader("supported")),this.dialog.processSessionTimerHeaders(b),this.rtcMediaHandler?this.rtcMediaHandler.onMessage("answer",b.body,function(){d.started("remote",b)},function(c){console.warn(c),d.sendBye({status_code:488,reason_phrase:"Not Acceptable Here"}),d.failed("remote",b,a.C.causes.BAD_MEDIA_DESCRIPTION)}):d.started("remote",b);break;default:c=a.Utils.sipErrorCause(b.status_code),this.failed("remote",b,c)}},c.prototype.acceptAndTerminate=function(a,b,c){var d=this.calcDialogId(a,"UAC"),e=null;this.dialog?this.dialog&&d===this.dialog.id.toString()?e=this.dialog:this.earlyDialogs[d]?e=this.earlyDialogs[d]:this.createDialog(a,"UAC",!0)&&(e=this.earlyDialogs[d]):this.createDialog(a,"UAC")&&(e=this.dialog),e&&(this.sendACK({dialog:e}),this.sendBye({dialog:e,status_code:b,reason_phrase:c}))},c.prototype.sendACK=function(b){b=b||{};var c=b.dialog||this.dialog,d=c.createRequest(a.C.ACK);this.sendRequest(d)},c.prototype.sendBye=function(b){b=b||{};var c,d,e=b.status_code,f=b.reason_phrase||a.C.REASON_PHRASE[e]||"",g=b.extraHeaders||[],h=b.body,i=b.dialog||this.dialog;if(e&&(200>e||e>=700))throw new TypeError("Invalid status_code: "+e);e&&(d="SIP ;cause="+e+'; text="'+f+'"',g.push("Reason: "+d)),c=i.createRequest(a.C.BYE,g),c.body=h,this.sendRequest(c)},c.prototype.sendRequest=function(a){var b=new d(this,a);b.send()},c.prototype.onTransportError=function(){this.status!==k.STATUS_TERMINATED&&(this.status===k.STATUS_CONFIRMED?this.ended("system",null,a.C.causes.CONNECTION_ERROR):this.failed("system",null,a.C.causes.CONNECTION_ERROR))},c.prototype.onRequestTimeout=function(){this.status!==k.STATUS_TERMINATED&&(this.status===k.STATUS_CONFIRMED?this.ended("system",null,a.C.causes.REQUEST_TIMEOUT):this.failed("system",null,a.C.causes.CONNECTION_ERROR))},c.prototype.newRTCSession=function(a,b,c,d,e){var f=this,g="newRTCSession";"remote"===a?(f.direction="incoming",f.local_identity=b.to,f.remote_identity=b.from):"local"===a&&(f.direction="outgoing",f.local_identity=b.from,f.remote_identity=b.to),f.ua.emit(g,f.ua,{originator:a,session:f,request:b,sdpValid:c||null,sdpInvalid:d||null,handleMedia:e||null})},c.prototype.connecting=function(a,b){var c=this,d="connecting";c.emit(d,c,{originator:"local",request:b})},c.prototype.progress=function(a,b){var c=this,d="progress";c.emit(d,c,{originator:a,response:b||null})},c.prototype.started=function(a,b){var c=this,d="started";c.start_time=new Date,c.emit(d,c,{originator:a,response:b||null})},c.prototype.ended=function(a,b,c){var d=this,e="ended";d.end_time=new Date,d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})},c.prototype.failed=function(a,b,c){var d=this,e="failed";d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})},c.C=k,a.RTCSession=c}(d),function(a){var b;b=function(a){this.ua=a,this.direction=null,this.local_identity=null,this.remote_identity=null,this.data={}},b.prototype=new a.EventEmitter,b.prototype.send=function(b,c,d){var e,f,g,h,i,j=["succeeded","failed"],k=!1;if(void 0===b||void 0===c)throw new TypeError("Not enough arguments");this.initEvents(j),d=d||{},i=d.extraHeaders||[],h=d.eventHandlers||{},g=d.contentType||"text/plain";for(f in h)this.on(f,h[f]);try{b=a.Utils.normalizeURI(b,this.ua.configuration.hostport_params)}catch(l){b=a.URI.parse(a.C.INVALID_TARGET_URI),k=!0}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=b,this.closed=!1,this.ua.applicants[this]=this,i.push("Content-Type: "+g),this.request=new a.OutgoingRequest(a.C.MESSAGE,b,this.ua,null,i),c&&(this.request.body=c),e=new a.RequestSender(this,this.ua),this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request}),k?this.emit("failed",this,{originator:"local",cause:a.C.causes.INVALID_TARGET}):e.send()},b.prototype.receiveResponse=function(b){var c;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:b});break;default:delete this.ua.applicants[this],c=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",response:b,cause:c})}},b.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})},b.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})},b.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},b.prototype.init_incoming=function(b){var c;this.direction="incoming",this.request=b,this.local_identity=b.to.uri,this.remote_identity=b.from.uri,this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:b}),c=this.ua.transactions.nist[b.via_branch],!c||c.state!==a.Transactions.C.STATUS_TRYING&&c.state!==a.Transactions.C.STATUS_PROCEEDING||b.reply(200)},b.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,b,c)},b.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)},a.Message=b}(d),function(a){var c,d=a.name+" | UA | ",e={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE,UPDATE",newMessage:"MESSAGE",newRefer:"REFER"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS","NOTIFY"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED_EXTENSIONS:["path","outbound","gruu"],EVENT_EXTENSIONS:{tdialog:"newRefer"},SESSION_EVENT_EXTENSIONS:{timer:"refresh"},MAX_FORWARDS:69,TAG_LENGTH:10};c=function(a){var b=["connected","disconnected","registered","unregistered","registrationFailed","newRTCSession","newMessage","newOptions","newRefer"];if(e.ACCEPTED_BODY_TYPES=e.ACCEPTED_BODY_TYPES.toString(),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.registrator=null,this.applicants={},this.sessions={},this.refers={},this.transport=null,this.contact=null,this.status=e.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoverTimer=null,void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a),this.initEvents(b)}catch(c){throw this.status=e.STATUS_NOT_READY,this.error=e.CONFIGURATION_ERROR,c}},c.prototype=new a.EventEmitter,c.prototype.register=function(a){this.configuration.register=!0,this.registrator.register(a)},c.prototype.unregister=function(a){this.configuration.register=!1,this.registrator.unregister(a)},c.prototype.isRegistered=function(){return this.registrator&&this.registrator.registered?!0:!1},c.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},c.prototype.updateConfiguration=function(a){if(a.ws_servers){var b=c.configuration_check.mandatory.ws_servers(a.ws_servers);b&&(this.configuration.ws_servers=b)}if(a.authorization_user){var d=c.configuration_check.optional.authorization_user(a.authorization_user);d&&(this.configuration.authorization_user=d)}if(a.password){var e=c.configuration_check.optional.password(a.password);e&&(this.configuration.password=e)}},c.prototype.call=function(b,c){var d;d=new a.RTCSession(this),d.connect(b,c)},c.prototype.sendMessage=function(b,c,d){var e;e=new a.Message(this),e.send(b,c,d)},c.prototype.sendRefer=function(b,c,d){var e;e=new a.Refer(this),e.send(b,c,d)},c.prototype.stop=function(){var a,c,f,g=this;if(console.log(d+"user requested closure..."),this.status===e.STATUS_USER_CLOSED)return void console.warn("UA already closed");this.transportRecoverTimer&&(b.clearTimeout(this.transportRecoverTimer),this.transportRecoverTimer=null),this.registrator&&(console.log(d+"closing registrator"),this.registrator.close());for(a in this.sessions)console.log(d+"closing session "+a),this.sessions[a].terminate();for(c in this.refers)this.refers[c].close();for(f in this.applicants)this.applicants[f].close();this.status=e.STATUS_USER_CLOSED,this.isAnyTransactionOutstanding()?(this.transactionCheckTimer=b.setInterval(function(){g.isAnyTransactionOutstanding()||(b.clearInterval(g.transactionCheckTimer),b.clearTimeout(g.shutdownGraceTimer),g.transport.disconnect())},500),this.shutdownGraceTimer=b.setTimeout(function(){b.clearInterval(g.transactionCheckTimer),g.transport.disconnect()},"5000")):g.transport.disconnect()},c.prototype.start=function(){var b;console.log(d+"user requested startup..."),this.status===e.STATUS_INIT?(b=this.getNextWsServer(),new a.Transport(this,b)):this.status===e.STATUS_USER_CLOSED?(console.log(d+"resuming"),this.status=e.STATUS_READY,this.transport.connect()):this.status===e.STATUS_READY?console.log(d+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")},c.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=this.cache.credentials[a.realm]||{},this.cache.credentials[a.realm][a.uri]=a},c.prototype.getCredentials=function(a){var b,c;return b=a.ruri.host,this.cache.credentials[b]&&this.cache.credentials[b][a.ruri]&&(c=this.cache.credentials[b][a.ruri],c.method=a.method),c},c.prototype.isAnyTransactionOutstanding=function(){var a=["nict","ict","nist","ist"];for(var b in a)for(var c in this.transactions[a[b]])return!!c;return!1},c.prototype.onTransportClosed=function(b){var c,e,f=["nict","ict","nist","ist"];b.server.status=a.Transport.C.STATUS_DISCONNECTED,console.log(d+"connection state set to "+a.Transport.C.STATUS_DISCONNECTED);for(c in f)for(e in this.transactions[f[c]])this.transactions[f[c]][e].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},c.prototype.onTransportError=function(b){var c;console.log(d+"transport "+b.server.ws_uri+" failed | connection state set to "+a.Transport.C.STATUS_ERROR),b.server.status=a.Transport.C.STATUS_ERROR,this.emit("disconnected",this,{transport:b,code:b.lastTransportError.code,reason:b.lastTransportError.reason}),this.status!==e.STATUS_USER_CLOSED&&(c=this.getNextWsServer(),c?new a.Transport(this,c):(this.closeSessionsOnTransportError(),this.error&&this.error===e.NETWORK_ERROR||(this.status=e.STATUS_NOT_READY,this.error=e.NETWORK_ERROR),this.recoverTransport()))},c.prototype.onTransportConnected=function(b){this.transport=b,this.transportRecoverAttempts=0,b.server.status=a.Transport.C.STATUS_READY,console.log(d+"connection state set to "+a.Transport.C.STATUS_READY),this.status!==e.STATUS_USER_CLOSED&&(this.status=e.STATUS_READY,this.error=null,this.emit("connected",this,{transport:b}),this.configuration.register?this.registrator?this.registrator.onTransportConnected():(this.registrator=new a.Registrator(this,b),this.register()):this.registrator=new a.Registrator(this,b))},c.prototype.receiveRequest=function(b){var c,f,g,h,i=b.method;if(b.ruri.user!==this.configuration.uri.user&&b.ruri.user!==this.contact.uri.user)return console.warn(d+"Request-URI does not point to us"),void(b.method!==a.C.ACK&&b.reply_sl(404));if(!a.Transactions.checkTransaction(this,b)){if(b.hasHeader("require"))for(var j=a.Utils.getSupportedExtensions(this),k=b.parseHeader("require"),l=0,m=k.length;m>l;l++){var n=k[l];if(j.indexOf(n)<0&&!e.SESSION_EVENT_EXTENSIONS[n])return void(b.method!==a.C.ACK&&b.reply_sl(420))}if(i===a.C.INVITE?new a.Transactions.InviteServerTransaction(b,this):i!==a.C.ACK&&new a.Transactions.NonInviteServerTransaction(b,this),i===a.C.OPTIONS){var o=["Allow: "+a.Utils.getAllowedMethods(this),"Accept: "+e.ACCEPTED_BODY_TYPES,"Supported: "+a.Utils.getSupportedExtensions(this).join(",")];return void(this.checkEvent("newOptions")&&0!==this.listeners("newOptions").length?this.emit("newOptions",this,{originator:"remote",request:b,extraHeaders:o}):b.reply(200,null,o))}if(i===a.C.MESSAGE)return this.checkEvent("newMessage")&&0!==this.listeners("newMessage").length?(g=new a.Message(this),void g.init_incoming(b)):void b.reply(405,null,["Allow: "+a.Utils.getAllowedMethods(this)]);if(b.to_tag){if(c=this.findDialog(b))return void c.receiveRequest(b);if(i===a.C.NOTIFY)return(f=this.findSession(b))?void f.receiveRequest(b):(h=this.refers[b.call_id+b.to_tag])?void h.receiveRequest(b):(console.warn(d+"received NOTIFY request for a non existent session"),
void b.reply(481,"Subscription does not exist"));if(i!==a.C.ACK)return void b.reply(481)}else{if(!this.isRegistered())return void b.reply(410);switch(i){case a.C.INVITE:!this.configuration.handle_media||a.WebRTC.isSupported?(f=new a.RTCSession(this),f.init_incoming(b)):(console.warn(d+"INVITE received but WebRTC is not supported"),b.reply(488));break;case a.C.BYE:b.reply(481);break;case a.C.CANCEL:f=this.findSession(b),f?f.receiveRequest(b):(b.reply(481),console.warn(d+"received CANCEL request for a non existent session"));break;case a.C.ACK:break;case a.C.REFER:h=new a.Refer(this),h.init_incoming(b);break;default:b.reply(405,null,["Allow: "+a.Utils.getAllowedMethods(this)])}}}},c.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c?c:e?e:null},c.prototype.findDialog=function(a){var b=a.call_id+a.from_tag+a.to_tag,c=this.dialogs[b];return c?c:(b=a.call_id+a.to_tag+a.from_tag,c=this.dialogs[b],c?c:null)},c.prototype.getNextWsServer=function(){var b,c,d=[];for(b in this.configuration.ws_servers)c=this.configuration.ws_servers[b],c.status!==a.Transport.C.STATUS_ERROR&&(0===d.length?d.push(c):c.weight>d[0].weight?d=[c]:c.weight===d[0].weight&&d.push(c));return b=Math.floor(Math.random()*d.length),d[b]},c.prototype.closeSessionsOnTransportError=function(){var a;for(a in this.sessions)this.sessions[a].onTransportError();this.registrator&&this.registrator.onTransportClosed()},c.prototype.recoverTransport=function(c){var e,f,g,h,i;c=c||this,h=c.transportRecoverAttempts;for(e in c.configuration.ws_servers)c.configuration.ws_servers[e].status=0;i=c.getNextWsServer(),f=Math.floor(Math.random()*Math.pow(2,h)+1),g=f*c.configuration.connection_recovery_min_interval,g>c.configuration.connection_recovery_max_interval&&(console.log(d+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),g=c.configuration.connection_recovery_min_interval,h=0),console.log(d+"next connection attempt in "+g+" seconds"),this.transportRecoverTimer=b.setTimeout(function(){c.transportRecoverAttempts=h+1,c.transportRecoverTimer=null,new a.Transport(c,i)},1e3*g)},c.prototype.loadConfig=function(e){var f,g,h,i,j,k={via_host:a.Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],handle_media:!0,trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(f in c.configuration_check.mandatory){if(!e.hasOwnProperty(f))throw new a.Exceptions.ConfigurationError(f);if(g=e[f],h=c.configuration_check.mandatory[f](g),void 0===h)throw new a.Exceptions.ConfigurationError(f,g);k[f]=h}for(f in c.configuration_check.optional)if(e.hasOwnProperty(f)){if(g=e[f],null===g||""===g||void 0===g)continue;if("number"==typeof g&&b.isNaN(g))continue;if(h=c.configuration_check.optional[f](g),void 0===h)throw new a.Exceptions.ConfigurationError(f,g);k[f]=h}if(k.connection_recovery_max_interval<k.connection_recovery_min_interval)throw new a.Exceptions.ConfigurationError("connection_recovery_max_interval",k.connection_recovery_max_interval);0===k.display_name&&(k.display_name="0"),k.instance_id||(k.instance_id="uuid:"+a.Utils.newUUID()),k.jssip_id=a.Utils.createRandomToken(5),i=k.uri.clone(),i.user=null,k.hostport_params=i.toString().replace(/^sip:/i,""),k.authorization_user||(k.authorization_user=k.uri.user),k.registrar_server||(j=k.uri.clone(),j.user=null,k.registrar_server=j),k.no_answer_timeout=1e3*k.no_answer_timeout,k.hack_ip_in_contact&&(k.via_host=a.Utils.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new a.URI("sip",a.Utils.createRandomToken(8),k.via_host,null,{transport:"ws"}),toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),c&&(d+=";ob"),d+=">"}},console.log(d+"configuration parameters after validation:");for(f in k){switch(f){case"uri":case"registrar_server":console.log("Â· "+f+": "+k[f]);break;default:console.log("Â· "+f+": "+b.JSON.stringify(k[f]))}c.configuration_skeleton[f].value=k[f]}Object.defineProperties(this.configuration,c.configuration_skeleton);for(f in k)c.configuration_skeleton[f].value=""},c.configuration_skeleton=function(){var a,b,c={},d=["jssip_id","register_min_expires","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_ip_in_contact","handle_media","instance_id","no_answer_timeout","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","via_core_value","via_host"],e=["ws_servers","authorization_user","password","register"];for(a in d)b=d[a],c[b]={value:"",writable:!1,configurable:!1};for(a in e)b=e[a],c[b]={value:"",writable:!0,configurable:!1};return c}(),c.configuration_check={mandatory:{uri:function(b){var c;return/^sip:/i.test(b)||(b=a.C.SIP+":"+b),c=a.URI.parse(b),c&&c.user?c:void 0},ws_servers:function(b){var c,e;if("string"==typeof b)b=[{ws_uri:b}];else{if(!(b instanceof Array))return;for(c in b)"string"==typeof b[c]&&(b[c]={ws_uri:b[c]})}if(0===b.length)return!1;for(c in b){if(!b[c].ws_uri)return void console.error(d+'missing "ws_uri" attribute in ws_servers parameter');if(b[c].weight&&!Number(b[c].weight))return void console.error(d+'"weight" attribute in ws_servers parameter must be a Number');if(e=a.Grammar.parse(b[c].ws_uri,"absoluteURI"),-1===e)return void console.error(d+'invalid "ws_uri" attribute in ws_servers parameter: '+b[c].ws_uri);if("wss"!==e.scheme&&"ws"!==e.scheme)return void console.error(d+"invalid URI scheme in ws_servers parameter: "+e.scheme);b[c].sip_uri="<sip:"+e.host+(e.port?":"+e.port:"")+";transport=ws;lr>",b[c].weight||(b[c].weight=0),b[c].status=0,b[c].scheme=e.scheme.toUpperCase()}return b}},optional:{authorization_user:function(b){return-1===a.Grammar.parse('"'+b+'"',"quoted_string")?void 0:b},connection_recovery_max_interval:function(c){var d;return a.Utils.isDecimal(c)&&(d=b.Number(c),d>0)?d:void 0},connection_recovery_min_interval:function(c){var d;return a.Utils.isDecimal(c)&&(d=b.Number(c),d>0)?d:void 0},display_name:function(b){return-1===a.Grammar.parse('"'+b+'"',"display_name")?void 0:b},hack_via_tcp:function(a){return"boolean"==typeof a?a:void 0},hack_ip_in_contact:function(a){return"boolean"==typeof a?a:void 0},handle_media:function(a){return"boolean"==typeof a?a:void 0},instance_id:function(b){return/^uuid?:/.test(b)||(b="uuid:"+b),-1===a.Grammar.parse(b,"uuid_URI")?void 0:b},no_answer_timeout:function(c){var d;return a.Utils.isDecimal(c)&&(d=b.Number(c),d>0)?d:void 0},password:function(a){return String(a)},register:function(a){return"boolean"==typeof a?a:void 0},register_expires:function(c){var d;return a.Utils.isDecimal(c)&&(d=b.Number(c),d>0)?d:void 0},registrar_server:function(b){var c;return/^sip:/i.test(b)||(b=a.C.SIP+":"+b),c=a.URI.parse(b),c?c.user?void 0:c:void 0},stun_servers:function(b){var c,d;if("string"==typeof b)b=[b];else if(!(b instanceof Array))return;for(c in b){if(d=b[c],/^stuns?:/.test(d)||(d="stun:"+d),-1===a.Grammar.parse(d,"stun_URI"))return;b[c]=d}return b},trace_sip:function(a){return"boolean"==typeof a?a:void 0},turn_servers:function(b){var c,d;b instanceof Array||(b=[b]);for(c in b){if(d=b[c],!(d.server&&d.username&&d.password))return;if(/^turns?:/.test(d.server)||(d.server="turn:"+d.server),-1===a.Grammar.parse(d.server,"turn_URI"))return;if(-1===a.Grammar.parse(d.username,"user"))return;if(-1===a.Grammar.parse(d.password,"password"))return}return b},use_preloaded_route:function(a){return"boolean"==typeof a?a:void 0}}},c.C=e,a.UA=c}(d),function(a){var c;c={str_utf8_length:function(a){return b.unescape(encodeURIComponent(a)).length},isFunction:function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)?!0:!1},isDecimal:function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},createRandomToken:function(a,b){var c,d,e="";for(b=b||32,c=0;a>c;c++)d=Math.random()*b|0,e+=d.toString(b);return e},newTag:function(){return a.Utils.createRandomToken(a.UA.C.TAG_LENGTH)},newUUID:function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a},hostType:function(b){return b?(b=a.Grammar.parse(b,"host"),-1!==b?b.host_type:void 0):void 0},normalizeURI:function(b,c){var d,e,f,g,h=b;if(b){if(b instanceof a.URI)return b;if("string"==typeof b){switch(e=b.split("@"),e.length){case 1:if(!c)throw new a.Exceptions.InvalidTargetError(h);f=b,g=c;break;case 2:f=e[0],g=e[1];break;default:f=e.slice(0,e.length-1).join("@"),g=e[e.length-1]}if(f=f.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(f)&&(f=f.replace(/[\-\.\(\)]/g,"")),b=a.C.SIP+":"+a.Utils.escapeUser(f)+"@"+g,d=a.URI.parse(b))return d;throw new a.Exceptions.InvalidTargetError(h)}throw new a.Exceptions.InvalidTargetError(h)}throw new a.Exceptions.InvalidTargetError(h)},escapeUser:function(a){return b.encodeURIComponent(b.decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(a){var b,c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate","Min-Se":"Min-SE"},d=a.toLowerCase().replace(/_/g,"-").split("-"),e="";for(b in d)"0"!==b&&(e+="-"),e+=d[b].charAt(0).toUpperCase()+d[b].substring(1);return c[e]&&(e=c[e]),e},sipErrorCause:function(b){var c;for(c in a.C.SIP_ERROR_CAUSES)if(-1!==a.C.SIP_ERROR_CAUSES[c].indexOf(b))return a.C.causes[c];return a.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){function a(a,c){return b.Math.floor(b.Math.random()*(c-a+1)+a)}return"192.0.2."+a(1,254)},getAllowedMethods:function(b){var c,d=a.UA.C.ALLOWED_METHODS.toString();for(c in a.UA.C.EVENT_METHODS)b.checkEvent(c)&&b.listeners(c).length>0&&(d+=","+a.UA.C.EVENT_METHODS[c]);return d},getSupportedExtensions:function(b,c){var d,e,f=a.UA.C.SUPPORTED_EXTENSIONS.slice();for(d in a.UA.C.EVENT_EXTENSIONS)e=a.UA.C.EVENT_EXTENSIONS[d],b.checkEvent(e)&&b.listeners(e).length>0&&f.push(d);return c?f.concat(c):f},getSessionExtensions:function(b){var c,d,e=[];for(c in a.UA.C.SESSION_EVENT_EXTENSIONS)d=a.UA.C.SESSION_EVENT_EXTENSIONS[c],b.checkEvent(d)&&b.listeners(d).length>0&&e.push(c);return e},calculateMD5:function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}},a.Utils=c}(d),function(a){function b(){return"sip"!==l.s("to").uri.scheme?(j(416),!1):void 0}function c(){return l.to_tag||l.call_id.substr(0,5)!==m.configuration.jssip_id?void 0:(j(482),!1)}function d(){var b=a.Utils.str_utf8_length(l.body),c=l.getHeader("content-length");return c>b?(j(400),!1):void 0}function e(){var b,c,d=l.from_tag,e=l.call_id,f=l.cseq;if(!l.to_tag)if(l.method===a.C.INVITE){if(b=m.transactions.ist[l.via_branch],!b)return;for(c in m.transactions.ist)if(b=m.transactions.ist[c],b.request.from_tag===d&&b.request.call_id===e&&b.request.cseq===f)return j(482),!1}else{if(b=m.transactions.nist[l.via_branch],!b)return;for(c in m.transactions.nist)if(b=m.transactions.nist[c],b.request.from_tag===d&&b.request.call_id===e&&b.request.cseq===f)return j(482),!1}}function f(){return l.countHeader("via")>1?(console.warn(o+"More than one Via header field present in the response. Dropping the response"),!1):void 0}function g(){var a=m.configuration.via_host;return l.via.host!==a?(console.warn(o+"Via host in the response does not match UA Via host value. Dropping the response"),!1):void 0}function h(){var b=a.Utils.str_utf8_length(l.body),c=l.getHeader("content-length");return c>b?(console.warn(o+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1):void 0}function i(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!l.hasHeader(a[b]))return console.warn(o+"Missing mandatory header field : "+a[b]+". Dropping the response"),!1}function j(b){var c,d="SIP/2.0 "+b+" "+a.C.REASON_PHRASE[b]+"\r\n",e=l.countHeader("via"),f=0;for(f;e>f;f++)d+="Via: "+l.getHeader("via",f)+"\r\n";c=l.getHeader("To"),l.to_tag||(c+=";tag="+a.Utils.newTag()),d+="To: "+c+"\r\n",d+="From: "+l.getHeader("From")+"\r\n",d+="Call-ID: "+l.call_id+"\r\n",d+="CSeq: "+l.cseq+" "+l.method+"\r\n",d+="\r\n",n.send(d)}var k,l,m,n,o=a.name+" | SANITY CHECK | ",p=[],q=[],r=[];p.push(b),p.push(c),p.push(d),p.push(e),q.push(f),q.push(g),q.push(h),r.push(i),k=function(b,c,d){var e,f;for(l=b,m=c,n=d,e=r.length;e--;)if(f=r[e](l),f===!1)return!1;if(l instanceof a.IncomingRequest){for(e=p.length;e--;)if(f=p[e](l),f===!1)return!1}else if(l instanceof a.IncomingResponse)for(e=q.length;e--;)if(f=q[e](l),f===!1)return!1;return!0},a.sanityCheck=k}(d),function(a){var b,c=a.name+" | DIGEST AUTHENTICATION | ";b=function(a){this.username=a.configuration.authorization_user,this.password=a.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},b.prototype.authenticate=function(b,d){if(this.algorithm=d.algorithm,this.realm=d.realm,this.nonce=d.nonce,this.opaque=d.opaque,this.stale=d.stale,this.algorithm){if("MD5"!==this.algorithm)return console.warn(c+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(c+"challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return console.warn(c+"challenge without Digest nonce, authentication aborted"),!1;if(d.qop)if(d.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(d.qop.indexOf("auth-int")>-1))return console.warn(c+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=b.method,this.uri=b.ruri,this.cnonce=a.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},b.prototype.calculateResponse=function(){var b,c;b=a.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(c=a.Utils.calculateMD5(this.method+":"+this.uri),this.response=a.Utils.calculateMD5(b+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+c)):"auth-int"===this.qop?(c=a.Utils.calculateMD5(this.method+":"+this.uri+":"+a.Utils.calculateMD5(this.body?this.body:"")),this.response=a.Utils.calculateMD5(b+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+c)):null===this.qop&&(c=a.Utils.calculateMD5(this.method+":"+this.uri),this.response=a.Utils.calculateMD5(b+":"+this.nonce+":"+c))},b.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")},b.prototype.updateNcHex=function(){var a=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-a.length)+a},a.DigestAuthentication=b}(d),function(a){var c;c={},b.navigator.webkitGetUserMedia?c.getUserMedia=b.navigator.webkitGetUserMedia.bind(navigator):b.navigator.mozGetUserMedia?c.getUserMedia=b.navigator.mozGetUserMedia.bind(navigator):b.navigator.getUserMedia&&(c.getUserMedia=b.navigator.getUserMedia.bind(navigator)),b.webkitRTCPeerConnection?c.RTCPeerConnection=b.webkitRTCPeerConnection:b.mozRTCPeerConnection?c.RTCPeerConnection=b.mozRTCPeerConnection:b.RTCPeerConnection&&(c.RTCPeerConnection=b.RTCPeerConnection),b.webkitRTCSessionDescription?c.RTCSessionDescription=b.webkitRTCSessionDescription:b.mozRTCSessionDescription?c.RTCSessionDescription=b.mozRTCSessionDescription:b.RTCSessionDescription&&(c.RTCSessionDescription=b.RTCSessionDescription),c.RTCPeerConnection&&c.RTCPeerConnection.prototype&&(c.RTCPeerConnection.prototype.getLocalStreams||(c.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},c.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),c.isSupported=c.getUserMedia&&c.RTCPeerConnection&&c.RTCSessionDescription?!0:!1,a.WebRTC=c}(d),function(a){var b,c=a.name+" | REFER | ",d=18e4;b=function(a){var b=["accepted","failed","notify"];this.ua=a,this.targetDialog=null,this.closed=!1,this.request=null,this.local_tag=null,this.remote_tag=null,this.id=null,this.contact=null,this.notify_timer=null,this.dialog=null,this.subscription_state="pending",this.subscription_expires=null,this.expire_timer=null,this.last_notify_body=null,this.accepted=!1,this.rejected=!1,this.direction=null,this.local_identity=null,this.remote_identity=null,this.refer_uri=null,this.data={},this.initEvents(b)},b.prototype=new a.EventEmitter,b.prototype.send=function(b,d,e){var f,g,h,i,j,k,l=null;if(void 0===b||void 0===d)throw new TypeError("Not enough arguments");e=e||{},j=e.extraHeaders||[],i=e.eventHandlers||{},h=e.contentType||"text/plain";for(g in i)this.on(g,i[g]);try{b=a.Utils.normalizeURI(b,this.ua.configuration.hostport_params)}catch(m){b=a.URI.parse(a.C.INVALID_TARGET_URI),l=a.C.causes.INVALID_TARGET}try{d=a.Utils.normalizeURI(d,this.ua.configuration.hostport_params)}catch(m){d=a.URI.parse(a.C.INVALID_TARGET_URI),l=a.C.causes.INVALID_REFER_TO_TARGET}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=b,this.refer_uri=d,this.local_tag=a.Utils.newTag(),this.contact=this.ua.contact.toString({outbound:!0}),k=new a.OutgoingRequest(a.C.REFER,b,this.ua,{from_tag:this.local_tag},j,e.body),this.request=k,this.id=k.call_id+this.local_tag,this.ua.refers[this.id]=this,k.setHeader("contact",this.contact),k.setHeader("refer-to",d),e.targetDialog&&(this.targetDialog=e.targetDialog,k.setHeader("require",a.C.SIP_EXTENSIONS.TARGET_DIALOG),k.setHeader("target-dialog",e.targetDialog.id.toTargetDialogHeader())),e.body&&k.setHeader("content-type",h),f=new a.RequestSender(this,this.ua),this.ua.emit("newRefer",this.ua,{originator:"local",refer:this,request:this.request}),l?this.emit("failed",this,{originator:"local",cause:l}):(f.send(),console.log(c+this.id+" sent"),this.notify_timer=setTimeout(this.onNotifyTimeout.bind(this),a.Timers.TIMER_F))},b.prototype.receiveResponse=function(b){var d;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):console.log(c+this.id+" accepted"),this.emit("accepted",this,{originator:"remote",response:b});break;default:console.log(c+this.id+" rejected (early)"),this.close(),d=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",message:b,cause:d})}},b.prototype.onRequestTimeout=function(){this.closed||(console.log(c+this.id+" request timeout"),this.close(),this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT}))},b.prototype.onTransportError=function(){this.closed||(console.log(c+this.id+" transport error"),this.close(),this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR}))},b.prototype.onNotifyTimeout=function(){this.closed||"pending"!==this.subscription_state||(console.log(c+this.id+" notify timeout"),this.emitFinalNotify(),this.close())},b.prototype.emitFinalNotify=function(){var b,c=this.last_notify_body;c||(c=a.Parser.parseMessage("SIP/2.0 100 Trying\r\n",!0)),b=c.status_code<200?"progress":c.status_code<300?"started":"failed",this.emit("notify",this,{originator:"system",request:null,sipFrag:c,sessionEvent:b,finalNotify:!0})},b.prototype.close=function(){"active"===this.subscription_state&&(console.warn(c+this.id+" closed with active subscription"),"incoming"===this.direction?this.notify({body:this.last_notify_body,finalNotify:!0}):this.emitFinalNotify()),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),this.dialog&&(this.dialog.terminate(),delete this.dialog),this.closed=!0,delete this.ua.refers[this],console.log(c+this.id+" closed")},b.prototype.subscriptionExpired=function(){"terminated"!==this.subscription_state&&(this.notify({body:this.last_notify_body,finalNotify:!0,terminateReason:"timeout"}),this.expire_timer=null,console.log(c+this.id+" subscription expired"))},b.prototype.init_incoming=function(b){var d=null;if(this.direction="incoming",this.request=b,this.remote_tag=b.from_tag,this.id=b.call_id+b.from_tag,this.contact=this.ua.contact.toString(),this.local_identity=b.to.uri,this.remote_identity=b.from.uri,!b.hasHeader("refer-to"))return void b.reply(400,"Missing Refer-To header field");if(b.countHeader("refer-to")>1)return void b.reply(400,"Too many Refer-To header fields");if(this.refer_uri=b.parseHeader("refer-to").uri,b.hasHeader("target-dialog")){var e=b.parseHeader("target-dialog"),f=new a.DialogId(e.call_id,e.local_tag,e.remote_tag);this.targetDialog=this.ua.dialogs[f.toString()]||null}return this.targetDialog&&this.targetDialog.isConfirmed()&&(d=this.targetDialog.owner,(d.dialog!==this.targetDialog||!d instanceof a.RTCSession)&&(d=null)),this.local_tag=b.to_tag=a.Utils.newTag(),this.dialog=new a.Dialog(this,b,"UAS"),this.dialog.id?(this.ua.refers[this.id]=this,console.log(c+this.id+" received"),this.ua.emit("newRefer",this.ua,{originator:"remote",refer:this,request:b,session:d}),void(this.accepted||this.rejected||this.accept())):void b.reply(500,"Missing Contact header field")},b.prototype.call=function(b){var c,d=this.refer_uri;if(d.scheme!==a.C.SIP)throw new a.Exceptions.InvalidTargetError(d);return this.accepted||this.accept(),c=new a.RTCSession(this.ua),c.connect(d,b),this.addSessionNotifyHandlers(c),c},b.prototype.addSessionNotifyHandlers=function(b){var c=this;b.on("progress",function(a){var b=a.data.response;c.notify({status_code:b.status_code,reason_phrase:b.reason_phrase})}),b.once("started",function(a){var b=a.data.response;c.notify({status_code:b.status_code,reason_phrase:b.reason_phrase}),c.close()}),b.once("failed",function(b){var d=500,e=null,f=b.data.message;f&&f instanceof a.IncomingResponse&&(d=f.status_code,e=f.reason_phrase),c.notify({status_code:d,reason_phrase:e}),c.close()})},b.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing refer');this.closed||(this.subscription_state="active",this.subscription_expires=Date.now()+d,this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),d),b.push("Contact: "+this.contact),this.request.reply(202,null,b,e),this.notify(),this.accepted=!0,console.log(c+this.id+" accepted"))},b.prototype.reject=function(a){a=a||{};var b=a.status_code||603,d=a.reason_phrase,e=a.extraHeaders||[],f=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing refer');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.closed||(this.accepted?(console.log(c+this.id+" rejected (late)"),this.notify({status_code:b,reason_phrase:d})):(console.log(c+this.id+" rejected (early)"),this.request.reply(b,d,e,f),this.rejected=!0),this.close())},b.prototype.notify=function(b){var d,e,f,g,h,i,j,k,l=this;if("incoming"!==this.direction)throw new TypeError('Invalid method "notify" for an outgoing refer');if(b=b||{},b.body&&"undefined"==typeof b.finalNotify)throw new TypeError("Must specify finalNotify when providing notify body");"active"===this.subscription_state&&(d=b.status_code||100,e=b.reason_phrase||a.C.REASON_PHRASE[d]||"",f=b.finalNotify||d>=200,f?(g="terminated",h=b.terminateReason||"noresource",i=g+";reason="+h):(g="active",i=g+";expires="+Math.round((this.subscription_expires-Date.now())/1e3)),j=b.body||"SIP/2.0 "+d+" "+e+"\r\n",this.last_notify_body=j,k=new a.Notify(this),k.send("refer",i,{extraHeaders:b.extraHeaders,eventHandlers:b.eventHandlers,content_type:"message/sipfrag",body:j}),this.subscription_state=g,f||k.on("failed",function(){l.subscription_state="terminated",console.log(c+l.id+" unsubscribed (rejected notify)"),l.close()}))},b.prototype.receiveRequest=function(b){switch(b.method){case a.C.NOTIFY:return void this.receiveNotify(b);case a.C.SUBSCRIBE:return void this.receiveSubscribe(b)}b.reply(405,null,["Allow: "+a.Utils.getAllowedMethods(this.ua)])},b.prototype.receiveNotify=function(b){var d,e,f,g,h,i,j,k=!1;return"outgoing"!==this.direction||"active"!==this.subscription_state&&"pending"!==this.subscription_state?void b.reply(481,"Subscription Does Not Exist"):(d=b.parseHeader("event"),d&&"refer"===d.event?(e=b.parseHeader("subscription-state"))?(f=b.getHeader("content-type"),f&&f.indexOf("message/sipfrag")<0?(b.reply(415),void this.close()):(j=b.body,/\r\n$/.test(j)||(j+="\r\n"),g=a.Parser.parseMessage(j,!0),!g||!g instanceof a.IncomingResponse?(b.reply(400,"Bad Message Body"),void this.close()):0===this.listeners("notify").length?(console.log(c+this.id+" no notify listeners; unsubscribing"),b.reply(603),this.subscription_state="terminated",void this.close()):this.dialog||(this.remote_tag=b.from_tag,this.dialog=new a.Dialog(this,b,"UAS"),this.dialog.id)?(this.subscription_state=e.state,this.subscription_expires=Date.now()+1e3*e.expires,this.last_notify_body=g,null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),i=["Contact: "+this.contact],b.reply(200,null,i),h=g.status_code<200?"progress":g.status_code<300?"started":"failed",console.log(c+this.id+" notify: "+h),"terminated"===this.subscription_state?(k=!0,this.close()):this.expire_timer=setTimeout(this.close.bind(this),1e3*(e.expires+a.Timers.T4)),void this.emit("notify",this,{originator:"remote",request:b,sipFrag:g,sessionEvent:h,finalNotify:k})):(console.warn(c+this.id+" dialog creation failed"),this.close(),void this.emit("failed",this,{originator:"remote",message:b,cause:a.C.causes.INTERNAL_ERROR})))):(b.reply(400,"Missing Subscription-State Header"),void this.close()):(b.reply(489),void this.close()))},b.prototype.receiveSubscribe=function(a){var b,e,f;return"incoming"!==this.direction?void a.reply(481):"active"!==this.subscription_state&&"terminated"!==this.subscription_state?void a.reply(403):(b=a.parseHeader("event"),b&&"refer"===b.event?(e=a.parseHeader("expires"),0===e?(console.log(c+this.id+" unsubscribed (expires=0)"),this.notify({body:this.last_notify_body,finalNotify:!0}),f=["Contact: "+this.contact],a.reply(200,null,f),void this.close()):(e=e>0?1e3*e:d,this.subscription_state="active",this.subscription_expires=Date.now()+e,null!==this.expire_timer&&clearTimeout(this.expire_timer),this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),e),f=["Contact: "+this.contact,"Expires: "+e/1e3],a.reply(200,null,f),void console.log(c+this.id+" subscription extended"))):void a.reply(489))},a.Refer=b}(d),function(a){var b;b=function(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.request=null,this.initEvents(b)},b.prototype=new a.EventEmitter,b.prototype.send=function(b,c,d){var e,f,g,h,i;if(this.direction="outgoing","active"!==this.session.subscription_state&&"pending"!==this.session.subscription_state)throw new a.Exceptions.InvalidStateError(this.session.subscription_state);d=d||{},h=d.extraHeaders?d.extraHeaders.slice():[],g=d.eventHandlers||{};for(f in g)this.on(f,g[f]);i=this.session.dialog.createRequest(a.C.NOTIFY,h),this.request=i,i.setHeader("contact",this.session.contact),i.setHeader("event",b),i.setHeader("subscription-state",c),d.content_type&&i.setHeader("content-type",d.content_type),d.body&&(i.body=d.body),e=new a.RequestSender(this,this.session.ua),this.session.emit("notify",this.session,{originator:"local",notify:this,request:i}),e.send()},b.prototype.receiveResponse=function(b){var c;if("terminated"!==this.session.subscription_state)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):
this.emit("succeeded",this,{originator:"remote",response:b});break;default:c=a.Utils.sipErrorCause(b.status_code),this.emit("failed",this,{originator:"remote",response:b,cause:c})}},b.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})},b.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})},a.Notify=b}(d),"object"==typeof c&&c&&"object"==typeof c.exports?c.exports=d:(b.JsSIP=d,"function"==typeof a&&a.amd&&a("jssip",[],function(){return d})),d.Grammar=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,e){function f(a){zd>xd||(xd>zd&&(zd=xd,Ad=[]),Ad.push(a))}function g(){var a;return"\r\n"===c.substr(xd,2)?(a="\r\n",xd+=2):(a=null,0===yd&&f('"\\r\\n"')),a}function h(){var a;return/^[0-9]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[0-9]")),a}function i(){var a;return/^[a-zA-Z]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[a-zA-Z]")),a}function j(){var a;return/^[0-9a-fA-F]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[0-9a-fA-F]")),a}function k(){var a;return a=n(),null===a&&(a=o()),a}function l(){var a;return/^[\0-\xFF]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[\\0-\\xFF]")),a}function m(){var a;return/^["]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f('["]')),a}function n(){var a;return 32===c.charCodeAt(xd)?(a=" ",xd++):(a=null,0===yd&&f('" "')),a}function o(){var a;return 9===c.charCodeAt(xd)?(a="	",xd++):(a=null,0===yd&&f('"\\t"')),a}function p(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[a-zA-Z0-9]")),a}function q(){var a;return 59===c.charCodeAt(xd)?(a=";",xd++):(a=null,0===yd&&f('";"')),null===a&&(47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"')),null===a&&(63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(64===c.charCodeAt(xd)?(a="@",xd++):(a=null,0===yd&&f('"@"')),null===a&&(38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","'))))))))))),a}function r(){var a;return a=p(),null===a&&(a=s()),a}function s(){var a;return 45===c.charCodeAt(xd)?(a="-",xd++):(a=null,0===yd&&f('"-"')),null===a&&(95===c.charCodeAt(xd)?(a="_",xd++):(a=null,0===yd&&f('"_"')),null===a&&(46===c.charCodeAt(xd)?(a=".",xd++):(a=null,0===yd&&f('"."')),null===a&&(33===c.charCodeAt(xd)?(a="!",xd++):(a=null,0===yd&&f('"!"')),null===a&&(126===c.charCodeAt(xd)?(a="~",xd++):(a=null,0===yd&&f('"~"')),null===a&&(42===c.charCodeAt(xd)?(a="*",xd++):(a=null,0===yd&&f('"*"')),null===a&&(39===c.charCodeAt(xd)?(a="'",xd++):(a=null,0===yd&&f('"\'"')),null===a&&(40===c.charCodeAt(xd)?(a="(",xd++):(a=null,0===yd&&f('"("')),null===a&&(41===c.charCodeAt(xd)?(a=")",xd++):(a=null,0===yd&&f('")"')))))))))),a}function t(){var a,b,d,e;return e=xd,37===c.charCodeAt(xd)?(a="%",xd++):(a=null,0===yd&&f('"%"')),null!==a?(b=j(),null!==b?(d=j(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function u(){var a,b,c,d,e,f;for(d=xd,e=xd,f=xd,a=[],b=k();null!==b;)a.push(b),b=k();if(null!==a?(b=g(),null!==b?a=[a,b]:(a=null,xd=f)):(a=null,xd=f),a=null!==a?a:"",null!==a){if(c=k(),null!==c)for(b=[];null!==c;)b.push(c),c=k();else b=null;null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return null!==a&&(a=function(){return" "}(d)),null===a&&(xd=d),a}function v(){var a;return a=u(),a=null!==a?a:""}function w(){var a,b,d,e,g;for(e=xd,g=xd,a=[],b=n(),null===b&&(b=o());null!==b;)a.push(b),b=n(),null===b&&(b=o());return null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return":"}(e)),null===a&&(xd=e),a}function x(){var a,b,d,e,f,g,h;if(f=xd,g=xd,b=y(),null!==b)for(a=[];null!==b;)a.push(b),b=y();else a=null;if(null!==a){for(b=[],h=xd,d=[],e=u();null!==e;)d.push(e),e=u();for(null!==d?(e=y(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==d;){for(b.push(d),h=xd,d=[],e=u();null!==e;)d.push(e),e=u();null!==d?(e=y(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h)}null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(a){return c.substring(xd,a)}(f)),null===a&&(xd=f),a}function y(){var a;return/^[!-~]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[!-~]")),null===a&&(a=z()),a}function z(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[\\x80-\\uFFFF]")),a}function A(){var a;return/^[\x80-\xBF]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[\\x80-\\xBF]")),a}function B(){var a;return a=h(),null===a&&(/^[a-f]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[a-f]"))),a}function C(){var a,b,d;if(d=xd,b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(xd,a)}(d)),null===a&&(xd=d),a}function D(){var a,b,d;if(d=xd,b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(xd,a)}(d)),null===a&&(xd=d),a}function E(){var a;return 40===c.charCodeAt(xd)?(a="(",xd++):(a=null,0===yd&&f('"("')),null===a&&(41===c.charCodeAt(xd)?(a=")",xd++):(a=null,0===yd&&f('")"')),null===a&&(60===c.charCodeAt(xd)?(a="<",xd++):(a=null,0===yd&&f('"<"')),null===a&&(62===c.charCodeAt(xd)?(a=">",xd++):(a=null,0===yd&&f('">"')),null===a&&(64===c.charCodeAt(xd)?(a="@",xd++):(a=null,0===yd&&f('"@"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","')),null===a&&(59===c.charCodeAt(xd)?(a=";",xd++):(a=null,0===yd&&f('";"')),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(92===c.charCodeAt(xd)?(a="\\",xd++):(a=null,0===yd&&f('"\\\\"')),null===a&&(a=m(),null===a&&(47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"')),null===a&&(91===c.charCodeAt(xd)?(a="[",xd++):(a=null,0===yd&&f('"["')),null===a&&(93===c.charCodeAt(xd)?(a="]",xd++):(a=null,0===yd&&f('"]"')),null===a&&(63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')),null===a&&(123===c.charCodeAt(xd)?(a="{",xd++):(a=null,0===yd&&f('"{"')),null===a&&(125===c.charCodeAt(xd)?(a="}",xd++):(a=null,0===yd&&f('"}"')),null===a&&(a=n(),null===a&&(a=o())))))))))))))))))),a}function F(){var a,b,d;if(d=xd,b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"')),null===b&&(40===c.charCodeAt(xd)?(b="(",xd++):(b=null,0===yd&&f('"("')),null===b&&(41===c.charCodeAt(xd)?(b=")",xd++):(b=null,0===yd&&f('")"')),null===b&&(60===c.charCodeAt(xd)?(b="<",xd++):(b=null,0===yd&&f('"<"')),null===b&&(62===c.charCodeAt(xd)?(b=">",xd++):(b=null,0===yd&&f('">"')),null===b&&(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null===b&&(92===c.charCodeAt(xd)?(b="\\",xd++):(b=null,0===yd&&f('"\\\\"')),null===b&&(b=m(),null===b&&(47===c.charCodeAt(xd)?(b="/",xd++):(b=null,0===yd&&f('"/"')),null===b&&(91===c.charCodeAt(xd)?(b="[",xd++):(b=null,0===yd&&f('"["')),null===b&&(93===c.charCodeAt(xd)?(b="]",xd++):(b=null,0===yd&&f('"]"')),null===b&&(63===c.charCodeAt(xd)?(b="?",xd++):(b=null,0===yd&&f('"?"')),null===b&&(123===c.charCodeAt(xd)?(b="{",xd++):(b=null,0===yd&&f('"{"')),null===b&&(125===c.charCodeAt(xd)?(b="}",xd++):(b=null,0===yd&&f('"}"'))))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=p(),null===b&&(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null===b&&(46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null===b&&(33===c.charCodeAt(xd)?(b="!",xd++):(b=null,0===yd&&f('"!"')),null===b&&(37===c.charCodeAt(xd)?(b="%",xd++):(b=null,0===yd&&f('"%"')),null===b&&(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null===b&&(95===c.charCodeAt(xd)?(b="_",xd++):(b=null,0===yd&&f('"_"')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(96===c.charCodeAt(xd)?(b="`",xd++):(b=null,0===yd&&f('"`"')),null===b&&(39===c.charCodeAt(xd)?(b="'",xd++):(b=null,0===yd&&f('"\'"')),null===b&&(126===c.charCodeAt(xd)?(b="~",xd++):(b=null,0===yd&&f('"~"')),null===b&&(40===c.charCodeAt(xd)?(b="(",xd++):(b=null,0===yd&&f('"("')),null===b&&(41===c.charCodeAt(xd)?(b=")",xd++):(b=null,0===yd&&f('")"')),null===b&&(60===c.charCodeAt(xd)?(b="<",xd++):(b=null,0===yd&&f('"<"')),null===b&&(62===c.charCodeAt(xd)?(b=">",xd++):(b=null,0===yd&&f('">"')),null===b&&(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null===b&&(92===c.charCodeAt(xd)?(b="\\",xd++):(b=null,0===yd&&f('"\\\\"')),null===b&&(b=m(),null===b&&(47===c.charCodeAt(xd)?(b="/",xd++):(b=null,0===yd&&f('"/"')),null===b&&(91===c.charCodeAt(xd)?(b="[",xd++):(b=null,0===yd&&f('"["')),null===b&&(93===c.charCodeAt(xd)?(b="]",xd++):(b=null,0===yd&&f('"]"')),null===b&&(63===c.charCodeAt(xd)?(b="?",xd++):(b=null,0===yd&&f('"?"')),null===b&&(123===c.charCodeAt(xd)?(b="{",xd++):(b=null,0===yd&&f('"{"')),null===b&&(125===c.charCodeAt(xd)?(b="}",xd++):(b=null,0===yd&&f('"}"')))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(xd,a)}(d)),null===a&&(xd=d),a}function G(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(42===c.charCodeAt(xd)?(b="*",xd++):(b=null,0===yd&&f('"*"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return"*"}(e)),null===a&&(xd=e),a}function H(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(47===c.charCodeAt(xd)?(b="/",xd++):(b=null,0===yd&&f('"/"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return"/"}(e)),null===a&&(xd=e),a}function I(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return"="}(e)),null===a&&(xd=e),a}function J(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(40===c.charCodeAt(xd)?(b="(",xd++):(b=null,0===yd&&f('"("')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return"("}(e)),null===a&&(xd=e),a}function K(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(41===c.charCodeAt(xd)?(b=")",xd++):(b=null,0===yd&&f('")"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return")"}(e)),null===a&&(xd=e),a}function L(){var a,b,d,e;return d=xd,e=xd,62===c.charCodeAt(xd)?(a=">",xd++):(a=null,0===yd&&f('">"')),null!==a?(b=v(),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(){return">"}(d)),null===a&&(xd=d),a}function M(){var a,b,d,e;return d=xd,e=xd,a=v(),null!==a?(60===c.charCodeAt(xd)?(b="<",xd++):(b=null,0===yd&&f('"<"')),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(){return"<"}(d)),null===a&&(xd=d),a}function N(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(44===c.charCodeAt(xd)?(b=",",xd++):(b=null,0===yd&&f('","')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return","}(e)),null===a&&(xd=e),a}function O(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(59===c.charCodeAt(xd)?(b=";",xd++):(b=null,0===yd&&f('";"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return";"}(e)),null===a&&(xd=e),a}function P(){var a,b,d,e,g;return e=xd,g=xd,a=v(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=v(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){return":"}(e)),null===a&&(xd=e),a}function Q(){var a,b,c,d;return c=xd,d=xd,a=v(),null!==a?(b=m(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),null!==a&&(a=function(){return'"'}(c)),null===a&&(xd=c),a}function R(){var a,b,c,d;return c=xd,d=xd,a=m(),null!==a?(b=v(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),null!==a&&(a=function(){return'"'}(c)),null===a&&(xd=c),a}function S(){var a,b,c,d;if(d=xd,a=J(),null!==a){for(b=[],c=T(),null===c&&(c=X(),null===c&&(c=S()));null!==c;)b.push(c),c=T(),null===c&&(c=X(),null===c&&(c=S()));null!==b?(c=K(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)}else a=null,xd=d;return a}function T(){var a;return/^[!-']/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[\\]-~]")),null===a&&(a=z(),null===a&&(a=u())))),a}function U(){var a,b,d,e,f,g;if(f=xd,g=xd,a=v(),null!==a)if(b=m(),null!==b){for(d=[],e=W(),null===e&&(e=X());null!==e;)d.push(e),e=W(),null===e&&(e=X());null!==d?(e=m(),null!==e?a=[a,b,d,e]:(a=null,xd=g)):(a=null,xd=g)}else a=null,xd=g;else a=null,xd=g;return null!==a&&(a=function(a){return c.substring(xd,a)}(f)),null===a&&(xd=f),a}function V(){var a,b,d,e,f,g;if(f=xd,g=xd,a=v(),null!==a)if(b=m(),null!==b){for(d=[],e=W(),null===e&&(e=X());null!==e;)d.push(e),e=W(),null===e&&(e=X());null!==d?(e=m(),null!==e?a=[a,b,d,e]:(a=null,xd=g)):(a=null,xd=g)}else a=null,xd=g;else a=null,xd=g;return null!==a&&(a=function(a){return c.substring(xd-1,a+1)}(f)),null===a&&(xd=f),a}function W(){var a;return a=u(),null===a&&(33===c.charCodeAt(xd)?(a="!",xd++):(a=null,0===yd&&f('"!"')),null===a&&(/^[#-[]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[\\]-~]")),null===a&&(a=z())))),a}function X(){var a,b,d;return d=xd,92===c.charCodeAt(xd)?(a="\\",xd++):(a=null,0===yd&&f('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a}function Y(){var a,b,e,g,h,i;return h=xd,i=xd,a=$(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(e=_(),e=null!==e?e:"",null!==e?(g=da(),null!==g?a=[a,b,e,g]:(a=null,xd=i)):(a=null,xd=i)):(a=null,xd=i)):(a=null,xd=i),null!==a&&(a=function(){try{Bd.uri=new d.URI(Bd.scheme,Bd.user,Bd.host,Bd.port),delete Bd.scheme,delete Bd.user,delete Bd.host,delete Bd.host_type,delete Bd.port}catch(a){Bd=-1}}(h)),null===a&&(xd=h),a}function Z(){var a,b,g,h,i,j,k,l;return k=xd,l=xd,a=$(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(g=_(),g=null!==g?g:"",null!==g?(h=da(),null!==h?(i=pa(),null!==i?(j=Ca(),j=null!==j?j:"",null!==j?a=[a,b,g,h,i,j]:(a=null,xd=l)):(a=null,xd=l)):(a=null,xd=l)):(a=null,xd=l)):(a=null,xd=l)):(a=null,xd=l),null!==a&&(a=function(){try{Bd.uri=new d.URI(Bd.scheme,Bd.user,Bd.host,Bd.port,Bd.uri_params,Bd.uri_headers),delete Bd.scheme,delete Bd.user,delete Bd.host,delete Bd.host_type,delete Bd.port,delete Bd.uri_params,"SIP_URI"===e&&(Bd=Bd.uri)}catch(a){Bd=-1}}(k)),null===a&&(xd=k),a}function $(){var a,b;return b=xd,"sip"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"sip"')),null!==a&&(a=function(a,b){Bd.scheme=b.toLowerCase()}(b,a)),null===a&&(xd=b),a}function _(){var a,d,e,g,h,i;return g=xd,h=xd,a=aa(),null!==a?(i=xd,58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ca(),null!==e?d=[d,e]:(d=null,xd=i)):(d=null,xd=i),d=null!==d?d:"",null!==d?(64===c.charCodeAt(xd)?(e="@",xd++):(e=null,0===yd&&f('"@"')),null!==e?a=[a,d,e]:(a=null,xd=h)):(a=null,xd=h)):(a=null,xd=h),null!==a&&(a=function(a){Bd.user=b.decodeURIComponent(c.substring(xd-1,a))}(g)),null===a&&(xd=g),a}function aa(){var a,b;if(b=r(),null===b&&(b=t(),null===b&&(b=ba())),null!==b)for(a=[];null!==b;)a.push(b),b=r(),null===b&&(b=t(),null===b&&(b=ba()));else a=null;return a}function ba(){var a;return 38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","')),null===a&&(59===c.charCodeAt(xd)?(a=";",xd++):(a=null,0===yd&&f('";"')),null===a&&(63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null===a&&(47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"'))))))))),a}function ca(){var a,b,d;for(d=xd,a=[],b=r(),null===b&&(b=t(),null===b&&(38===c.charCodeAt(xd)?(b="&",xd++):(b=null,0===yd&&f('"&"')),null===b&&(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(36===c.charCodeAt(xd)?(b="$",xd++):(b=null,0===yd&&f('"$"')),null===b&&(44===c.charCodeAt(xd)?(b=",",xd++):(b=null,0===yd&&f('","'))))))));null!==b;)a.push(b),b=r(),null===b&&(b=t(),null===b&&(38===c.charCodeAt(xd)?(b="&",xd++):(b=null,0===yd&&f('"&"')),null===b&&(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')),null===b&&(36===c.charCodeAt(xd)?(b="$",xd++):(b=null,0===yd&&f('"$"')),null===b&&(44===c.charCodeAt(xd)?(b=",",xd++):(b=null,0===yd&&f('","'))))))));return null!==a&&(a=function(a){Bd.password=c.substring(xd,a)}(d)),null===a&&(xd=d),a}function da(){var a,b,d,e,g;return e=xd,a=ea(),null!==a?(g=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=oa(),null!==d?b=[b,d]:(b=null,xd=g)):(b=null,xd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),a}function ea(){var a,b;return b=xd,a=fa(),null===a&&(a=ma(),null===a&&(a=ia())),null!==a&&(a=function(a){return Bd.host=c.substring(xd,a).toLowerCase(),Bd.host}(b)),null===a&&(xd=b),a}function fa(){var a,b,d,e,g,h;for(e=xd,g=xd,a=[],h=xd,b=ga(),null!==b?(46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."')),null!==d?b=[b,d]:(b=null,xd=h)):(b=null,xd=h);null!==b;)a.push(b),h=xd,b=ga(),null!==b?(46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."')),null!==d?b=[b,d]:(b=null,xd=h)):(b=null,xd=h);return null!==a?(b=ha(),null!==b?(46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a){return Bd.host_type="domain",c.substring(xd,a)}(e)),null===a&&(xd=e),a}function ga(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[a-zA-Z0-9_\\-]"));else a=null;return a}function ha(){var a,b;if(/^[a-zA-Z_\-]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[a-zA-Z_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z_\-]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[a-zA-Z_\\-]"));else a=null;return a}function ia(){var a,b,d,e,g;return e=xd,g=xd,91===c.charCodeAt(xd)?(a="[",xd++):(a=null,0===yd&&f('"["')),null!==a?(b=ja(),null!==b?(93===c.charCodeAt(xd)?(d="]",xd++):(d=null,0===yd&&f('"]"')),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a){return Bd.host_type="IPv6",c.substring(xd,a)}(e)),null===a&&(xd=e),a}function ja(){var a,b,d,e,g,h,i,j,k,l,m,n,o,p,q,r;return p=xd,q=xd,a=ka(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?(58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?(58===c.charCodeAt(xd)?(h=":",xd++):(h=null,0===yd&&f('":"')),null!==h?(i=ka(),null!==i?(58===c.charCodeAt(xd)?(j=":",xd++):(j=null,0===yd&&f('":"')),null!==j?(k=ka(),null!==k?(58===c.charCodeAt(xd)?(l=":",xd++):(l=null,0===yd&&f('":"')),null!==l?(m=ka(),null!==m?(58===c.charCodeAt(xd)?(n=":",xd++):(n=null,0===yd&&f('":"')),null!==n?(o=la(),null!==o?a=[a,b,d,e,g,h,i,j,k,l,m,n,o]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?(58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?(58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?(58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=ka(),null!==j?(58===c.charCodeAt(xd)?(k=":",xd++):(k=null,0===yd&&f('":"')),null!==k?(l=ka(),null!==l?(58===c.charCodeAt(xd)?(m=":",xd++):(m=null,0===yd&&f('":"')),null!==m?(n=la(),null!==n?a=[a,b,d,e,g,h,i,j,k,l,m,n]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?(58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?(58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?(58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=ka(),null!==j?(58===c.charCodeAt(xd)?(k=":",xd++):(k=null,0===yd&&f('":"')),null!==k?(l=la(),null!==l?a=[a,b,d,e,g,h,i,j,k,l]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?(58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?(58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?(58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=la(),null!==j?a=[a,b,d,e,g,h,i,j]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?(58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?(58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=la(),null!==h?a=[a,b,d,e,g,h]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?(58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=la(),null!==e?a=[a,b,d,e]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=la(),null!==b?a=[a,b]:(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,"::"===c.substr(xd,2)?(a="::",xd+=2):(a=null,0===yd&&f('"::"')),null!==a?(b=ka(),null!==b?a=[a,b]:(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?("::"===c.substr(xd,2)?(b="::",xd+=2):(b=null,0===yd&&f('"::"')),null!==b?(d=ka(),null!==d?(58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?(58===c.charCodeAt(xd)?(h=":",xd++):(h=null,0===yd&&f('":"')),null!==h?(i=ka(),null!==i?(58===c.charCodeAt(xd)?(j=":",xd++):(j=null,0===yd&&f('":"')),null!==j?(k=ka(),null!==k?(58===c.charCodeAt(xd)?(l=":",xd++):(l=null,0===yd&&f('":"')),null!==l?(m=la(),null!==m?a=[a,b,d,e,g,h,i,j,k,l,m]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?("::"===c.substr(xd,2)?(d="::",xd+=2):(d=null,0===yd&&f('"::"')),null!==d?(e=ka(),null!==e?(58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?(58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=ka(),null!==j?(58===c.charCodeAt(xd)?(k=":",xd++):(k=null,0===yd&&f('":"')),null!==k?(l=la(),null!==l?a=[a,b,d,e,g,h,i,j,k,l]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?(r=xd,58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?d=[d,e]:(d=null,xd=r)):(d=null,xd=r),d=null!==d?d:"",null!==d?("::"===c.substr(xd,2)?(e="::",xd+=2):(e=null,0===yd&&f('"::"')),null!==e?(g=ka(),null!==g?(58===c.charCodeAt(xd)?(h=":",xd++):(h=null,0===yd&&f('":"')),null!==h?(i=ka(),null!==i?(58===c.charCodeAt(xd)?(j=":",xd++):(j=null,0===yd&&f('":"')),null!==j?(k=la(),null!==k?a=[a,b,d,e,g,h,i,j,k]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?(r=xd,58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?d=[d,e]:(d=null,xd=r)):(d=null,xd=r),d=null!==d?d:"",null!==d?(r=xd,58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?e=[e,g]:(e=null,xd=r)):(e=null,xd=r),e=null!==e?e:"",null!==e?("::"===c.substr(xd,2)?(g="::",xd+=2):(g=null,0===yd&&f('"::"')),null!==g?(h=ka(),null!==h?(58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=la(),null!==j?a=[a,b,d,e,g,h,i,j]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?(r=xd,58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?d=[d,e]:(d=null,xd=r)):(d=null,xd=r),d=null!==d?d:"",null!==d?(r=xd,58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?e=[e,g]:(e=null,xd=r)):(e=null,xd=r),e=null!==e?e:"",null!==e?(r=xd,58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?g=[g,h]:(g=null,xd=r)):(g=null,xd=r),g=null!==g?g:"",null!==g?("::"===c.substr(xd,2)?(h="::",xd+=2):(h=null,0===yd&&f('"::"')),null!==h?(i=la(),null!==i?a=[a,b,d,e,g,h,i]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?(r=xd,58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?d=[d,e]:(d=null,xd=r)):(d=null,xd=r),d=null!==d?d:"",null!==d?(r=xd,58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?e=[e,g]:(e=null,xd=r)):(e=null,xd=r),e=null!==e?e:"",null!==e?(r=xd,58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?g=[g,h]:(g=null,xd=r)):(g=null,xd=r),g=null!==g?g:"",null!==g?(r=xd,58===c.charCodeAt(xd)?(h=":",xd++):(h=null,0===yd&&f('":"')),null!==h?(i=ka(),null!==i?h=[h,i]:(h=null,xd=r)):(h=null,xd=r),h=null!==h?h:"",null!==h?("::"===c.substr(xd,2)?(i="::",xd+=2):(i=null,0===yd&&f('"::"')),null!==i?(j=ka(),null!==j?a=[a,b,d,e,g,h,i,j]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q),null===a&&(q=xd,a=ka(),null!==a?(r=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?b=[b,d]:(b=null,xd=r)):(b=null,xd=r),b=null!==b?b:"",null!==b?(r=xd,
58===c.charCodeAt(xd)?(d=":",xd++):(d=null,0===yd&&f('":"')),null!==d?(e=ka(),null!==e?d=[d,e]:(d=null,xd=r)):(d=null,xd=r),d=null!==d?d:"",null!==d?(r=xd,58===c.charCodeAt(xd)?(e=":",xd++):(e=null,0===yd&&f('":"')),null!==e?(g=ka(),null!==g?e=[e,g]:(e=null,xd=r)):(e=null,xd=r),e=null!==e?e:"",null!==e?(r=xd,58===c.charCodeAt(xd)?(g=":",xd++):(g=null,0===yd&&f('":"')),null!==g?(h=ka(),null!==h?g=[g,h]:(g=null,xd=r)):(g=null,xd=r),g=null!==g?g:"",null!==g?(r=xd,58===c.charCodeAt(xd)?(h=":",xd++):(h=null,0===yd&&f('":"')),null!==h?(i=ka(),null!==i?h=[h,i]:(h=null,xd=r)):(h=null,xd=r),h=null!==h?h:"",null!==h?(r=xd,58===c.charCodeAt(xd)?(i=":",xd++):(i=null,0===yd&&f('":"')),null!==i?(j=ka(),null!==j?i=[i,j]:(i=null,xd=r)):(i=null,xd=r),i=null!==i?i:"",null!==i?("::"===c.substr(xd,2)?(j="::",xd+=2):(j=null,0===yd&&f('"::"')),null!==j?a=[a,b,d,e,g,h,i,j]:(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q)):(a=null,xd=q))))))))))))))),null!==a&&(a=function(a){return Bd.host_type="IPv6",c.substring(xd,a)}(p)),null===a&&(xd=p),a}function ka(){var a,b,c,d,e;return e=xd,a=j(),null!==a?(b=j(),b=null!==b?b:"",null!==b?(c=j(),c=null!==c?c:"",null!==c?(d=j(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function la(){var a,b,d,e;return e=xd,a=ka(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=ka(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),null===a&&(a=ma()),a}function ma(){var a,b,d,e,g,h,i,j,k;return j=xd,k=xd,a=na(),null!==a?(46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null!==b?(d=na(),null!==d?(46===c.charCodeAt(xd)?(e=".",xd++):(e=null,0===yd&&f('"."')),null!==e?(g=na(),null!==g?(46===c.charCodeAt(xd)?(h=".",xd++):(h=null,0===yd&&f('"."')),null!==h?(i=na(),null!==i?a=[a,b,d,e,g,h,i]:(a=null,xd=k)):(a=null,xd=k)):(a=null,xd=k)):(a=null,xd=k)):(a=null,xd=k)):(a=null,xd=k)):(a=null,xd=k),null!==a&&(a=function(a){return Bd.host_type="IPv4",c.substring(xd,a)}(j)),null===a&&(xd=j),a}function na(){var a,b,d,e;return e=xd,"25"===c.substr(xd,2)?(a="25",xd+=2):(a=null,0===yd&&f('"25"')),null!==a?(/^[0-5]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[0-5]")),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null===a&&(e=xd,50===c.charCodeAt(xd)?(a="2",xd++):(a=null,0===yd&&f('"2"')),null!==a?(/^[0-4]/.test(c.charAt(xd))?(b=c.charAt(xd),xd++):(b=null,0===yd&&f("[0-4]")),null!==b?(d=h(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),null===a&&(e=xd,49===c.charCodeAt(xd)?(a="1",xd++):(a=null,0===yd&&f('"1"')),null!==a?(b=h(),null!==b?(d=h(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),null===a&&(e=xd,/^[1-9]/.test(c.charAt(xd))?(a=c.charAt(xd),xd++):(a=null,0===yd&&f("[1-9]")),null!==a?(b=h(),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null===a&&(a=h())))),a}function oa(){var a,b,c,d,e,f,g;return f=xd,g=xd,a=h(),a=null!==a?a:"",null!==a?(b=h(),b=null!==b?b:"",null!==b?(c=h(),c=null!==c?c:"",null!==c?(d=h(),d=null!==d?d:"",null!==d?(e=h(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),Bd.port=b,b}(f,a)),null===a&&(xd=f),a}function pa(){var a,b,d,e;for(a=[],e=xd,59===c.charCodeAt(xd)?(b=";",xd++):(b=null,0===yd&&f('";"')),null!==b?(d=qa(),null!==d?b=[b,d]:(b=null,xd=e)):(b=null,xd=e);null!==b;)a.push(b),e=xd,59===c.charCodeAt(xd)?(b=";",xd++):(b=null,0===yd&&f('";"')),null!==b?(d=qa(),null!==d?b=[b,d]:(b=null,xd=e)):(b=null,xd=e);return a}function qa(){var a;return a=ra(),null===a&&(a=sa(),null===a&&(a=ta(),null===a&&(a=ua(),null===a&&(a=va(),null===a&&(a=wa(),null===a&&(a=xa())))))),a}function ra(){var a,b,d,e;return d=xd,e=xd,"transport="===c.substr(xd,10).toLowerCase()?(a=c.substr(xd,10),xd+=10):(a=null,0===yd&&f('"transport="')),null!==a?("udp"===c.substr(xd,3).toLowerCase()?(b=c.substr(xd,3),xd+=3):(b=null,0===yd&&f('"udp"')),null===b&&("tcp"===c.substr(xd,3).toLowerCase()?(b=c.substr(xd,3),xd+=3):(b=null,0===yd&&f('"tcp"')),null===b&&("sctp"===c.substr(xd,4).toLowerCase()?(b=c.substr(xd,4),xd+=4):(b=null,0===yd&&f('"sctp"')),null===b&&("tls"===c.substr(xd,3).toLowerCase()?(b=c.substr(xd,3),xd+=3):(b=null,0===yd&&f('"tls"')),null===b&&(b=C())))),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){Bd.uri_params||(Bd.uri_params={}),Bd.uri_params.transport=b.toLowerCase()}(d,a[1])),null===a&&(xd=d),a}function sa(){var a,b,d,e;return d=xd,e=xd,"user="===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"user="')),null!==a?("phone"===c.substr(xd,5).toLowerCase()?(b=c.substr(xd,5),xd+=5):(b=null,0===yd&&f('"phone"')),null===b&&("ip"===c.substr(xd,2).toLowerCase()?(b=c.substr(xd,2),xd+=2):(b=null,0===yd&&f('"ip"')),null===b&&(b=C())),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){Bd.uri_params||(Bd.uri_params={}),Bd.uri_params.user=b.toLowerCase()}(d,a[1])),null===a&&(xd=d),a}function ta(){var a,b,d,e;return d=xd,e=xd,"method="===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"method="')),null!==a?(b=hb(),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){Bd.uri_params||(Bd.uri_params={}),Bd.uri_params.method=b}(d,a[1])),null===a&&(xd=d),a}function ua(){var a,b,d,e;return d=xd,e=xd,"ttl="===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"ttl="')),null!==a?(b=bd(),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){Bd.params||(Bd.params={}),Bd.params.ttl=b}(d,a[1])),null===a&&(xd=d),a}function va(){var a,b,d,e;return d=xd,e=xd,"maddr="===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"maddr="')),null!==a?(b=ea(),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){Bd.uri_params||(Bd.uri_params={}),Bd.uri_params.maddr=b}(d,a[1])),null===a&&(xd=d),a}function wa(){var a,b,d,e,g,h;return e=xd,g=xd,"lr"===c.substr(xd,2).toLowerCase()?(a=c.substr(xd,2),xd+=2):(a=null,0===yd&&f('"lr"')),null!==a?(h=xd,61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null!==b?(d=C(),null!==d?b=[b,d]:(b=null,xd=h)):(b=null,xd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(){Bd.uri_params||(Bd.uri_params={}),Bd.uri_params.lr=void 0}(e)),null===a&&(xd=e),a}function xa(){var a,b,d,e,g,h;return e=xd,g=xd,a=ya(),null!==a?(h=xd,61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null!==b?(d=za(),null!==d?b=[b,d]:(b=null,xd=h)):(b=null,xd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b,c){Bd.uri_params||(Bd.uri_params={}),c="undefined"==typeof c?void 0:c[1],Bd.uri_params[b.toLowerCase()]=c&&c.toLowerCase()}(e,a[0],a[1])),null===a&&(xd=e),a}function ya(){var a,b,c;if(c=xd,b=Aa(),null!==b)for(a=[];null!==b;)a.push(b),b=Aa();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(xd=c),a}function za(){var a,b,c;if(c=xd,b=Aa(),null!==b)for(a=[];null!==b;)a.push(b),b=Aa();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(xd=c),a}function Aa(){var a;return a=Ba(),null===a&&(a=r(),null===a&&(a=t())),a}function Ba(){var a;return 91===c.charCodeAt(xd)?(a="[",xd++):(a=null,0===yd&&f('"["')),null===a&&(93===c.charCodeAt(xd)?(a="]",xd++):(a=null,0===yd&&f('"]"')),null===a&&(47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"')),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')))))))),a}function Ca(){var a,b,d,e,g,h,i;if(h=xd,63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null!==a)if(b=Da(),null!==b){for(d=[],i=xd,38===c.charCodeAt(xd)?(e="&",xd++):(e=null,0===yd&&f('"&"')),null!==e?(g=Da(),null!==g?e=[e,g]:(e=null,xd=i)):(e=null,xd=i);null!==e;)d.push(e),i=xd,38===c.charCodeAt(xd)?(e="&",xd++):(e=null,0===yd&&f('"&"')),null!==e?(g=Da(),null!==g?e=[e,g]:(e=null,xd=i)):(e=null,xd=i);null!==d?a=[a,b,d]:(a=null,xd=h)}else a=null,xd=h;else a=null,xd=h;return a}function Da(){var a,b,d,e,g;return e=xd,g=xd,a=Ea(),null!==a?(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null!==b?(d=Fa(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),Bd.uri_headers||(Bd.uri_headers={}),Bd.uri_headers[b]?Bd.uri_headers[b].push(c):Bd.uri_headers[b]=[c]}(e,a[0],a[2])),null===a&&(xd=e),a}function Ea(){var a,b;if(b=Ga(),null===b&&(b=r(),null===b&&(b=t())),null!==b)for(a=[];null!==b;)a.push(b),b=Ga(),null===b&&(b=r(),null===b&&(b=t()));else a=null;return a}function Fa(){var a,b;for(a=[],b=Ga(),null===b&&(b=r(),null===b&&(b=t()));null!==b;)a.push(b),b=Ga(),null===b&&(b=r(),null===b&&(b=t()));return a}function Ga(){var a;return 91===c.charCodeAt(xd)?(a="[",xd++):(a=null,0===yd&&f('"["')),null===a&&(93===c.charCodeAt(xd)?(a="]",xd++):(a=null,0===yd&&f('"]"')),null===a&&(47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"')),null===a&&(63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')))))))),a}function Ha(){var a;return a=ib(),null===a&&(a=Ia()),a}function Ia(){var a,b,c,d,e,f;return f=xd,a=hb(),null!==a?(b=n(),null!==b?(c=Ja(),null!==c?(d=n(),null!==d?(e=$a(),null!==e?a=[a,b,c,d,e]:(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f),a}function Ja(){var a;return a=Z(),null===a&&(a=Ka()),a}function Ka(){var a,b,d,e;return e=xd,a=Va(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=La(),null===d&&(d=Oa()),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function La(){var a,b,d,e,g;return e=xd,a=Ma(),null===a&&(a=Na()),null!==a?(g=xd,63===c.charCodeAt(xd)?(b="?",xd++):(b=null,0===yd&&f('"?"')),null!==b?(d=Za(),null!==d?b=[b,d]:(b=null,xd=g)):(b=null,xd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),a}function Ma(){var a,b,d,e;return e=xd,"//"===c.substr(xd,2)?(a="//",xd+=2):(a=null,0===yd&&f('"//"')),null!==a?(b=Wa(),null!==b?(d=Na(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function Na(){var a,b,d;return d=xd,47===c.charCodeAt(xd)?(a="/",xd++):(a=null,0===yd&&f('"/"')),null!==a?(b=Ra(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a}function Oa(){var a,b,c,d;if(d=xd,a=Qa(),null!==a){for(b=[],c=Pa();null!==c;)b.push(c),c=Pa();null!==b?a=[a,b]:(a=null,xd=d)}else a=null,xd=d;return a}function Pa(){var a;return a=q(),null===a&&(a=r(),null===a&&(a=t())),a}function Qa(){var a;return a=r(),null===a&&(a=t(),null===a&&(59===c.charCodeAt(xd)?(a=";",xd++):(a=null,0===yd&&f('";"')),null===a&&(63===c.charCodeAt(xd)?(a="?",xd++):(a=null,0===yd&&f('"?"')),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(64===c.charCodeAt(xd)?(a="@",xd++):(a=null,0===yd&&f('"@"')),null===a&&(38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","')))))))))))),a}function Ra(){var a,b,d,e,g,h;if(g=xd,a=Sa(),null!==a){for(b=[],h=xd,47===c.charCodeAt(xd)?(d="/",xd++):(d=null,0===yd&&f('"/"')),null!==d?(e=Sa(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==d;)b.push(d),h=xd,47===c.charCodeAt(xd)?(d="/",xd++):(d=null,0===yd&&f('"/"')),null!==d?(e=Sa(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return a}function Sa(){var a,b,d,e,g,h;for(g=xd,a=[],b=Ua();null!==b;)a.push(b),b=Ua();if(null!==a){for(b=[],h=xd,59===c.charCodeAt(xd)?(d=";",xd++):(d=null,0===yd&&f('";"')),null!==d?(e=Ta(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==d;)b.push(d),h=xd,59===c.charCodeAt(xd)?(d=";",xd++):(d=null,0===yd&&f('";"')),null!==d?(e=Ta(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return a}function Ta(){var a,b;for(a=[],b=Ua();null!==b;)a.push(b),b=Ua();return a}function Ua(){var a;return a=r(),null===a&&(a=t(),null===a&&(58===c.charCodeAt(xd)?(a=":",xd++):(a=null,0===yd&&f('":"')),null===a&&(64===c.charCodeAt(xd)?(a="@",xd++):(a=null,0===yd&&f('"@"')),null===a&&(38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","')))))))))),a}function Va(){var a,b,d,e,g;if(e=xd,g=xd,a=i(),null!==a){for(b=[],d=i(),null===d&&(d=h(),null===d&&(43===c.charCodeAt(xd)?(d="+",xd++):(d=null,0===yd&&f('"+"')),null===d&&(45===c.charCodeAt(xd)?(d="-",xd++):(d=null,0===yd&&f('"-"')),null===d&&(46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."'))))));null!==d;)b.push(d),d=i(),null===d&&(d=h(),null===d&&(43===c.charCodeAt(xd)?(d="+",xd++):(d=null,0===yd&&f('"+"')),null===d&&(45===c.charCodeAt(xd)?(d="-",xd++):(d=null,0===yd&&f('"-"')),null===d&&(46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."'))))));null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(a){Bd.scheme=c.substring(xd,a)}(e)),null===a&&(xd=e),a}function Wa(){var a;return a=Xa(),null===a&&(a=Ya()),a}function Xa(){var a,b,d,e;return d=xd,e=xd,a=_(),null!==a?(64===c.charCodeAt(xd)?(b="@",xd++):(b=null,0===yd&&f('"@"')),null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),a=null!==a?a:"",null!==a?(b=da(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a=null!==a?a:""}function Ya(){var a,b;if(b=r(),null===b&&(b=t(),null===b&&(36===c.charCodeAt(xd)?(b="$",xd++):(b=null,0===yd&&f('"$"')),null===b&&(44===c.charCodeAt(xd)?(b=",",xd++):(b=null,0===yd&&f('","')),null===b&&(59===c.charCodeAt(xd)?(b=";",xd++):(b=null,0===yd&&f('";"')),null===b&&(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null===b&&(64===c.charCodeAt(xd)?(b="@",xd++):(b=null,0===yd&&f('"@"')),null===b&&(38===c.charCodeAt(xd)?(b="&",xd++):(b=null,0===yd&&f('"&"')),null===b&&(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=r(),null===b&&(b=t(),null===b&&(36===c.charCodeAt(xd)?(b="$",xd++):(b=null,0===yd&&f('"$"')),null===b&&(44===c.charCodeAt(xd)?(b=",",xd++):(b=null,0===yd&&f('","')),null===b&&(59===c.charCodeAt(xd)?(b=";",xd++):(b=null,0===yd&&f('";"')),null===b&&(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null===b&&(64===c.charCodeAt(xd)?(b="@",xd++):(b=null,0===yd&&f('"@"')),null===b&&(38===c.charCodeAt(xd)?(b="&",xd++):(b=null,0===yd&&f('"&"')),null===b&&(61===c.charCodeAt(xd)?(b="=",xd++):(b=null,0===yd&&f('"="')),null===b&&(43===c.charCodeAt(xd)?(b="+",xd++):(b=null,0===yd&&f('"+"')))))))))));else a=null;return a}function Za(){var a,b;for(a=[],b=Pa();null!==b;)a.push(b),b=Pa();return a}function $a(){var a,b,d,e,g,i,j,k;if(j=xd,k=xd,"sip"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"SIP"')),null!==a)if(47===c.charCodeAt(xd)?(b="/",xd++):(b=null,0===yd&&f('"/"')),null!==b){if(e=h(),null!==e)for(d=[];null!==e;)d.push(e),e=h();else d=null;if(null!==d)if(46===c.charCodeAt(xd)?(e=".",xd++):(e=null,0===yd&&f('"."')),null!==e){if(i=h(),null!==i)for(g=[];null!==i;)g.push(i),i=h();else g=null;null!==g?a=[a,b,d,e,g]:(a=null,xd=k)}else a=null,xd=k;else a=null,xd=k}else a=null,xd=k;else a=null,xd=k;return null!==a&&(a=function(a){Bd.sip_version=c.substring(xd,a)}(j)),null===a&&(xd=j),a}function _a(){var a;return"INVITE"===c.substr(xd,6)?(a="INVITE",xd+=6):(a=null,0===yd&&f('"INVITE"')),a}function ab(){var a;return"ACK"===c.substr(xd,3)?(a="ACK",xd+=3):(a=null,0===yd&&f('"ACK"')),a}function bb(){var a;return"OPTIONS"===c.substr(xd,7)?(a="OPTIONS",xd+=7):(a=null,0===yd&&f('"OPTIONS"')),a}function cb(){var a;return"BYE"===c.substr(xd,3)?(a="BYE",xd+=3):(a=null,0===yd&&f('"BYE"')),a}function db(){var a;return"CANCEL"===c.substr(xd,6)?(a="CANCEL",xd+=6):(a=null,0===yd&&f('"CANCEL"')),a}function eb(){var a;return"REGISTER"===c.substr(xd,8)?(a="REGISTER",xd+=8):(a=null,0===yd&&f('"REGISTER"')),a}function fb(){var a;return"SUBSCRIBE"===c.substr(xd,9)?(a="SUBSCRIBE",xd+=9):(a=null,0===yd&&f('"SUBSCRIBE"')),a}function gb(){var a;return"NOTIFY"===c.substr(xd,6)?(a="NOTIFY",xd+=6):(a=null,0===yd&&f('"NOTIFY"')),a}function hb(){var a,b;return b=xd,a=_a(),null===a&&(a=ab(),null===a&&(a=bb(),null===a&&(a=cb(),null===a&&(a=db(),null===a&&(a=eb(),null===a&&(a=fb(),null===a&&(a=gb(),null===a&&(a=C())))))))),null!==a&&(a=function(a){return Bd.method=c.substring(xd,a),Bd.method}(b)),null===a&&(xd=b),a}function ib(){var a,b,c,d,e,f;return f=xd,a=$a(),null!==a?(b=n(),null!==b?(c=jb(),null!==c?(d=n(),null!==d?(e=lb(),null!==e?a=[a,b,c,d,e]:(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f),a}function jb(){var a,b;return b=xd,a=kb(),null!==a&&(a=function(a,b){Bd.status_code=parseInt(b.join(""))}(b,a)),null===a&&(xd=b),a}function kb(){var a,b,c,d;return d=xd,a=h(),null!==a?(b=h(),null!==b?(c=h(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function lb(){var a,b,d;for(d=xd,a=[],b=q(),null===b&&(b=r(),null===b&&(b=t(),null===b&&(b=z(),null===b&&(b=A(),null===b&&(b=n(),null===b&&(b=o()))))));null!==b;)a.push(b),b=q(),null===b&&(b=r(),null===b&&(b=t(),null===b&&(b=z(),null===b&&(b=A(),null===b&&(b=n(),null===b&&(b=o()))))));return null!==a&&(a=function(a){Bd.reason_phrase=c.substring(xd,a)}(d)),null===a&&(xd=d),a}function mb(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=nb(),null!==a){for(b=[],g=xd,c=N(),null!==c?(d=nb(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=N(),null!==c?(d=nb(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(){Bd=Bd.methods}(e)),null===a&&(xd=e),a}function nb(){var a,b;return b=xd,a=hb(),null!==a&&(a=function(a,b){Bd.methods||(Bd.methods=[]),Bd.methods.push(b)}(b,a)),null===a&&(xd=b),a}function ob(){var a,b,c,d,e,f;if(e=xd,a=Wb(),null!==a){for(b=[],f=xd,c=N(),null!==c?(d=Wb(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=N(),null!==c?(d=Wb(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function pb(){var a,b;return b=xd,a=qb(),null!==a&&(a=function(a,b){Bd=b}(b,a)),null===a&&(xd=b),a}function qb(){var a,b,d,e,g,h;return e=xd,g=xd,a=F(),null!==a?(h=xd,64===c.charCodeAt(xd)?(b="@",xd++):(b=null,0===yd&&f('"@"')),null!==b?(d=F(),null!==d?b=[b,d]:(b=null,xd=h)):(b=null,xd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a){return c.substring(xd,a)}(e)),null===a&&(xd=e),a}function rb(){var a,b,c,d,e,f,g;if(e=xd,a=G(),null===a)if(f=xd,a=sb(),null!==a){for(b=[],g=xd,c=N(),null!==c?(d=sb(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=N(),null!==c?(d=sb(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(){var a;for(a in Bd.multi_header)if(null===Bd.multi_header[a].parsed){Bd=null;break}Bd=null!==Bd?Bd.multi_header:-1}(e)),null===a&&(xd=e),a}function sb(){var a,b,c,e,f,g,h;if(f=xd,g=xd,a=Y(),null===a&&(a=tb()),null!==a){for(b=[],h=xd,c=O(),null!==c?(e=vb(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==c;)b.push(c),h=xd,c=O(),null!==c?(e=vb(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(a){var b;Bd.multi_header||(Bd.multi_header=[]);try{b=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params),delete Bd.uri,delete Bd.display_name,delete Bd.params}catch(c){b=null}Bd.multi_header.push({possition:xd,offset:a,parsed:b})}(f)),null===a&&(xd=f),a}function tb(){var a,b,c,d,e;return e=xd,a=ub(),a=null!==a?a:"",null!==a?(b=M(),null!==b?(c=Z(),null!==c?(d=L(),null!==d?a=[a,b,c,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function ub(){var a,b,d,e,f,g,h;if(f=xd,g=xd,a=C(),null!==a){for(b=[],h=xd,d=u(),null!==d?(e=C(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==d;)b.push(d),h=xd,d=u(),null!==d?(e=C(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null===a&&(a=U()),null!==a&&(a=function(a,b){b=c.substring(xd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),Bd.display_name=b}(f,a)),null===a&&(xd=f),a}function vb(){var a;return a=wb(),null===a&&(a=xb(),null===a&&(a=Ab())),a}function wb(){var a,b,d,e,g;return e=xd,g=xd,"q"===c.substr(xd,1).toLowerCase()?(a=c.substr(xd,1),xd++):(a=null,0===yd&&f('"q"')),null!==a?(b=I(),null!==b?(d=zb(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.params||(Bd.params={}),Bd.params.q=b}(e,a[2])),null===a&&(xd=e),a}function xb(){var a,b,d,e,g;return e=xd,g=xd,"expires"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"expires"')),null!==a?(b=I(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.params||(Bd.params={}),Bd.params.expires=b}(e,a[2])),null===a&&(xd=e),a}function yb(){var a,b,c;if(c=xd,b=h(),null!==b)for(a=[];null!==b;)a.push(b),b=h();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(c,a)),null===a&&(xd=c),a}function zb(){var a,b,d,e,g,i,j,k;return i=xd,j=xd,48===c.charCodeAt(xd)?(a="0",xd++):(a=null,0===yd&&f('"0"')),null!==a?(k=xd,46===c.charCodeAt(xd)?(b=".",xd++):(b=null,0===yd&&f('"."')),null!==b?(d=h(),d=null!==d?d:"",null!==d?(e=h(),e=null!==e?e:"",null!==e?(g=h(),g=null!==g?g:"",null!==g?b=[b,d,e,g]:(b=null,xd=k)):(b=null,xd=k)):(b=null,xd=k)):(b=null,xd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=j)):(a=null,xd=j),null!==a&&(a=function(a){return parseFloat(c.substring(xd,a))}(i)),null===a&&(xd=i),a}function Ab(){var a,b,c,d,e,f;return d=xd,e=xd,a=C(),null!==a?(f=xd,b=I(),null!==b?(c=Bb(),null!==c?b=[b,c]:(b=null,xd=f)):(b=null,xd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b,c){Bd.params||(Bd.params={}),c="undefined"==typeof c?void 0:c[1],Bd.params[b.toLowerCase()]=c}(d,a[0],a[1])),null===a&&(xd=d),a}function Bb(){var a;return a=C(),null===a&&(a=ea(),null===a&&(a=U())),a}function Cb(){var a,b,c,d,e,f;if(e=xd,a=Db(),null!==a){for(b=[],f=xd,c=O(),null!==c?(d=Eb(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=O(),null!==c?(d=Eb(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function Db(){var a;return"render"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"render"')),null===a&&("session"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"session"')),null===a&&("icon"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"icon"')),null===a&&("alert"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"alert"')),null===a&&(a=C())))),a}function Eb(){var a;return a=Fb(),null===a&&(a=Ab()),a}function Fb(){var a,b,d,e;return e=xd,"handling"===c.substr(xd,8).toLowerCase()?(a=c.substr(xd,8),xd+=8):(a=null,0===yd&&f('"handling"')),null!==a?(b=I(),null!==b?("optional"===c.substr(xd,8).toLowerCase()?(d=c.substr(xd,8),xd+=8):(d=null,0===yd&&f('"optional"')),null===d&&("required"===c.substr(xd,8).toLowerCase()?(d=c.substr(xd,8),xd+=8):(d=null,0===yd&&f('"required"')),null===d&&(d=C())),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function Gb(){var a,b,c,d,e,f;if(e=xd,a=C(),null!==a){for(b=[],f=xd,c=N(),null!==c?(d=C(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=N(),null!==c?(d=C(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function Hb(){var a,b,c;if(c=xd,b=h(),null!==b)for(a=[];null!==b;)a.push(b),b=h();else a=null;return null!==a&&(a=function(a,b){Bd=parseInt(b.join(""))}(c,a)),null===a&&(xd=c),a}function Ib(){var a,b;return b=xd,a=Jb(),null!==a&&(a=function(a){Bd=c.substring(xd,a)}(b)),null===a&&(xd=b),a}function Jb(){var a,b,c,d,e,f,g,h;if(g=xd,a=Kb(),null!==a)if(b=H(),null!==b)if(c=Pb(),null!==c){for(d=[],h=xd,e=O(),null!==e?(f=Qb(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==e;)d.push(e),h=xd,e=O(),null!==e?(f=Qb(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==d?a=[a,b,c,d]:(a=null,xd=g)}else a=null,xd=g;else a=null,xd=g;else a=null,xd=g;return a}function Kb(){var a;return a=Lb(),null===a&&(a=Mb()),a}function Lb(){var a;return"text"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"text"')),null===a&&("image"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"image"')),null===a&&("audio"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"audio"')),null===a&&("index"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"video"')),null===a&&("application"===c.substr(xd,11).toLowerCase()?(a=c.substr(xd,11),xd+=11):(a=null,0===yd&&f('"application"')),null===a&&(a=Nb()))))),a}function Mb(){var a;return"message"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"message"')),null===a&&("multipart"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"multipart"')),null===a&&(a=Nb())),a}function Nb(){var a;return a=C(),null===a&&(a=Ob()),a}function Ob(){var a,b,d;return d=xd,"x-"===c.substr(xd,2).toLowerCase()?(a=c.substr(xd,2),xd+=2):(a=null,0===yd&&f('"x-"')),null!==a?(b=C(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a}function Pb(){var a;return a=Nb(),null===a&&(a=C()),a}function Qb(){var a,b,c,d;return d=xd,a=C(),null!==a?(b=I(),null!==b?(c=Rb(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function Rb(){var a;return a=C(),null===a&&(a=U()),a}function Sb(){var a,b,c,d;return d=xd,a=Tb(),null!==a?(b=u(),null!==b?(c=hb(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function Tb(){var a,b,c;if(c=xd,b=h(),null!==b)for(a=[];null!==b;)a.push(b),b=h();else a=null;return null!==a&&(a=function(a,b){Bd.value=parseInt(b.join(""))}(c,a)),null===a&&(xd=c),a}function Ub(){var a,b;return b=xd,a=yb(),null!==a&&(a=function(a,b){Bd=b}(b,a)),null===a&&(xd=b),a}function Vb(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=Wb(),null!==a){for(b=[],g=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(a,b){Bd.event=b.join("").toLowerCase()}(e,a[0])),null===a&&(xd=e),a}function Wb(){var a,b,d,e,g,h;if(g=xd,a=D(),null!==a){for(b=[],h=xd,46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."')),null!==d?(e=D(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==d;)b.push(d),h=xd,46===c.charCodeAt(xd)?(d=".",xd++):(d=null,0===yd&&f('"."')),null!==d?(e=D(),null!==e?d=[d,e]:(d=null,xd=h)):(d=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return a}function Xb(){var a,b,c,e,f,g,h;if(f=xd,g=xd,a=Y(),null===a&&(a=tb()),null!==a){for(b=[],h=xd,c=O(),null!==c?(e=Yb(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==c;)b.push(c),h=xd,c=O(),null!==c?(e=Yb(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(){var a=Bd.tag;try{Bd=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params),a&&Bd.setParam("tag",a)}catch(b){Bd=-1}}(f)),null===a&&(xd=f),a}function Yb(){var a;return a=Zb(),null===a&&(a=Ab()),a}function Zb(){var a,b,d,e,g;return e=xd,g=xd,"tag"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"tag"')),null!==a?(b=I(),null!==b?(d=C(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.tag=b}(e,a[2])),null===a&&(xd=e),a}function $b(){var a,b,c;if(c=xd,b=h(),null!==b)for(a=[];null!==b;)a.push(b),b=h();else a=null;return null!==a&&(a=function(a,b){Bd=parseInt(b.join(""))}(c,a)),null===a&&(xd=c),a}function _b(){var a,b;return b=xd,a=yb(),null!==a&&(a=function(a,b){Bd=b}(b,a)),null===a&&(xd=b),a}function ac(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=yb(),null!==a){for(b=[],g=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(a,b){Bd=b>=90?b:-1}(e,a[0])),null===a&&(xd=e),a}function bc(){var a,b,c,e,f,g,h,i,j,k;for(i=xd,j=xd,a=[],b=ub();null!==b;)a.push(b),b=ub();if(null!==a)if(b=M(),null!==b)if(c=Z(),null!==c)if(e=L(),null!==e){for(f=[],k=xd,g=O(),null!==g?(h=Ab(),null!==h?g=[g,h]:(g=null,xd=k)):(g=null,xd=k);null!==g;)f.push(g),k=xd,g=O(),null!==g?(h=Ab(),null!==h?g=[g,h]:(g=null,xd=k)):(g=null,xd=k);null!==f?a=[a,b,c,e,f]:(a=null,xd=j)}else a=null,xd=j;else a=null,xd=j;else a=null,xd=j;else a=null,xd=j;return null!==a&&(a=function(){try{Bd=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params)}catch(a){Bd=-1}}(i)),null===a&&(xd=i),a}function cc(){var a;return a=dc()}function dc(){var a,b,d,e,g,h,i,j;if(i=xd,"digest"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"Digest"')),null!==a)if(b=u(),null!==b)if(d=gc(),null!==d){for(e=[],j=xd,g=N(),null!==g?(h=gc(),null!==h?g=[g,h]:(g=null,xd=j)):(g=null,xd=j);null!==g;)e.push(g),j=xd,g=N(),null!==g?(h=gc(),null!==h?g=[g,h]:(g=null,xd=j)):(g=null,xd=j);null!==e?a=[a,b,d,e]:(a=null,xd=i)}else a=null,xd=i;else a=null,xd=i;else a=null,xd=i;return null===a&&(a=ec()),a}function ec(){var a,b,c,d,e,f,g,h;if(g=xd,a=C(),null!==a)if(b=u(),null!==b)if(c=fc(),null!==c){for(d=[],h=xd,e=N(),null!==e?(f=fc(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==e;)d.push(e),h=xd,e=N(),null!==e?(f=fc(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==d?a=[a,b,c,d]:(a=null,xd=g)}else a=null,xd=g;else a=null,xd=g;else a=null,xd=g;return a}function fc(){var a,b,c,d;return d=xd,a=C(),null!==a?(b=I(),null!==b?(c=C(),null===c&&(c=U()),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function gc(){var a;return a=hc(),null===a&&(a=jc(),null===a&&(a=lc(),null===a&&(a=nc(),null===a&&(a=oc(),null===a&&(a=pc(),null===a&&(a=qc(),null===a&&(a=fc()))))))),a}function hc(){var a,b,d,e;return e=xd,"realm"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"realm"')),null!==a?(b=I(),null!==b?(d=ic(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function ic(){var a,b;return b=xd,a=V(),null!==a&&(a=function(a,b){Bd.realm=b}(b,a)),null===a&&(xd=b),a}function jc(){var a,b,d,e,g,h,i,j,k;if(j=xd,"domain"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"domain"')),null!==a)if(b=I(),null!==b)if(d=Q(),null!==d)if(e=kc(),null!==e){if(g=[],k=xd,i=n(),null!==i)for(h=[];null!==i;)h.push(i),i=n();else h=null;for(null!==h?(i=kc(),null!==i?h=[h,i]:(h=null,xd=k)):(h=null,xd=k);null!==h;){if(g.push(h),k=xd,i=n(),null!==i)for(h=[];null!==i;)h.push(i),i=n();else h=null;null!==h?(i=kc(),null!==i?h=[h,i]:(h=null,xd=k)):(h=null,xd=k)}null!==g?(h=R(),null!==h?a=[a,b,d,e,g,h]:(a=null,xd=j)):(a=null,xd=j)}else a=null,xd=j;else a=null,xd=j;else a=null,xd=j;else a=null,xd=j;return a}function kc(){var a;return a=Ka(),null===a&&(a=Na()),
a}function lc(){var a,b,d,e;return e=xd,"nonce"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"nonce"')),null!==a?(b=I(),null!==b?(d=mc(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function mc(){var a,b;return b=xd,a=V(),null!==a&&(a=function(a,b){Bd.nonce=b}(b,a)),null===a&&(xd=b),a}function nc(){var a,b,d,e,g;return e=xd,g=xd,"opaque"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"opaque"')),null!==a?(b=I(),null!==b?(d=V(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.opaque=b}(e,a[2])),null===a&&(xd=e),a}function oc(){var a,b,d,e,g;return e=xd,"stale"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"stale"')),null!==a?(b=I(),null!==b?(g=xd,"true"===c.substr(xd,4).toLowerCase()?(d=c.substr(xd,4),xd+=4):(d=null,0===yd&&f('"true"')),null!==d&&(d=function(){Bd.stale=!0}(g)),null===d&&(xd=g),null===d&&(g=xd,"false"===c.substr(xd,5).toLowerCase()?(d=c.substr(xd,5),xd+=5):(d=null,0===yd&&f('"false"')),null!==d&&(d=function(){Bd.stale=!1}(g)),null===d&&(xd=g)),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function pc(){var a,b,d,e,g;return e=xd,g=xd,"algorithm"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"algorithm"')),null!==a?(b=I(),null!==b?("md5"===c.substr(xd,3).toLowerCase()?(d=c.substr(xd,3),xd+=3):(d=null,0===yd&&f('"MD5"')),null===d&&("md5-sess"===c.substr(xd,8).toLowerCase()?(d=c.substr(xd,8),xd+=8):(d=null,0===yd&&f('"MD5-sess"')),null===d&&(d=C())),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.algorithm=b.toUpperCase()}(e,a[2])),null===a&&(xd=e),a}function qc(){var a,b,d,e,g,h,i,j,k,l;if(j=xd,"qop"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"qop"')),null!==a)if(b=I(),null!==b)if(d=Q(),null!==d){if(k=xd,e=rc(),null!==e){for(g=[],l=xd,44===c.charCodeAt(xd)?(h=",",xd++):(h=null,0===yd&&f('","')),null!==h?(i=rc(),null!==i?h=[h,i]:(h=null,xd=l)):(h=null,xd=l);null!==h;)g.push(h),l=xd,44===c.charCodeAt(xd)?(h=",",xd++):(h=null,0===yd&&f('","')),null!==h?(i=rc(),null!==i?h=[h,i]:(h=null,xd=l)):(h=null,xd=l);null!==g?e=[e,g]:(e=null,xd=k)}else e=null,xd=k;null!==e?(g=R(),null!==g?a=[a,b,d,e,g]:(a=null,xd=j)):(a=null,xd=j)}else a=null,xd=j;else a=null,xd=j;else a=null,xd=j;return a}function rc(){var a,b;return b=xd,"auth-int"===c.substr(xd,8).toLowerCase()?(a=c.substr(xd,8),xd+=8):(a=null,0===yd&&f('"auth-int"')),null===a&&("auth"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"auth"')),null===a&&(a=C())),null!==a&&(a=function(a,b){Bd.qop||(Bd.qop=[]),Bd.qop.push(b.toLowerCase())}(b,a)),null===a&&(xd=b),a}function sc(){var a,b,c,d,e,f;if(e=xd,a=tc(),null!==a){for(b=[],f=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function tc(){var a,b;return b=xd,a=C(),null!==a&&(a=function(a,b){Bd.options||(Bd.options=[]),Bd.options.push(b)}(b,a)),null===a&&(xd=b),a}function uc(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=vc(),null!==a){for(b=[],g=xd,c=N(),null!==c?(d=vc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=N(),null!==c?(d=vc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(){var a;for(a in Bd.multi_header)if(null===Bd.multi_header[a].parsed){Bd=null;break}Bd=null!==Bd?Bd.multi_header:-1}(e)),null===a&&(xd=e),a}function vc(){var a,b,c,e,f,g,h;if(f=xd,g=xd,a=tb(),null!==a){for(b=[],h=xd,c=O(),null!==c?(e=Ab(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==c;)b.push(c),h=xd,c=O(),null!==c?(e=Ab(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(a){var b;Bd.multi_header||(Bd.multi_header=[]);try{b=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params),delete Bd.uri,delete Bd.display_name,delete Bd.params}catch(c){b=null}Bd.multi_header.push({possition:xd,offset:a,parsed:b})}(f)),null===a&&(xd=f),a}function wc(){var a,b,c,e,f,g,h;if(f=xd,g=xd,a=Y(),null===a&&(a=tb()),null!==a){for(b=[],h=xd,c=O(),null!==c?(e=Ab(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==c;)b.push(c),h=xd,c=O(),null!==c?(e=Ab(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(){try{Bd=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params)}catch(a){Bd=-1}}(f)),null===a&&(xd=f),a}function xc(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=tc(),null!==a){for(b=[],g=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(){Bd=Bd.options}(e)),null===a&&(xd=e),a}function yc(){var a,b,c,d,e,f;if(e=xd,a=zc(),null!==a){for(b=[],f=xd,c=N(),null!==c?(d=zc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=N(),null!==c?(d=zc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function zc(){var a,b,c,d,e,f;if(e=xd,a=tb(),null!==a){for(b=[],f=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=O(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function Ac(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=yb(),null!==a){for(b=[],g=xd,c=O(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=O(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(a,b){Bd.interval=b}(e,a[0])),null===a&&(xd=e),a}function Bc(){var a;return a=Cc(),null===a&&(a=Ab()),a}function Cc(){var a,b,d,e,g;return e=xd,g=xd,"refresher"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"refresher"')),null!==a?(b=I(),null!==b?("uas"===c.substr(xd,3).toLowerCase()?(d=c.substr(xd,3),xd+=3):(d=null,0===yd&&f('"uas"')),null===d&&("uac"===c.substr(xd,3).toLowerCase()?(d=c.substr(xd,3),xd+=3):(d=null,0===yd&&f('"uac"'))),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.params||(Bd.params={}),Bd.params.refresher=b}(e,a[2])),null===a&&(xd=e),a}function Dc(){var a,b,c,d,e,f;if(e=xd,a=Ec(),null!==a){for(b=[],f=xd,c=O(),null!==c?(d=Fc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=O(),null!==c?(d=Fc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function Ec(){var a,b;return b=xd,"active"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"active"')),null===a&&("pending"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"pending"')),null===a&&("terminated"===c.substr(xd,10).toLowerCase()?(a=c.substr(xd,10),xd+=10):(a=null,0===yd&&f('"terminated"')),null===a&&(a=C()))),null!==a&&(a=function(a){Bd.state=c.substring(xd,a)}(b)),null===a&&(xd=b),a}function Fc(){var a,b,d,e,g;return e=xd,g=xd,"reason"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"reason"')),null!==a?(b=I(),null!==b?(d=Gc(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Bd.reason=b)}(e,a[2])),null===a&&(xd=e),null===a&&(e=xd,g=xd,"expires"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"expires"')),null!==a?(b=I(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Bd.expires=b)}(e,a[2])),null===a&&(xd=e),null===a&&(e=xd,g=xd,"retry_after"===c.substr(xd,11).toLowerCase()?(a=c.substr(xd,11),xd+=11):(a=null,0===yd&&f('"retry_after"')),null!==a?(b=I(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Bd.retry_after=b)}(e,a[2])),null===a&&(xd=e),null===a&&(a=Ab()))),a}function Gc(){var a;return"deactivated"===c.substr(xd,11).toLowerCase()?(a=c.substr(xd,11),xd+=11):(a=null,0===yd&&f('"deactivated"')),null===a&&("probation"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"probation"')),null===a&&("rejected"===c.substr(xd,8).toLowerCase()?(a=c.substr(xd,8),xd+=8):(a=null,0===yd&&f('"rejected"')),null===a&&("timeout"===c.substr(xd,7).toLowerCase()?(a=c.substr(xd,7),xd+=7):(a=null,0===yd&&f('"timeout"')),null===a&&("giveup"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"giveup"')),null===a&&("noresource"===c.substr(xd,10).toLowerCase()?(a=c.substr(xd,10),xd+=10):(a=null,0===yd&&f('"noresource"')),null===a&&("invariant"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"invariant"')),null===a&&(a=C()))))))),a}function Hc(){var a;return a=x(),a=null!==a?a:""}function Ic(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=tc(),null!==a){for(b=[],g=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=N(),null!==c?(d=tc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return a=null!==a?a:"",null!==a&&(a=function(){Bd=Bd.options||[]}(e)),null===a&&(xd=e),a}function Jc(){var a,b,c,d,e,f,g;if(e=xd,f=xd,a=qb(),null!==a){for(b=[],g=xd,c=O(),null!==c?(d=Kc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==c;)b.push(c),g=xd,c=O(),null!==c?(d=Kc(),null!==d?c=[c,d]:(c=null,xd=g)):(c=null,xd=g);null!==b?a=[a,b]:(a=null,xd=f)}else a=null,xd=f;return null!==a&&(a=function(a,b){Bd.call_id=b}(e,a[0])),null===a&&(xd=e),a}function Kc(){var a;return a=Lc(),null===a&&(a=Mc(),null===a&&(a=Ab())),a}function Lc(){var a,b,d,e,g;return e=xd,g=xd,"remote-tag"===c.substr(xd,10).toLowerCase()?(a=c.substr(xd,10),xd+=10):(a=null,0===yd&&f('"remote-tag"')),null!==a?(b=I(),null!==b?(d=C(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.remote_tag=b}(e,a[2])),null===a&&(xd=e),a}function Mc(){var a,b,d,e,g;return e=xd,g=xd,"local-tag"===c.substr(xd,9).toLowerCase()?(a=c.substr(xd,9),xd+=9):(a=null,0===yd&&f('"local-tag"')),null!==a?(b=I(),null!==b?(d=C(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.local_tag=b}(e,a[2])),null===a&&(xd=e),a}function Nc(){var a,b,c,e,f,g,h;if(f=xd,g=xd,a=Y(),null===a&&(a=tb()),null!==a){for(b=[],h=xd,c=O(),null!==c?(e=Oc(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==c;)b.push(c),h=xd,c=O(),null!==c?(e=Oc(),null!==e?c=[c,e]:(c=null,xd=h)):(c=null,xd=h);null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(){var a=Bd.tag;try{Bd=new d.NameAddrHeader(Bd.uri,Bd.display_name,Bd.params),a&&Bd.setParam("tag",a)}catch(b){Bd=-1}}(f)),null===a&&(xd=f),a}function Oc(){var a;return a=Zb(),null===a&&(a=Ab()),a}function Pc(){var a,b,c,d,e,f;if(e=xd,a=Qc(),null!==a){for(b=[],f=xd,c=N(),null!==c?(d=Qc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==c;)b.push(c),f=xd,c=N(),null!==c?(d=Qc(),null!==d?c=[c,d]:(c=null,xd=f)):(c=null,xd=f);null!==b?a=[a,b]:(a=null,xd=e)}else a=null,xd=e;return a}function Qc(){var a,b,c,d,e,f,g,h;if(g=xd,a=Xc(),null!==a)if(b=u(),null!==b)if(c=$c(),null!==c){for(d=[],h=xd,e=O(),null!==e?(f=Rc(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==e;)d.push(e),h=xd,e=O(),null!==e?(f=Rc(),null!==f?e=[e,f]:(e=null,xd=h)):(e=null,xd=h);null!==d?a=[a,b,c,d]:(a=null,xd=g)}else a=null,xd=g;else a=null,xd=g;else a=null,xd=g;return a}function Rc(){var a;return a=Sc(),null===a&&(a=Tc(),null===a&&(a=Uc(),null===a&&(a=Vc(),null===a&&(a=Wc(),null===a&&(a=Ab()))))),a}function Sc(){var a,b,d,e,g;return e=xd,g=xd,"ttl"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"ttl"')),null!==a?(b=I(),null!==b?(d=bd(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.ttl=b}(e,a[2])),null===a&&(xd=e),a}function Tc(){var a,b,d,e,g;return e=xd,g=xd,"maddr"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"maddr"')),null!==a?(b=I(),null!==b?(d=ea(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.maddr=b}(e,a[2])),null===a&&(xd=e),a}function Uc(){var a,b,d,e,g;return e=xd,g=xd,"received"===c.substr(xd,8).toLowerCase()?(a=c.substr(xd,8),xd+=8):(a=null,0===yd&&f('"received"')),null!==a?(b=I(),null!==b?(d=ma(),null===d&&(d=ja()),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.received=b}(e,a[2])),null===a&&(xd=e),a}function Vc(){var a,b,d,e,g;return e=xd,g=xd,"branch"===c.substr(xd,6).toLowerCase()?(a=c.substr(xd,6),xd+=6):(a=null,0===yd&&f('"branch"')),null!==a?(b=I(),null!==b?(d=C(),null!==d?a=[a,b,d]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.branch=b}(e,a[2])),null===a&&(xd=e),a}function Wc(){var a,b,d,e,g,i,j;if(g=xd,i=xd,"rport"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"rport"')),null!==a){if(j=xd,b=I(),null!==b){for(d=[],e=h();null!==e;)d.push(e),e=h();null!==d?b=[b,d]:(b=null,xd=j)}else b=null,xd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=i)}else a=null,xd=i;return null!==a&&(a=function(){"undefined"!=typeof response_port&&(Bd.rport=response_port.join(""))}(g)),null===a&&(xd=g),a}function Xc(){var a,b,c,d,e,f;return f=xd,a=Yc(),null!==a?(b=H(),null!==b?(c=C(),null!==c?(d=H(),null!==d?(e=Zc(),null!==e?a=[a,b,c,d,e]:(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f)):(a=null,xd=f),a}function Yc(){var a,b;return b=xd,"sip"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"SIP"')),null===a&&(a=C()),null!==a&&(a=function(a,b){Bd.protocol=b}(b,a)),null===a&&(xd=b),a}function Zc(){var a,b;return b=xd,"udp"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"UDP"')),null===a&&("tcp"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"TCP"')),null===a&&("tls"===c.substr(xd,3).toLowerCase()?(a=c.substr(xd,3),xd+=3):(a=null,0===yd&&f('"TLS"')),null===a&&("sctp"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"SCTP"')),null===a&&(a=C())))),null!==a&&(a=function(a,b){Bd.transport=b}(b,a)),null===a&&(xd=b),a}function $c(){var a,b,c,d,e;return d=xd,a=_c(),null!==a?(e=xd,b=P(),null!==b?(c=ad(),null!==c?b=[b,c]:(b=null,xd=e)):(b=null,xd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a}function _c(){var a,b;return b=xd,a=fa(),null===a&&(a=ma(),null===a&&(a=ia())),null!==a&&(a=function(a){Bd.host=c.substring(xd,a)}(b)),null===a&&(xd=b),a}function ad(){var a,b,c,d,e,f,g;return f=xd,g=xd,a=h(),a=null!==a?a:"",null!==a?(b=h(),b=null!==b?b:"",null!==b?(c=h(),c=null!==c?c:"",null!==c?(d=h(),d=null!==d?d:"",null!==d?(e=h(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g)):(a=null,xd=g),null!==a&&(a=function(a,b){Bd.port=parseInt(b.join(""))}(f,a)),null===a&&(xd=f),a}function bd(){var a,b,c,d,e;return d=xd,e=xd,a=h(),null!==a?(b=h(),b=null!==b?b:"",null!==b?(c=h(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(d,a)),null===a&&(xd=d),a}function cd(){var a;return a=dc()}function dd(){var a,b,c,d;return d=xd,a=C(),null!==a?(b=w(),null!==b?(c=ed(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function ed(){var a,b;for(a=[],b=y(),null===b&&(b=A(),null===b&&(b=u()));null!==b;)a.push(b),b=y(),null===b&&(b=A(),null===b&&(b=u()));return a}function fd(){var a,b;for(a=[],b=l();null!==b;)a.push(b),b=l();return a}function gd(){var a,b,d,e;return e=xd,a=hd(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=id(),null!==d?a=[a,b,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function hd(){var a,b;return b=xd,"stuns"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"stuns"')),null===a&&("stun"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"stun"'))),null!==a&&(a=function(a,b){Bd.scheme=b}(b,a)),null===a&&(xd=b),a}function id(){var a,b,d,e,g;return e=xd,a=jd(),null!==a?(g=xd,58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=oa(),null!==d?b=[b,d]:(b=null,xd=g)):(b=null,xd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,xd=e)):(a=null,xd=e),a}function jd(){var a,b;return b=xd,a=ma(),null===a&&(a=ia(),null===a&&(a=Ya())),null!==a&&(a=function(a,b){Bd.host=b}(b,a)),null===a&&(xd=b),a}function Ya(){var a,b,d;for(d=xd,a=[],b=kd(),null===b&&(b=t(),null===b&&(b=ld()));null!==b;)a.push(b),b=kd(),null===b&&(b=t(),null===b&&(b=ld()));return null!==a&&(a=function(a){return c.substring(xd,a)}(d)),null===a&&(xd=d),a}function kd(){var a;return a=i(),null===a&&(a=h(),null===a&&(45===c.charCodeAt(xd)?(a="-",xd++):(a=null,0===yd&&f('"-"')),null===a&&(46===c.charCodeAt(xd)?(a=".",xd++):(a=null,0===yd&&f('"."')),null===a&&(95===c.charCodeAt(xd)?(a="_",xd++):(a=null,0===yd&&f('"_"')),null===a&&(126===c.charCodeAt(xd)?(a="~",xd++):(a=null,0===yd&&f('"~"'))))))),a}function ld(){var a;return 33===c.charCodeAt(xd)?(a="!",xd++):(a=null,0===yd&&f('"!"')),null===a&&(36===c.charCodeAt(xd)?(a="$",xd++):(a=null,0===yd&&f('"$"')),null===a&&(38===c.charCodeAt(xd)?(a="&",xd++):(a=null,0===yd&&f('"&"')),null===a&&(39===c.charCodeAt(xd)?(a="'",xd++):(a=null,0===yd&&f('"\'"')),null===a&&(40===c.charCodeAt(xd)?(a="(",xd++):(a=null,0===yd&&f('"("')),null===a&&(41===c.charCodeAt(xd)?(a=")",xd++):(a=null,0===yd&&f('")"')),null===a&&(42===c.charCodeAt(xd)?(a="*",xd++):(a=null,0===yd&&f('"*"')),null===a&&(43===c.charCodeAt(xd)?(a="+",xd++):(a=null,0===yd&&f('"+"')),null===a&&(44===c.charCodeAt(xd)?(a=",",xd++):(a=null,0===yd&&f('","')),null===a&&(59===c.charCodeAt(xd)?(a=";",xd++):(a=null,0===yd&&f('";"')),null===a&&(61===c.charCodeAt(xd)?(a="=",xd++):(a=null,0===yd&&f('"="')))))))))))),a}function md(){var a,b,d,e,g,h,i;return h=xd,a=nd(),null!==a?(58===c.charCodeAt(xd)?(b=":",xd++):(b=null,0===yd&&f('":"')),null!==b?(d=id(),null!==d?(i=xd,"?transport="===c.substr(xd,11)?(e="?transport=",xd+=11):(e=null,0===yd&&f('"?transport="')),null!==e?(g=Zc(),null!==g?e=[e,g]:(e=null,xd=i)):(e=null,xd=i),e=null!==e?e:"",null!==e?a=[a,b,d,e]:(a=null,xd=h)):(a=null,xd=h)):(a=null,xd=h)):(a=null,xd=h),a}function nd(){var a,b;return b=xd,"turns"===c.substr(xd,5).toLowerCase()?(a=c.substr(xd,5),xd+=5):(a=null,0===yd&&f('"turns"')),null===a&&("turn"===c.substr(xd,4).toLowerCase()?(a=c.substr(xd,4),xd+=4):(a=null,0===yd&&f('"turn"'))),null!==a&&(a=function(a,b){Bd.scheme=b}(b,a)),null===a&&(xd=b),a}function od(){var a,b,d,e,g;if(e=xd,g=xd,a=Zc(),null!==a){if("udp"===c.substr(xd,3).toLowerCase()?(b=c.substr(xd,3),xd+=3):(b=null,0===yd&&f('"udp"')),null===b&&("tcp"===c.substr(xd,3).toLowerCase()?(b=c.substr(xd,3),xd+=3):(b=null,0===yd&&f('"tcp"')),null===b))for(b=[],d=r();null!==d;)b.push(d),d=r();null!==b?a=[a,b]:(a=null,xd=g)}else a=null,xd=g;return null!==a&&(a=function(){Bd.transport=transport}(e)),null===a&&(xd=e),a}function pd(){var a,b,d;return d=xd,"uuid:"===c.substr(xd,5)?(a="uuid:",xd+=5):(a=null,0===yd&&f('"uuid:"')),null!==a?(b=qd(),null!==b?a=[a,b]:(a=null,xd=d)):(a=null,xd=d),a}function qd(){var a,b,d,e,g,h,i,j,k,l,m;return l=xd,m=xd,a=sd(),null!==a?(45===c.charCodeAt(xd)?(b="-",xd++):(b=null,0===yd&&f('"-"')),null!==b?(d=rd(),null!==d?(45===c.charCodeAt(xd)?(e="-",xd++):(e=null,0===yd&&f('"-"')),null!==e?(g=rd(),null!==g?(45===c.charCodeAt(xd)?(h="-",xd++):(h=null,0===yd&&f('"-"')),null!==h?(i=rd(),null!==i?(45===c.charCodeAt(xd)?(j="-",xd++):(j=null,0===yd&&f('"-"')),null!==j?(k=td(),null!==k?a=[a,b,d,e,g,h,i,j,k]:(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m)):(a=null,xd=m),null!==a&&(a=function(a){Bd=c.substring(xd+5,a)}(l,a[0])),null===a&&(xd=l),a}function rd(){var a,b,c,d,e;return e=xd,a=j(),null!==a?(b=j(),null!==b?(c=j(),null!==c?(d=j(),null!==d?a=[a,b,c,d]:(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e)):(a=null,xd=e),a}function sd(){var a,b,c;return c=xd,a=rd(),null!==a?(b=rd(),null!==b?a=[a,b]:(a=null,xd=c)):(a=null,xd=c),a}function td(){var a,b,c,d;return d=xd,a=rd(),null!==a?(b=rd(),null!==b?(c=rd(),null!==c?a=[a,b,c]:(a=null,xd=d)):(a=null,xd=d)):(a=null,xd=d),a}function ud(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function vd(){for(var a=1,b=1,d=!1,e=0;e<Math.max(xd,zd);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var wd={CRLF:g,DIGIT:h,ALPHA:i,HEXDIG:j,WSP:k,OCTET:l,DQUOTE:m,SP:n,HTAB:o,alphanum:p,reserved:q,unreserved:r,mark:s,escaped:t,LWS:u,SWS:v,HCOLON:w,TEXT_UTF8_TRIM:x,TEXT_UTF8char:y,UTF8_NONASCII:z,UTF8_CONT:A,LHEX:B,token:C,token_nodot:D,separators:E,word:F,STAR:G,SLASH:H,EQUAL:I,LPAREN:J,RPAREN:K,RAQUOT:L,LAQUOT:M,COMMA:N,SEMI:O,COLON:P,LDQUOT:Q,RDQUOT:R,comment:S,ctext:T,quoted_string:U,quoted_string_clean:V,qdtext:W,quoted_pair:X,SIP_URI_noparams:Y,SIP_URI:Z,uri_scheme:$,userinfo:_,user:aa,user_unreserved:ba,password:ca,hostport:da,host:ea,hostname:fa,domainlabel:ga,toplabel:ha,IPv6reference:ia,IPv6address:ja,h16:ka,ls32:la,IPv4address:ma,dec_octet:na,port:oa,uri_parameters:pa,uri_parameter:qa,transport_param:ra,user_param:sa,method_param:ta,ttl_param:ua,maddr_param:va,lr_param:wa,other_param:xa,pname:ya,pvalue:za,paramchar:Aa,param_unreserved:Ba,headers:Ca,header:Da,hname:Ea,hvalue:Fa,hnv_unreserved:Ga,Request_Response:Ha,Request_Line:Ia,Request_URI:Ja,absoluteURI:Ka,hier_part:La,net_path:Ma,abs_path:Na,opaque_part:Oa,uric:Pa,uric_no_slash:Qa,path_segments:Ra,segment:Sa,param:Ta,pchar:Ua,scheme:Va,authority:Wa,srvr:Xa,reg_name:Ya,query:Za,SIP_Version:$a,INVITEm:_a,ACKm:ab,OPTIONSm:bb,BYEm:cb,CANCELm:db,REGISTERm:eb,SUBSCRIBEm:fb,NOTIFYm:gb,Method:hb,Status_Line:ib,Status_Code:jb,extension_code:kb,Reason_Phrase:lb,Allow:mb,allow_method:nb,Allow_Events:ob,Call_ID:pb,call_id:qb,Contact:rb,contact_param:sb,name_addr:tb,display_name:ub,contact_params:vb,c_p_q:wb,c_p_expires:xb,delta_seconds:yb,qvalue:zb,generic_param:Ab,gen_value:Bb,Content_Disposition:Cb,disp_type:Db,disp_param:Eb,handling_param:Fb,Content_Encoding:Gb,Content_Length:Hb,Content_Type:Ib,media_type:Jb,m_type:Kb,discrete_type:Lb,composite_type:Mb,extension_token:Nb,x_token:Ob,m_subtype:Pb,m_parameter:Qb,m_value:Rb,CSeq:Sb,CSeq_value:Tb,Expires:Ub,Event:Vb,event_type:Wb,From:Xb,from_param:Yb,tag_param:Zb,Max_Forwards:$b,Min_Expires:_b,Min_SE:ac,Name_Addr_Header:bc,Proxy_Authenticate:cc,challenge:dc,other_challenge:ec,auth_param:fc,digest_cln:gc,realm:hc,realm_value:ic,domain:jc,URI:kc,nonce:lc,nonce_value:mc,opaque:nc,stale:oc,algorithm:pc,qop_options:qc,qop_value:rc,Proxy_Require:sc,option_tag:tc,Record_Route:uc,rec_route:vc,Refer_To:wc,Require:xc,Route:yc,route_param:zc,Session_Expires:Ac,se_param:Bc,refresher_param:Cc,Subscription_State:Dc,substate_value:Ec,subexp_params:Fc,event_reason_value:Gc,Subject:Hc,Supported:Ic,Target_Dialog:Jc,td_param:Kc,remote_param:Lc,local_param:Mc,To:Nc,to_param:Oc,Via:Pc,via_parm:Qc,via_params:Rc,via_ttl:Sc,via_maddr:Tc,via_received:Uc,via_branch:Vc,response_port:Wc,sent_protocol:Xc,protocol_name:Yc,transport:Zc,sent_by:$c,via_host:_c,via_port:ad,ttl:bd,WWW_Authenticate:cd,extension_header:dd,header_value:ed,message_body:fd,stun_URI:gd,stun_scheme:hd,stun_host_port:id,stun_host:jd,reg_name:Ya,stun_unreserved:kd,sub_delims:ld,turn_URI:md,turn_scheme:nd,turn_transport:od,uuid_URI:pd,uuid:qd,hex4:rd,hex8:sd,hex12:td};if(void 0!==e){if(void 0===wd[e])throw new Error("Invalid rule name: "+a(e)+".")}else e="CRLF";var xd=0,yd=0,zd=0,Ad=[],Bd={},Cd=wd[e]();if(null===Cd||xd!==c.length){var Dd=Math.max(xd,zd),Ed=Dd<c.length?c.charAt(Dd):null,Fd=vd();return new this.SyntaxError(ud(Ad),Ed,Dd,Fd.line,Fd.column),-1}return Bd},toSource:function(){return this._source}};return c.SyntaxError=function(b,c,d,e,f){function g(b,c){var d,e;switch(b.length){case 0:d="end of input";break;case 1:d=b[0];break;default:d=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}return e=c?a(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=b,this.found=c,this.message=g(b,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()}(window)},{}],2:[function(a,b){function c(a){var b,c,d;return a?/^ws/.test(a)?a:/:\d{1,5}/.test(a)?(b="https:"===window.location.protocol?"wss://":"ws://",b+a):(b="https:"===window.location.protocol?"wss://":"ws://",c=""!==window.location.port?":"+window.location.port:"",d="/"===a[0]?a:"/"+a,b+window.location.hostname+c+d):(b="https:"===window.location.protocol?"wss://":"ws://",c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+"/ws")}function d(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=16,c="",d=a.length;b--;)c+=a.charAt(Math.floor(Math.random()*d));return c}function e(a,b){var d=c(a);return"WebSocket"in window?b?new WebSocket(d,b):new WebSocket(d):"MozWebSocket"in window?b?new MozWebSocket(d,b):new MozWebSocket(d):null}var f={TYPE_ID_WELCOME:0,TYPE_ID_PREFIX:1,TYPE_ID_CALL:2,TYPE_ID_CALLRESULT:3,TYPE_ID_CALLERROR:4,TYPE_ID_SUBSCRIBE:5,TYPE_ID_UNSUBSCRIBE:6,TYPE_ID_PUBLISH:7,TYPE_ID_EVENT:8},g=function(){this._pref2uri={},this._uri2pref={}};g.prototype.get=function(a){return this._pref2uri[a]},g.prototype.set=function(a,b){this._pref2uri[a]=b,this._uri2pref[a]=b},g.prototype.remove=function(a){this._pref2uri[a]&&(delete this._uri2pref[this._pref2uri[a]],delete this._pref2uri[a])},g.prototype.reset=function(){this._pref2uri={},this._uri2pref={}},g.prototype.resolve=function(a){var b,c=/^http(s)?:\/\//.test(a),d=a.indexOf(":");return!c&&d>=0?(b=a.substring(0,d),this._pref2uri[b]?this._pref2uri[b]+a.substring(d+1):null):a};var h=function(a){switch(this._url=a,this._protocols=[],this._cache={sessionId:null,protocolVersion:1,timer:null,reconnectingAttempts:0,welcome:!1,onConnect:null,onClose:null,onError:null,onReconnect:null},this._serverIdent=null,this._ws=null,this._queue=[],this._calls={},this._subscriptions={},this._isInitialized=!1,this._options={autoReconnect:!0,reconnectInterval:2e3,maxRetries:25},this._prefixMap=new g,arguments.length){case 1:"string"==typeof arguments[0]?this._ws=e(arguments[0]):this._options=this._merge(this._options,arguments[0]);break;case 2:"string"==typeof arguments[0]&&arguments[1]instanceof Array?(this._protocols=arguments[1],this._ws=e(arguments[0],arguments[1])):(this._ws=e(arguments[0]),this._options=this._merge(this._options,arguments[1]));break;case 3:this._protocols=arguments[1],this._ws=e(arguments[0],arguments[1]),this._options=this._merge(this._options,arguments[2])}this._initWsCallbacks()};h.prototype._merge=function(){var a,b,c={},d=arguments.length;for(a=0;d>a;a++)for(b in arguments[a])c[b]=arguments[a][b];return c},h.prototype._send=function(a){if(a&&this._queue.push(JSON.stringify(a)),this._isInitialized&&1===this._ws.readyState)for(;this._queue.length;)this._ws.send(this._queue.shift())},h.prototype._initWsCallbacks=function(){var a=this;this._ws.onopen=function(){a._wsOnOpen.call(a)},this._ws.onclose=function(b){a._wsOnClose.call(a,b)},this._ws.onmessage=function(b){a._wsOnMessage.call(a,b)},this._ws.onerror=function(b){a._wsOnError.call(a,b)}},h.prototype._wsOnOpen=function(){console.log("[wampy] websocket connected")},h.prototype._wsOnClose=function(){var a=this;console.log("[wampy] websocket disconnected"),this._cache.welcome=!1,this._isInitialized&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries?this._cache.timer=window.setTimeout(function(){a._wsReconnect.call(a)},this._options.reconnectInterval):(this._options.onClose&&this._options.onClose(),this.disconnect())},h.prototype._wsOnMessage=function(a){var b,c,d;switch(console.log("[wampy] websocket message received: ",a.data),b=JSON.parse(a.data),b[0]){case f.TYPE_ID_WELCOME:this._cache.sessionId=b[1],this._cache.protocolVersion=b[2],this._serverIdent=b[3],this._isInitialized=!0,this._options.onConnect&&this._options.onConnect(),this._send();break;case f.TYPE_ID_CALLRESULT:this._calls[b[1]]&&this._calls[b[1]].callRes&&this._calls[b[1]].callRes(b[2]);break;case f.TYPE_ID_CALLERROR:this._calls[b[1]]&&this._calls[b[1]].callErr&&this._calls[b[1]].callErr(b[2],b[3],b[4]);break;case f.TYPE_ID_EVENT:if(d=this._prefixMap.resolve(b[1]),this._subscriptions[d])for(c=this._subscriptions[d].length;c--;)this._subscriptions[d][c](b[2])}},h.prototype._wsOnError=function(){console.log("[wampy] websocket error"),this._options.onError&&this._options.onError()},h.prototype._wsReconnect=function(){console.log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=e(this._url,this._protocols),this._initWsCallbacks()},h.prototype.options=function(a){return void 0===a?this._options:"object"==typeof a?(this._options=this._merge(this._options,a),this):void 0},h.prototype.connect=function(a,b){return a&&(this._url=a),this._protocols=b instanceof Array?b:[],this._ws=e(this._url,this._protocols),this},h.prototype.disconnect=function(){return this._isInitialized&&(this._isInitialized=!1,this._ws.close(),this._serverIdent=null,this._prefixMap.reset(),this._ws=null,this._queue=[],this._subscriptions={},this._calls={},this._cache={protocolVersion:1,reconnectingAttempts:0}),this},h.prototype.prefix=function(a,b){return this._prefixMap.set(a,b),this._send([f.TYPE_ID_PREFIX,a,b]),this},h.prototype.unprefix=function(a){return this._prefixMap.remove(a),this},h.prototype.call=function(a,b){for(var c,e=d(),g=arguments.length,h=[f.TYPE_ID_CALL];e in this._calls;)e=d();for(this._calls[e]=b,h.push(e),h.push(a),c=2;g>c;c++)h.push(arguments[c]);return this._send(h),this},h.prototype.subscribe=function(a,b){var c=this._prefixMap.resolve(a);return this._subscriptions[c]||(this._subscriptions[c]=[],this._send([f.TYPE_ID_SUBSCRIBE,a])),this._subscriptions[c].indexOf(b)<0&&this._subscriptions[c].push(b),this},h.prototype.unsubscribe=function(a,b){var c,d=this._prefixMap.resolve(a);if(this._subscriptions[d]){if(void 0!==b&&(c=this._subscriptions[d].indexOf(b),c>=0&&this._subscriptions[d].splice(c,1),this._subscriptions[d].length))return this;this._send([f.TYPE_ID_UNSUBSCRIBE,a]),delete this._subscriptions[d]}return this},h.prototype.publish=function(a,b,c,d){var e=[f.TYPE_ID_PUBLISH,a,b];switch(arguments.length){case 2:this._send(e);break;case 3:("boolean"==typeof c||c instanceof Array)&&(e.push(c),this._send(e));break;case 4:c instanceof Array&&d instanceof Array&&(e.push(c),e.push(d),this._send(e))}return this},b.exports=h},{}],3:[function(b,c){!function(b){"use strict";var d={};d.VERSION="0.9.14";var e,f={},g=function(a,b){return function(){return b.apply(a,arguments)}},h=function(){var a,b,c=arguments,d=c[0];for(b=1;b<c.length;b++)for(a in c[b])a in d||!c[b].hasOwnProperty(a)||(d[a]=c[b][a]);return d},i=function(a,b){return{value:a,name:b}};d.DEBUG=i(1,"DEBUG"),d.INFO=i(2,"INFO"),d.WARN=i(4,"WARN"),d.ERROR=i(8,"ERROR"),d.OFF=i(99,"OFF");var j=function(a){this.context=a,this.setLevel(a.filterLevel),this.log=this.info};j.prototype={setLevel:function(a){a&&"value"in a&&(this.context.filterLevel=a)},enabledFor:function(a){var b=this.context.filterLevel;return a.value>=b.value},debug:function(){this.invoke(d.DEBUG,arguments)},info:function(){this.invoke(d.INFO,arguments)},warn:function(){this.invoke(d.WARN,arguments)},error:function(){this.invoke(d.ERROR,arguments)},invoke:function(a,b){e&&this.enabledFor(a)&&e(b,h({level:a},this.context))}};var k=new j({filterLevel:d.OFF});!function(){var a=d;a.enabledFor=g(k,k.enabledFor),
a.debug=g(k,k.debug),a.info=g(k,k.info),a.warn=g(k,k.warn),a.error=g(k,k.error),a.log=a.info}(),d.setHandler=function(a){e=a},d.setLevel=function(a){k.setLevel(a);for(var b in f)f.hasOwnProperty(b)&&f[b].setLevel(a)},d.get=function(a){return f[a]||(f[a]=new j(h({name:a},k.context)))},d.useDefaults=function(a){"undefined"!=typeof console&&(d.setLevel(a||d.DEBUG),d.setHandler(function(a,b){var c=console.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===d.WARN&&console.warn?c=console.warn:b.level===d.ERROR&&console.error?c=console.error:b.level===d.INFO&&console.info&&(c=console.info),Function.prototype.apply.call(c,console,a)}))},"function"==typeof a&&a.amd?a(d):"undefined"!=typeof c&&c.exports?c.exports=d:(d._prevLogger=b.Logger,d.noConflict=function(){return b.Logger=d._prevLogger,d},b.Logger=d)}(this)},{}],4:[function(b,c){(function(){function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=p[a])});16>e;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=o;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:t,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:v+1,j=h-u+(i-v)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>u)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,v=i,t=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var m=a.node||s,n=0;6>n;n++)f[d+n]=m[n];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new n(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[d+g]=f[g];return b||e(f)}var h,i=this;if("function"==typeof b)try{var j=b("crypto").randomBytes;h=j&&function(){return j(16)}}catch(k){}if(!h&&i.crypto&&crypto.getRandomValues){var l=new Uint8Array(16);h=function(){return crypto.getRandomValues(l),l}}if(!h){var m=new Array(16);h=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),m[b]=a>>>((3&b)<<3)&255;return m}}for(var n="function"==typeof Buffer?Buffer:Array,o=[],p={},q=0;256>q;q++)o[q]=(q+256).toString(16).substr(1),p[o[q]]=q;var r=h(),s=[1|r[0],r[1],r[2],r[3],r[4],r[5]],t=16383&(r[6]<<8|r[7]),u=0,v=0,w=g;if(w.v1=f,w.v4=g,w.parse=d,w.unparse=e,w.BufferClass=n,"function"==typeof a&&a.amd)a(function(){return w});else if("undefined"!=typeof c&&c.exports)c.exports=w;else{var x=i.uuid;w.noConflict=function(){return i.uuid=x,w},i.uuid=w}}).call(this)},{crypto:void 0}],5:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){}c.prototype.name="ANONYMOUS",c.prototype.clientFirst=!0,c.prototype.response=function(a){return a.trace||""},c.prototype.challenge=function(){},a=b.exports=c})},{}],6:[function(b,c,d){!function(e,f){"object"==typeof d?f(d,c,b("./lib/mechanism")):"function"==typeof a&&a.amd&&a(["exports","module","./lib/mechanism"],f)}(this,function(a,b,c){a=b.exports=c,a.Mechanism=c})},{"./lib/mechanism":5}],7:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){}c.prototype.name="PLAIN",c.prototype.clientFirst=!0,c.prototype.response=function(a){var b="";return b+=a.authzid||"",b+="\x00",b+=a.username,b+="\x00",b+=a.password},c.prototype.challenge=function(){return this},a=b.exports=c})},{}],8:[function(a,b,c){arguments[4][6][0].apply(c,arguments)},{"./lib/mechanism":7,"/media/ephemeral0/jenkins/workspace/javascript-sdk/node_modules/sasl-anonymous/main.js":6}],9:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){this._mechs=[]}c.prototype.use=function(a,b){return b||(b=a,a=b.prototype.name),this._mechs.push({name:a,mech:b}),this},c.prototype.create=function(a){for(var b=0,c=this._mechs.length;c>b;b++)for(var d=0,e=a.length;e>d;d++){var f=this._mechs[b];if(f.name==a[d])return new f.mech}return null},a=b.exports=c})},{}],10:[function(b,c,d){!function(e,f){"object"==typeof d?f(d,c,b("./lib/factory")):"function"==typeof a&&a.amd&&a(["exports","module","./lib/factory"],f)}(this,function(a,b,c){a=b.exports=c,a.Factory=c})},{"./lib/factory":9}],11:[function(b,c){(function(){"use strict";function b(){}function d(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function e(a){return function(){return this[a].apply(this,arguments)}}var f=b.prototype,g=this,h=g.EventEmitter;f.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},f.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},f.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},f.addListener=function(a,b){var c,e=this.getListenersAsObject(a),f="object"==typeof b;for(c in e)e.hasOwnProperty(c)&&-1===d(e[c],b)&&e[c].push(f?b:{listener:b,once:!1});return this},f.on=e("addListener"),f.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},f.once=e("addOnceListener"),f.defineEvent=function(a){return this.getListeners(a),this},f.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},f.removeListener=function(a,b){var c,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(c=d(f[e],b),-1!==c&&f[e].splice(c,1));return this},f.off=e("removeListener"),f.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},f.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},f.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},f.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},f.removeAllListeners=e("removeEvent"),f.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},f.trigger=e("emitEvent"),f.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},f.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},b.noConflict=function(){return g.EventEmitter=h,b},"function"==typeof a&&a.amd?a(function(){return b}):"object"==typeof c&&c.exports?c.exports=b:this.EventEmitter=b}).call(this)},{}],12:[function(a,b){(function(c){"use strict";"undefined"==typeof window&&(String.prototype.toLocaleLowerCase||(String.prototype.toLocaleLowerCase=String.prototype.toLowerCase),c.window=c,c.navigator={},c.WebSocket=a("websocket").w3cwebsocket,c.XMLHttpRequest=a("xhr2"),c.btoa=a("btoa"),c.localStorage={});var d=a("./src/auth"),e=null,f=null,g=null,h=null,i=null;try{e=a("./src/messaging")}catch(j){}try{f=a("./src/contacts")}catch(j){}try{g=a("./src/presence")}catch(j){}try{h=a("./src/webrtc")}catch(j){}try{i=a("./src/group-chat")}catch(j){}var k=a("js-logger"),l="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,m=a("node-uuid"),n=k.get("SDK"),o="sdk.rtc.sip-instance",p={baseUrl:"sdk.acision.com",persistent:!0},q=[];null!==g&&q.push("presence"),null!==f&&q.push("contacts"),null!==e&&q.push("messaging"),null!==h&&q.push("webrtc"),null!==i&&q.push("groupChat"),k.useDefaults();var r=function(a,b,c){this.apiKey=a,this.callbacks=b,this.config=l.defaults({},c,p),this.refreshTimer=null,this.uuid=localStorage[o],this.uuid||(this.uuid=m.v1(),localStorage[o]=this.uuid),this.initialised=!1,this.allready=!1,this.authenticate()};r.version="1.3.8",r.prototype.version=r.version;var s="onConnected",t="onAuthFailure",u="onDisconnected";r.prototype.authenticate=function(){var a=this;this.auth=new d(this.apiKey,this.config),this.auth.once("error",function(b){n.warn("Authentication error"),a.fireEvent(t,b),a.disconnect()}),this.initialised?this.auth.on("success",function(b){n.info("Authentication refresh successful"),l.extend(a.config,b),a.refreshTimer=setTimeout(l.bind(a.authenticate,a),1e3*a.config.ttl),a.refreshConfig()}):this.auth.on("success",function(b){n.info("Authentication successful"),l.extend(a.config,b),a.config.refreshToken&&(a.config.password=""),a.refreshTimer=setTimeout(l.bind(a.authenticate,a),1e3*a.config.ttl),a.initInterfaces(),a.initialised=!0})},r.prototype.fireEvent=function(a,b){var c=this.callbacks[a];if(l.isFunction(c))try{c(b)}catch(d){n.error("Exception encountered for "+a+"callback:",d)}},r.prototype.initInterfaces=function(){var a=l.bind(this.checkInterfaces,this),b=l.bind(this.disconnect,this);null!==e&&(this.messaging=new e(this),this.messaging.once("ready",a),this.messaging.on("error",b)),null!==f&&(this.contacts=new f(this),this.contacts.once("ready",a),this.contacts.on("error",b)),null!==g&&(this.presence=new g(this),this.presence.once("ready",a),this.presence.on("error",b)),null!==h&&(this.webrtc=new h(this),this.webrtc.once("ready",a),this.webrtc.on("error",b)),null!==i&&(this.groupChat=new i(this),this.groupChat.once("ready",a),this.groupChat.on("error",b)),this.checkInterfaces()},r.prototype.checkInterfaces=function(){var a=this;a.allReady=l.every(q,function(b){return a[b].isReady()}),a.allReady&&l.defer(l.bind(this.fireEvent,this,s))},r.prototype.refreshConfig=function(){var a=this;l.each(q,function(b){a[b].refreshConfig()})},r.prototype.disconnect=function(){var a=this;this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),l.each(q,function(b){a[b]&&a[b].disconnect()}),a.fireEvent(u)},r.prototype.getAddress=function(){var a=this;return a.config.primaryAddress},r.prototype.getDeviceAddress=function(){var a=this;return a.config.primaryAddress+";gr=urn:uuid:"+this.uuid},r.prototype.userAddressFromAddress=function(a){return a.split(";")[0]},r.prototype.getAppConfig=function(){var a=this;return!a.allReady||l.isUndefined(a.config.appConfig)?null:a.config.appConfig},b.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/auth":13,"./src/contacts":15,"./src/group-chat":16,"./src/messaging":17,"./src/presence":19,"./src/webrtc":20,btoa:void 0,"js-logger":3,"node-uuid":4,websocket:void 0,xhr2:void 0}],13:[function(a,b){(function(c){"use strict";function d(a){var b={},c=a.slice(1).split("&");return c.forEach(function(a){a=a.split("="),b[a[0]]=decodeURIComponent(a[1]||"")}),b}var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("wolfy87-eventemitter"),g=a("../lib/wampy"),h=a("js-logger"),i=a("./auth/sasl-x-acision-oauth"),j=a("saslmechanisms"),k=a("sasl-plain"),l=a("sasl-anonymous"),m=h.get("SDK:Auth"),n="http://sdk.acision.com/auth/v1.3",o="connecting",p="authenticating",q="connected",r="disconnecting",s="disconnected",t="PLAIN",u="X-ACISION-OAUTH",v="error",w="success",x=new j.Factory;x.use(k),x.use(i);var y=new j.Factory;y.use(l);var z=function(a,b){var c=this,d=b.baseUrl+"/auth/v1.3";/^wss?:\/\//.test(d)||(d=d.replace(/^.*:\/\//,""),d="wss://"+d),d=d.concat("?apiKey=",a),b.refreshToken&&(d=d.concat("&refreshToken=",b.refreshToken)),this.config=b,this.mech=null,this.state=o,this.ws=new g(d,["wamp"],{autoReconnect:!1,onConnect:function(){c.onConnect()},onClose:function(){c.onClose()},onError:function(){c.state=r,c.emitEvent(v)}})};z.prototype=new f,z.prototype.constructor=z,z.prototype.onConnect=function(){if(this.config.refreshToken)return this.getBootstrapConfig();var a=this;this.state=p,this.ws.call(n+"/requestMechanisms",{callRes:function(b){a.onReceivedMechs(b)},callErr:e.bind(this.handleCallError,this)})},z.prototype.onClose=function(){this.state!==r&&(m.warn("Unexpected disconnect"),this.emitEvent(v)),this.state=s},z.prototype.onReceivedMechs=function(a){var b=this;if(this.mech=this.config.anonymous?y.create(a):x.create(a),!this.mech)return m.warn("No mutually-supported mechanisms:",a),this.state=r,this.ws.disconnect(),void this.emitEvent(v);var c={mechanism:this.mech.name};if(this.mech.clientFirst){var d=this.createCredentials();c.response=btoa(this.mech.response(d))}this.ws.call(n+"/requestAuthentication",{callRes:function(a){return"challenge"===a.type?void b.onChallenge(a.challenge):void b.onOutcome(a.type,a.data)},callErr:e.bind(this.handleCallError,this)},c)},z.prototype.onChallenge=function(a){var b=this,c=this.mech;if(c.name===u){if(c.challenge(atob(a)),c.immediateUrl){var e,f=function(a){var c=JSON.stringify({authCode:a.code});b.sendResponse(c)},g=function(){b.state=r,b.ws.disconnect(),b.emitEvent(v,[{interactiveUrl:c.interactiveUrl}])};if("frame"===this.config.authDisplay){var h=document.createElement("iframe");h.style.display="none",h.id="acisionsdk-oauth-frame",h.src=c.immediateUrl,document.getElementsByTagName("body")[0].appendChild(h),e=h.contentWindow,e.close=function(){h.remove()}}else this.config.authDisplay&&"popup"!==this.config.authDisplay||(e=window.open(c.immediateUrl,"OAuthPopup"));var i=Date.now()+5e3,j=window.setInterval(function(){if(e.location.origin===window.location.origin){window.clearInterval(j);var a=d(e.location.search);return e.close(),void(a.code?f(a):(m.warn("OAuth error:",a),g()))}Date.now()>i&&(window.clearInterval(j),m.warn("OAuth timeout"),g())},500);return}return m.info("Interactive auth required:",c.interactiveUrl),this.state=r,this.ws.disconnect(),void this.emitEvent(v,[{interactiveUrl:c.interactiveUrl}])}m.warn("Unexpected challenge:",a),this.state=r,this.ws.disconnect(),this.emitEvent(v)},z.prototype.sendResponse=function(a){var b=this,c={response:btoa(a)};this.ws.call(n+"/sendResponse",{callRes:function(a){return"challenge"===a.type?void b.onChallenge(a.challenge):void b.onOutcome(a.type,a.data)},callErr:e.bind(this.handleCallError,this)},c)},z.prototype.onOutcome=function(a,b){return"success"===a?(this.state=q,void this.getBootstrapConfig()):(m.warn("Unsuccessful outcome:",a,b),this.state=r,this.ws.disconnect(),void this.emitEvent(v))},z.prototype.createCredentials=function(){var a=this.config,b={};return this.mech.name===t?(b.username=a.username,b.password=a.password):this.mech.name===u&&(b.username=a.username,a.authAccessToken?b.authAccessToken=a.password:a.password&&(b.authCode=a.password)),b},z.prototype.getBootstrapConfig=function(){var a=this;this.ws.call(n+"/getBootstrapConfig",{callRes:function(b){a.state=r,a.ws.disconnect(),a.emitEvent(w,[b])},callErr:e.bind(this.handleCallError,this)})},z.prototype.handleCallError=function(a,b,c){m.warn("Auth call error:",a,b,c),this.state=r,this.ws.disconnect(),this.emitEvent(v)},b.exports=z}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/wampy":2,"./auth/sasl-x-acision-oauth":14,"js-logger":3,"sasl-anonymous":6,"sasl-plain":8,saslmechanisms:10,"wolfy87-eventemitter":11}],14:[function(a,b){function c(){}c.prototype.name="X-ACISION-OAUTH",c.prototype.clientFirst=!0,c.prototype.response=function(a){return JSON.stringify(a)},c.prototype.challenge=function(a){return a=JSON.parse(a),this.interactiveUrl=a.interactiveUrl,this.immediateUrl=a.immediateUrl,this},b.exports=c},{}],15:[function(a,b){(function(c){"use strict";var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=a("js-logger"),f=a("./network-api"),g=e.get("SDK:Contacts"),h="1.3",i=function(a){var b=a.config.interfaces.contacts,c=null;b&&(c=b.restEndpoints[h]),this.init(a,!!b,null,c)};i.prototype=new f(null),i.prototype.constructor=i,i.PRESENCE_ALLOW_GROUP_ID="_allow",i.PRESENCE_BLOCK_GROUP_ID="_block",i.PRESENCE_PENDING_GROUP_ID="_pending",i.GroupType={PRIVATE:"private",SHARED:"shared",SPECIAL:"special"},i.SharedGroupContactStatus={INVITED:"invited",PENDING:"pending",ACCEPTED:"accepted"},i.SharedGroupContactType={FOLLOWER:"follower",MEMBER:"member",OWNER:"owner"},i.prototype.setGroup=function(a,b,c){this.sendRequest("PUT","lists/"+a,b,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.getGroup=function(a,b){this.sendRequest("GET","lists/"+a,null,function(a){b&&d.isFunction(b.onSuccess)&&b.onSuccess(a)},function(a){return"ResourceNotFound"===a.code?void(b&&d.isFunction(b.onSuccess)&&b.onSuccess([])):void(b&&d.isFunction(b.onError)&&b.onError(a.code,a.message))})},i.prototype.deleteGroup=function(a,b){this.sendRequest("DELETE","lists/"+a,null,function(){b&&d.isFunction(b.onSuccess)&&b.onSuccess()},function(a){b&&d.isFunction(b.onError)&&b.onError(a.code,a.message)})},i.prototype.addToGroup=function(a,b,c){this.sendRequest("POST","lists/"+a+"/add",b,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.removeFromGroup=function(a,b,c){this.sendRequest("POST","lists/"+a+"/remove",b,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.getUserConfig=function(a){this.sendRequest("GET","settings",null,function(b){g.debug("getUserConfig succeeded"),a&&d.isFunction(a.onSuccess)&&a.onSuccess(b)},function(b){g.warn("getUserConfig failed"),a&&d.isFunction(a.onError)&&a.onError(b.code,b.message)})},i.prototype.setUserConfig=function(a,b){this.sendRequest("PUT","settings",a,function(){g.debug("setUserConfig succeeded"),b&&d.isFunction(b.onSuccess)&&b.onSuccess()},function(a){g.warn("setUserConfig failed"),b&&d.isFunction(b.onError)&&b.onError(a.code,a.message)})},i.prototype.getGroupContacts=function(a,b){this._getGroupContactsImpl(a,b,null)},i.prototype.addContactToGroup=function(a,b,c){if(!d.isString(a)||!d.isString(b))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/addcontacts",f=[{address:b}];this.sendRequest("POST",e,f,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.removeContactFromGroup=function(a,b,c){if(!d.isString(a)||!d.isString(b))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/removecontacts",f=[b];this.sendRequest("POST",e,f,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.getMyGroups=function(a){this._getMyGroupsImpl(a,null)},i.prototype.getContactDetails=function(a,b,c){if(2===arguments.length&&(c=b,b=this.sdk.config.primaryAddress),!(d.isString(a)&&d.isString(b)&&c&&d.isFunction(c.onSuccess)))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/contact/"+encodeURIComponent(b);this.sendRequest("GET",e,null,function(a){c.onSuccess(!0,a.type,a.contact)},function(a){"ResourceNotFound"===a.code?c.onSuccess(!1,null,null):d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.createGroup=function(a,b,c){if(!(d.isString(a)&&d.isString(b)&&c&&d.isFunction(c.onSuccess)))throw new Error("Invalid parameters");if("private"!==b&&"shared"!==b)throw new Error("Invalid parameters");var e="groups",f={label:a,type:b};this.sendRequest("POST",e,f,function(a){c.onSuccess(a.group_id)},function(a){d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.getGroupDetails=function(a,b){if(!d.isString(a)||!b||!d.isFunction(b.onSuccess))throw new Error("Invalid parameters");var c="groups/"+encodeURIComponent(a)+"/details";this.sendRequest("GET",c,null,function(a){b.onSuccess({id:a.group_id,name:a.label,type:a.type})},function(a){d.isFunction(b.onError)&&b.onError(a.code,a.message)})},i.prototype.setGroupName=function(a,b,c){if(!d.isString(a)||!d.isString(b))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a),f={label:b};this.sendRequest("POST",e,f,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.getSharedGroupPendingContacts=function(a,b){this._getGroupContactsImpl(a,b,"pending=true")},i.prototype.approveSharedGroupContact=function(a,b,c){if(!d.isString(a)||!d.isString(b))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/updatecontact",f={address:b,status:"accepted"};this.sendRequest("POST",e,f,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.rejectSharedGroupContact=function(a,b,c){this.removeContactFromGroup(a,b,c)},i.prototype.changeSharedGroupContact=function(a,b,c,e){if(!d.isString(a)||!d.isString(b)||!d.isString(c))throw new Error("Invalid parameters");var f="groups/"+encodeURIComponent(a)+"/updatecontact",g={address:b,type:c};this.sendRequest("POST",f,g,function(){e&&d.isFunction(e.onSuccess)&&e.onSuccess()},function(a){e&&d.isFunction(e.onError)&&e.onError(a.code,a.message)})},i.prototype.getMyPendingSharedGroups=function(a){this._getMyGroupsImpl(a,"pending=true")},i.prototype.joinSharedGroup=function(a,b,c){if(!d.isString(a)||!d.isString(b))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/join",f={type:b};this.sendRequest("POST",e,f,function(){c&&d.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&d.isFunction(c.onError)&&c.onError(a.code,a.message)})},i.prototype.leaveSharedGroup=function(a,b){if(!d.isString(a))throw new Error("Invalid parameters");var c="groups/"+encodeURIComponent(a)+"/leave";this.sendRequest("POST",c,null,function(){b&&d.isFunction(b.onSuccess)&&b.onSuccess()},function(a){b&&d.isFunction(b.onError)&&b.onError(a.code,a.message)})},i.prototype._getGroupContactsImpl=function(a,b,c){if(!d.isString(a)||!b||!d.isFunction(b.onSuccess))throw new Error("Invalid parameters");var e="groups/"+encodeURIComponent(a)+"/contacts";c&&(e+="?"+c),this.sendRequest("GET",e,null,function(a){b.onSuccess(a.type,a.contacts)},function(a){d.isFunction(b.onError)&&b.onError(a.code,a.message)})},i.prototype._getMyGroupsImpl=function(a,b){if(!a||!d.isFunction(a.onSuccess))throw new Error("Invalid parameters");var c="groups";b&&(c+="?"+b),this.sendRequest("GET",c,null,function(b){a.onSuccess(d.map(b,function(a){return{id:a.group_id,name:a.label,type:a.type}}))},function(b){d.isFunction(a.onError)&&a.onError(b.code,b.message)})},b.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":18,"js-logger":3}],16:[function(a,b){(function(c){"use strict";function d(a,b){return e.isArray(a)||(a=[a]),e.map(a,function(a){return a.indexOf("@")<0?a.concat("@",b):a})}var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("js-logger"),g=a("./network-api"),h=f.get("SDK:GroupChat"),i="1.3",j="addedToChatRoom",k="chatRoomUpdated",l=function(a){var b=a.config.interfaces.chat,c=null;b&&(c=b.restEndpoints[i]),this.init(a,!!b,null,c),this.groupChatCallbacks={},this.recordingRefreshTasks={}};l.prototype=new g(null),l.prototype.constructor=l,l.prototype.disconnect=function(){this._cancelAllRecordingRefreshTasks(),g.prototype.disconnect.call(this)},l.RoomType={AD_HOC:"ad-hoc",SHARED_GROUP:"shared-group"},l.ArchivedRoomEventType={UPDATE:"update",MESSAGE:"message"},l.prototype.createAdHocChatRoom=function(a,b,c){if(!b||!c)throw new Error("members and callbacks may not be null.");if(e.isEmpty(b))throw new Error("members may not be empty.");this._createChatRoomInternal(b,null,a,c)},l.prototype.createChatRoomForSharedGroup=function(a,b,c){if(!a||!c)throw new Error("groupId and callbacks may not be null.");this._createChatRoomInternal(null,a,b,c)},l.prototype._createChatRoomInternal=function(a,b,c,f){var g=this.sdk.config,i={};b?i.groupId=b:a&&(a=d(a,g.defaultDomain),i.members=a),c&&(i.subject=c),this.sendRequest("POST","rooms/create",i,function(a){h.debug("Create chat room success "+a.roomId),e.isFunction(f.onSuccess)&&f.onSuccess(a.roomId)},function(a){h.warn("Create chat room failed"),e.isFunction(f.onError)&&f.onError(a.code,a.message)})},l.prototype.updateAdHocChatRoom=function(a,b,c,d){if(!a)throw new Error("roomId may not be null.");if(e.isEmpty(a))throw new Error("roomId may not be empty.");if(e.isNull(b)){if(e.isNull(c))throw new Error("subject and additionalMembers may not both be null.");if(e.isEmpty(c))throw new Error("additionalMembers may not be empty.")}this._updateChatRoomInternal(a,b,c,d)},l.prototype.updateSharedGroupChatRoom=function(a,b,c){if(!a)throw new Error("roomId may not be null.");if(e.isEmpty(a))throw new Error("roomId may not be empty.");if(e.isNull(b))throw new Error("subject may not be null.");this._updateChatRoomInternal(a,b,null,c)},l.prototype._updateChatRoomInternal=function(a,b,c,f){var g=this.sdk.config,i={};b&&(i.subject=b),c&&(c=d(c,g.defaultDomain),i.additionalMembers=c),this.sendRequest("POST","rooms/"+a+"/update",i,function(){h.debug("Update chat room success"),f&&e.isFunction(f.onSuccess)&&f.onSuccess()},function(a){h.warn("Update chat room failed"),f&&e.isFunction(f.onError)&&f.onError(a.code,a.message)})},l.prototype.leaveAdHocChatRoom=function(a,b){if(!a)throw new Error("roomId may not be null.");if(e.isEmpty(a))throw new Error("roomId may not be empty.");this.sendRequest("POST","rooms/"+a+"/removeSelf",null,function(){h.debug("Leave chat room success"),b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){h.warn("Leave chat room failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},l.prototype.getChatRoomDetails=function(a,b){if(!a||!b)throw new Error("roomId and callbacks may not be null.");if(e.isEmpty(a))throw new Error("roomId may not be empty.");this.sendRequest("GET","rooms/"+a,null,function(c){h.debug("Get chat room details success");var d,f=c.subject,g=null,i=null;c.groupId?(g=c.groupId,d="shared-group"):c.members&&(i=c.members,d="ad-hoc"),b&&e.isFunction(b.onSuccess)&&b.onSuccess(a,f,d,i,g)},function(a){h.warn("Get chat room details failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},l.prototype.sendToChatRoom=function(a,b,c,d){var f=this;f.sdk.messaging?f.sdk.messaging._sendToChatRoom(a,null,b,c,function(a){d&&e.isFunction(d.onAcknowledged)&&d.onAcknowledged(a)},function(a,b){d&&e.isFunction(d.onError)&&d.onError(a,b)}):h.warn("Attempt to send group chat message with no messaging interface")},l.prototype.sendPrivatelyToChatRoomMember=function(a,b,c,d,f){var g=this;g.sdk.messaging?g.sdk.messaging._sendToChatRoom(a,b,c,d,function(a){f&&e.isFunction(f.onAcknowledged)&&f.onAcknowledged(a)},function(a,b){f&&e.isFunction(f.onError)&&f.onError(a,b)}):h.warn("Attempt to send group chat message with no messaging interface")},l.prototype.replyToChatRoom=function(a,b,c,d){this.sendToChatRoom(a.roomId,b,c,d)},l.prototype.replyPrivatelyToSender=function(a,b,c,d){this.sendPrivatelyToChatRoomMember(a.roomId,a.from,b,c,d)},l.prototype.getArchivedAdHocRooms=function(a,b,c){if(!c||!e.isFunction(c.onResult))throw new Error("Invalid parameters");if(e.isNumber(a))a=new Date(1e3*a);else if(a){if(!e.isDate(a))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else a=new Date;var d="archiveRooms";d+="?start="+a.getTime(),d+="&direction="+(b?"before":"after"),this._getArchivedRoomsImpl(d,null,c)},l.prototype.getArchivedSharedGroupRooms=function(a,b,c,d){if(!d||!e.isFunction(d.onResult)||!a)throw new Error("Invalid parameters");if(e.isNumber(b))b=new Date(1e3*b);else if(b){if(!e.isDate(b))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else b=new Date;var f="archiveRooms";f+="?start="+b.getTime(),f+="&direction="+(c?"before":"after"),f+="&groupId="+a,this._getArchivedRoomsImpl(f,null,d)},l.prototype._getArchivedRoomsImpl=function(a,b,c){var d=this,f=a;b&&(f+="&token="+b),this.sendRequest("GET",f,null,function(b){var f=e.map(b.rooms,function(a){var b={roomId:a.roomId,creationTime:new Date(a.created),creator:a.creator,initialSubject:a.initialSubject};return a.groupId?(b.groupId=a.groupId,b.roomType="shared-group"):a.initialMembers&&(b.initialMembers=a.initialMembers,b.roomType="ad-hoc"),b});c.onResult(f,!b.token),b.token&&d._getArchivedRoomsImpl(a,b.token,c)},function(a){e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getArchivedRoomEvents=function(a,b,c,d){if(!e.isString(a)||""===a||!d||!e.isFunction(d.onResult))throw new Error("Invalid parameters");if(e.isNumber(b))b=new Date(1e3*b);else if(b){if(!e.isDate(b))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else b=new Date;this._getArchivedRoomEventsImpl(a,b.getTime(),c,null,d)},l.prototype._getArchivedRoomEventsImpl=function(a,b,c,d,f){var g=this,h="archiveRooms/"+a+"/history";h+="?start="+b,h+="&direction="+(c?"before":"after"),d&&(h+="&token="+d),this.sendRequest("GET",h,null,function(d){var h=e.chain(d.events).map(function(a){var b={eventTime:new Date(a.timestamp)};if(a.update)b.type="update",b.user=a.update.user,a.update.subject&&(b.subject=a.update.subject),a.update.added&&(b.addedMembers=a.update.added),a.update.removed&&(b.removedMembers=a.update.removed);else{if(!a.message)return!1;b.type="message",b.from=a.message.from,b.privateMessage=!!a.message.to,b.to=a.message.to,a.message.contentType&&(b.contentType=a.message.contentType),b.content=a.message.content}return b}).compact().value();f.onResult(h,!d.token),d.token&&g._getArchivedRoomEventsImpl(a,b,c,d.token,f)},function(a){e.isFunction(f.onError)&&f.onError(a.code,a.message)})},l.prototype.setCallbacks=function(a){if(!a)throw new Error("callbacks may not be null.");this.groupChatCallbacks=a},l.prototype.startRecordingChatRoom=function(a,b){this._recordChatRoomInternal(!0,a,b)},l.prototype.stopRecordingChatRoom=function(a,b){this._recordChatRoomInternal(!1,a,b)},l.prototype._recordChatRoomInternal=function(a,b,c){var d=this;if(!b)throw new Error("Must specify the room ID.");var f;a?f="rooms/"+b+"/startRecording":(f="rooms/"+b+"/stopRecording",d._cancelRecordingRefreshTask(b)),this.sendRequest("POST",f,null,function(f){h.debug("start / stop recording succeeded"),c&&e.isFunction(c.onSuccess)&&c.onSuccess(),a&&(e.isUndefined(f.refreshDelay)||d._setRecordingRefreshTask(b,f.refreshDelay))},function(a){h.warn("start / stop recording failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype._setRecordingRefreshTask=function(a,b){var c=this,d=a,e=this.recordingRefreshTasks[d];e||(this.recordingRefreshTasks[d]=setInterval(function(a){c.startRecordingChatRoom(a,null)},1e3*b,a))},l.prototype._cancelRecordingRefreshTask=function(a){var b=a,c=this.recordingRefreshTasks[b];c&&(clearInterval(c),delete this.recordingRefreshTasks[b])},l.prototype._cancelAllRecordingRefreshTasks=function(){var a=this;h.debug("Cancelling all");var b=e.keys(a.recordingRefreshTasks);e.each(b,function(b){h.debug("Cancelling key "+b),clearInterval(a.recordingRefreshTasks[b]),delete a.recordingRefreshTasks[b]})},l.prototype._handleChatRoomEvent=function(a){var b=this;if(!b.groupChatCallbacks)return void h.warn("Received chat room event, but no callbacks set");if(j===a.event||k===a.event){
var c,d=a.roomId,f=a.subject,g=null,i=null;a.groupId?(g=a.groupId,c="shared-group"):a.members&&(i=a.members,c="ad-hoc"),j===a.event?(h.debug("Added to chat room "+d+" (subject "+f+")"),e.isFunction(b.groupChatCallbacks.onAddedToChatRoom)&&b.groupChatCallbacks.onAddedToChatRoom(d,f,c,i,g)):k===a.event?(h.debug("Chat room updated "+d+" (subject "+f+")"),e.isFunction(b.groupChatCallbacks.onChatRoomUpdated)&&b.groupChatCallbacks.onChatRoomUpdated(d,f,c,i,g)):h.warn("Received unknown chat room event - "+a.event)}},l.prototype._handleChatRoomMessage=function(a,b,c,d,f){var g=this;if(!g.groupChatCallbacks)return void h.warn("Received chat room message, but no callbacks set");var i={};i.from=c,i.contentType=f,i.content=d,a?(i.roomId=a,i.privateMessage=!1):(i.roomId=b,i.privateMessage=!0),e.isFunction(g.groupChatCallbacks.onMessage)&&g.groupChatCallbacks.onMessage(i.roomId,i)},b.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":18,"js-logger":3}],17:[function(a,b){(function(c){"use strict";function d(a,b){return g.isArray(a)||(a=[a]),g.map(a,function(a){return a.indexOf("@")<0?a.concat("@",b):a})}function e(a){var b=[];if(a&&"deliveryModes"in a)for(var c=a.deliveryModes.length,d=0;c>d;d++)y.indexOf(a.deliveryModes[d])>-1?b.push(a.deliveryModes[d]):k.warn("Found invalid delivery mode "+a.deliveryModes[d]);else a&&"advancedServices"in a&&(k.warn('"advancedServices" option is deprecated use "deliveryModes"'),a.advancedServices===r?b=[w]:a.advancedServices===s?b=[t,u,w]:a.advancedServices===q&&(b=[t,u,v]));return b}function f(a,b,c,d,e){var f={};f.token=b,f.appARN=c,f.notificationMessage=d,a.sendRequest("POST","requestMessageNotification",f,function(){k.debug("requestMessageNotification succeeded"),e&&g.isFunction(e.onAcknowledged)&&e.onAcknowledged()},function(a){k.warn("requestMessageNotification failed"),e&&g.isFunction(e.onError)&&e.onError(a.code,a.message)})}var g="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,h=a("js-logger"),i=a("./network-api"),j=a("node-uuid"),k=h.get("SDK:Msg"),l=h.get("SDK:Msg:FileXfer"),m="http://sdk.acision.com/messaging/v1.3/",n="1.3",o="application/x-acision-sdk-file-transfer",p="application/x-acision-sdk-chat-room-event",q="never",r="always",s="fallback",t="immediate",u="push",v="offline",w="fallback",x="pushOnly",y=[t,u,v,w,x],z=[t,u,v],A=function(a){var b=a.config.interfaces.messaging,c=null,d=null;b&&(c=b.wsEndpoints[n],d=b.restEndpoints[n]),this.init(a,!!b,c,d),this.deliveryModes=z,this.pendingFileTransfers={},this.pendingFileUploadIDs={},this.pendingFileUploadAborts={},this.recordingRefreshTasks={}};A.prototype=new i(m),A.prototype.constructor=A,A.ArchivedMessageStatus={PENDING:"pending",DELIVERED:"delivered"},A.prototype.disconnect=function(){this._cancelAllRecordingRefreshTasks(),i.prototype.disconnect.call(this)},A.prototype.sendToDestination=function(a,b,c,f){var h=this.sdk.config;a=d(a,h.defaultDomain);var i={from:c&&c.from||h.primaryAddress,to:a,content:b};c&&c.contentType&&(i.contentType=c.contentType),c&&c.subject&&(i.subject=c.subject);var l=e(c);0===l.length&&(l=this.deliveryModes),i.delivery_modes=l,c&&c.ttl&&(i.ttl=c.ttl),c&&c.data&&(i.data=c.data),this.sendRequest("POST","sendMessage",i,function(a){if(k.debug("sendMessage succeeded"),f&&g.isFunction(f.onAcknowledged)){var b;a&&a.msgid?b=a.msgid:(k.debug("v1.0 compatibility: generating local message ID"),b=j.v1()),f.onAcknowledged(b)}},function(a){k.warn("sendMessage failed"),f&&g.isFunction(f.onError)&&f.onError(a.code,a.message)})},A.prototype.sendToDestinations=A.prototype.sendToDestination,A.prototype.sendToGroup=function(a,b,c,d){var f=this.sdk.config;g.isArray(a)||(a=[a]);var h={from:c&&c.from||f.primaryAddress,toGroup:a,content:b};c&&c.contentType&&(h.contentType=c.contentType),c&&c.subject&&(h.subject=c.subject);var i=e(c);0===i.length&&(i=this.deliveryModes),h.delivery_modes=i,c&&c.ttl&&(h.ttl=c.ttl),c&&c.data&&(h.data=c.data),this.sendRequest("POST","sendMessage",h,function(a){if(k.debug("sendMessage succeeded"),d&&g.isFunction(d.onAcknowledged)){var b;a&&a.msgid?b=a.msgid:(k.debug("v1.0 compatibility: generating message ID"),b=j.v1()),d.onAcknowledged(b)}},function(a){k.warn("sendMessage failed"),d&&g.isFunction(d.onError)&&d.onError(a.code,a.message)})},A.prototype.sendToGroupId=function(a,b,c,d){var f=this.sdk.config;g.isArray(a)||(a=[a]);var h={from:c&&c.from||f.primaryAddress,toGroupId:a,content:b};c&&c.contentType&&(h.contentType=c.contentType),c&&c.subject&&(h.subject=c.subject);var i=e(c);0===i.length&&(i=this.deliveryModes),h.delivery_modes=i,c&&c.ttl&&(h.ttl=c.ttl),c&&c.data&&(h.data=c.data),this.sendRequest("POST","sendMessage",h,function(a){if(k.debug("sendMessage succeeded"),d&&g.isFunction(d.onAcknowledged)){var b;a&&a.msgid?b=a.msgid:(k.debug("v1.0 compatibility: generating message ID"),b=j.v1()),d.onAcknowledged(b)}},function(a){k.warn("sendMessage failed"),d&&g.isFunction(d.onError)&&d.onError(a.code,a.message)})},A.prototype._sendToChatRoom=function(a,b,c,f,h,i){var l=this.sdk.config,m={from:f&&f.from||l.primaryAddress,content:c};b?(b=d(b,l.defaultDomain),m.to=b,m.chatRoomId=a):m.toChatRoomId=a,f&&f.contentType&&(m.contentType=f.contentType);var n=e(f);0===n.length&&(n=this.deliveryModes),m.delivery_modes=n,f&&f.ttl&&(m.ttl=f.ttl),this.sendRequest("POST","sendMessage",m,function(a){if(k.debug("sendMessage succeeded"),g.isFunction(h)){var b;a&&a.msgid?b=a.msgid:(k.debug("v1.0 compatibility: generating local message ID"),b=j.v1()),h(b)}},function(a){k.warn("sendMessage failed"),g.isFunction(i)&&i(a.code,a.message)})},A.prototype.sendFileToDestination=function(a,b,c){var e=this.sdk.config,f=this,h=g.unique();a=d(a,e.defaultDomain);var i={from:e.primaryAddress,to:a,contentType:b.contentType||b.file.type||"application/octet-stream",fileName:b.file.name,message:b.message};return g.isUndefined(b.file.size)||(i.contentLength=b.file.size),g.isUndefined(b.contentDisposition)||(i.contentDisposition=b.contentDisposition),g.isUndefined(b.subject)||(i.subject=b.subject),l.info("Sending request to upload file\n",b.file),this.sendRequest("POST","allocateFile",i,function(a){return l.info(a.serverId+": Obtained file transfer ID"),f.pendingFileTransfers[a.serverId]={serverId:a.serverId,params:i,file:b.file,callbacks:c,internalId:h,delayAbort:!1},f.pendingFileUploadIDs[h]=a.serverId,f.pendingFileUploadAborts[h]?(delete f.pendingFileUploadAborts[h],void f._sendAbortFile(a.serverId,!0)):void 0},function(a){l.warn("Request failed: "+a.code+": "+a.message),c&&g.isFunction(c.onError)&&c.onError(a.code,a.message)}),{abort:function(){g.isUndefined(f.pendingFileUploadIDs[h])?f.pendingFileUploadAborts[h]=!0:f._sendAbortFile(f.pendingFileUploadIDs[h],!0)}}},A.prototype._putFile=function(a){var b=this;if(g.isUndefined(this.pendingFileTransfers[a.serverId]))return void l.error(a.serverId+": Unknown ID in file upload message");var c=this.pendingFileTransfers[a.serverId];return a.accept?(l.info(a.serverId+": Preparing file upload"),c.xhr=new XMLHttpRequest,c.xhr.open("PUT",a.url),c.xhr.setRequestHeader("Content-Type",c.params.contentType),c.xhr.setRequestHeader("Content-Disposition",c.params.contentDisposition),c.xhr.setRequestHeader("x-awz-meta-filename",c.params.fileName),c.xhr.addEventListener("load",function(){return this.status<200||this.status>=300?void b._fileTransferError(c.serverId,!0,this.response||{code:"RestError",message:"Unknown error: "+this.status}):(l.info(a.serverId+": File upload succeeded"),l.info(a.serverId+": Notifying server"),void b.sendRequest("POST","sendFile",{serverId:c.serverId},function(){}))}),c.callbacks&&g.isFunction(c.callbacks.onProgress)&&c.xhr.upload.addEventListener("progress",function(a){c.callbacks.onProgress(a.lengthComputable||!g.isUndefined(a.total)?a.total:void 0,a.loaded)}),c.xhr.addEventListener("error",g.bind(b._fileTransferError,b,c.serverId,!0,{code:"NetworkError",message:"A network error was encountered"})),c.xhr.addEventListener("abort",g.bind(b._fileTransferError,b,c.serverId,!0,{code:"AbortError",message:"The request was aborted"})),c.xhr.addEventListener("timeout",g.bind(b._fileTransferError,b,c.serverId,!0,{code:"TimeoutError",message:"The request timed out"})),l.info(a.serverId+": Uploading file"),void c.xhr.send(c.file)):void b._fileTransferError(c.serverId,!0,{code:"Rejected",message:"Rejected by recipient"},!0)},A.prototype._getFile=function(a){var b=this;if(g.isUndefined(this.pendingFileTransfers[a.serverId]))return void l.error(a.serverId+": Unknown ID in file download message");var c=this.pendingFileTransfers[a.serverId],d=g.omit(c.params,["contentType","contentDisposition","fileName","message","contentLength"]);g.extend(d,g.pick(a,["contentType","contentDisposition","fileName","message"])),d.fileSize=a.contentLength,l.info(a.serverId+": Preparing file download"),c.xhr=new XMLHttpRequest,c.xhr.open("GET",a.url),c.xhr.responseType="blob",c.xhr.addEventListener("load",function(){return this.status<200||this.status>=300?void b._fileTransferError(c.serverId,!1,this.response||{code:"RestError",message:"Unknown error: "+this.status}):(l.info(a.serverId+": File download succeeded"),l.info(a.serverId+": Notifying server"),b.sendRequest("POST","receivedFile",{serverId:c.serverId},function(){}),delete b.pendingFileTransfers[a.serverId],delete b.pendingFileUploadIDs[c.internalId],void c.callbacks.onDownloaded(d,c.xhr.response))}),c.callbacks&&g.isFunction(c.callbacks.onProgress)&&c.xhr.addEventListener("progress",function(a){c.callbacks.onProgress(a.lengthComputable||!g.isUndefined(a.total)?a.total:void 0,a.loaded)}),c.xhr.addEventListener("error",g.bind(b._fileTransferError,b,c.serverId,!1,{code:"NetworkError",message:"A network error was encountered"})),c.xhr.addEventListener("abort",g.bind(b._fileTransferError,b,c.serverId,!1,{code:"AbortError",message:"The request was aborted"})),c.xhr.addEventListener("timeout",g.bind(b._fileTransferError,b,c.serverId,!1,{code:"TimeoutError",message:"The request timed out"})),l.info(a.serverId+": Downloading file"),c.xhr.send(c.file)},A.prototype._fileTransferError=function(a,b,c,d){if(l.warn(a+": File transfer failed: "+c.code+": "+c.message),!g.isUndefined(this.pendingFileTransfers[a])){var e=this.pendingFileTransfers[a];d||this._sendAbortFile(a,b),e.callbacks&&g.isFunction(e.callbacks.onError)&&e.callbacks.onError(c.code,"File transfer failed: "+c.message)}},A.prototype._incomingFile=function(a,b){var c=this,d=g.pick(a,["from","to","toGroup","subject"]);g.extend(d,g.pick(a.content,["contentType","contentLength","contentDisposition","fileName","message"]));var e={params:d,serverId:a.content.serverId,delayAbort:!0};if(this.pendingFileTransfers[e.serverId]=e,g.isFunction(b)){var f=g.omit(d,"contentLength");g.isUndefined(d.contentLength)||(f.fileSize=d.contentLength),f.accept=g.bind(c._sendAcceptFile,c,a.content.serverId),f.reject=g.bind(c._sendRejectFile,c,a.content.serverId),f.abort=g.bind(c._sendAbortFile,c,a.content.serverId,!1),b(f)}else this._sendRejectFile(e.serverId)},A.prototype._downloadedFile=function(a){if(g.isUndefined(this.pendingFileTransfers[a.serverId]))return void l.error(a.serverId+": Unknown ID in file upload message");var b=this.pendingFileTransfers[a.serverId];b.callbacks&&g.isFunction(b.callbacks.onAcknowledged)&&b.callbacks.onAcknowledged(),delete this.pendingFileTransfers[a.serverId],delete this.pendingFileUploadIDs[b.internalId]},A.prototype._abortedFile=function(a){if(g.isUndefined(this.pendingFileTransfers[a.serverId]))return void l.error(a.serverId+": Unknown ID in file transfer message");l.info(a.serverId+": Aborting file transfer");var b=this.pendingFileTransfers[a.serverId];if(b.delayAbort)return l.info(a.serverId+": Delaying abort until accept/reject"),void(b.pendingAbort=!0);delete this.pendingFileTransfers[a.serverId],delete this.pendingFileUploadIDs[b.internalId],b.xhr&&b.xhr.abort();var c={serverId:b.serverId,senderInitiated:a.senderInitiated};this.sendRequest("POST","abortAckFile",c,function(){l.info(b.serverId+": Ack'd abort")},function(a){l.info(b.serverId+": Ack failed: "+a.code+": "+a.message)}),b.callbacks&&g.isFunction(b.callbacks.onError)&&b.callbacks.onError("Aborted","File transfer failed: Aborted by user")},A.prototype._sendAcceptFile=function(a,b){if(g.isUndefined(this.pendingFileTransfers[a]))return void l.error(a+": Accepting unknown ID");var c=this.pendingFileTransfers[a];if(c.callbacks=b,c.delayAbort=!1,c.pendingAbort)return l.info(a+": Acting on delayed abort"),void this._abortedFile({serverId:c.serverId,senderInitiated:!0});var d={serverId:c.serverId,accept:!0};l.info(c.serverId+": Accepting file"),this.sendRequest("POST","acceptFile",d,function(){l.info(c.serverId+": Accepted file")},function(a){l.info(c.serverId+": Acceptance failed: "+a.code+": "+a.message),b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype._sendRejectFile=function(a){if(g.isUndefined(this.pendingFileTransfers[a]))return void l.error(a+": Rejecting unknown ID");var b=this.pendingFileTransfers[a];if(b.delayAbort=!1,b.pendingAbort)return l.info(a+": Acting on delayed abort"),void this._abortedFile({serverId:b.serverId,senderInitiated:!0});delete this.pendingFileTransfers[a],delete this.pendingFileUploadIDs[b.internalId];var c={serverId:b.serverId,accept:!1};l.info(b.serverId+": Rejecting file"),this.sendRequest("POST","acceptFile",c,function(){l.info(b.serverId+": Rejected file")},function(a){l.info(b.serverId+": Rejection failed: "+a.code+": "+a.message)})},A.prototype._sendAbortFile=function(a,b){if(g.isUndefined(this.pendingFileTransfers[a]))return void l.error(a+": Aborting unknown ID");l.info(a+": Aborting file transfer");var c=this.pendingFileTransfers[a];delete this.pendingFileTransfers[a],delete this.pendingFileUploadIDs[c.internalId],c.xhr&&c.xhr.abort();var d={serverId:c.serverId,senderInitiated:b};this.sendRequest("POST","abortFile",d,function(){l.info(c.serverId+": Aborted file")},function(a){l.info(c.serverId+": Abort failed: "+a.code+": "+a.message)})},A.prototype.setCallbacks=function(a){var b=this;if(!this.ws)throw new Error('Cannot set callbacks for a non-persistent connection. Use "requestMessageNotification"');a.onMessage&&this.ws.subscribe(m+"message?device="+this.sdk.uuid,function(c){switch(c.contentType){case o:switch(c.content.state){case"accept":b._putFile(c.content);break;case"downloaded":b._downloadedFile(c.content);break;case"request":b._incomingFile(c,a.onFileAvailable);break;case"ready":b._getFile(c.content);break;case"aborted":b._abortedFile(c.content);break;case"abortedack":break;default:k.error("Unexpected file transfer message",c)}break;case p:b.sdk.groupChat&&b.sdk.groupChat._handleChatRoomEvent(c.content);break;default:var d=c.toChatRoomId,e=c.chatRoomId;d||e?b.sdk.groupChat&&b.sdk.groupChat._handleChatRoomMessage(d,e,c.from,c.content,c.contentType):a.onMessage(c)}})},A.prototype.requestMessageNotification=function(a,b,c,d){if(this.ws)throw new Error('Do not request Message Notification for a persistent connection. Use "setCallbacks"');if(!a)throw new Error('Must specify "token" parameter');if(!b)throw new Error('Must specify "appARN" parameter');if(!c)throw new Error('Must specify "notificationMessage" parameter');var e=this;f(e,a,b,c,d),setInterval(function(){f(e,a,b,c,d)},3e5)},A.prototype.getMessages=function(a,b){if(this.ws)throw new Error('Do not use getMessages for a persistent connection. Use "setCallbacks"');if(!a)throw new Error("Must specify a unique identifier for this instance.");var c={};c.uniqueId=a,this.sendRequest("GET","getMessages/"+a,c,function(){k.debug("getMessages succeeded"),b&&g.isFunction(b.onAcknowledged)&&b.onAcknowledged()},function(a){k.warn("getMessages failed"),b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype.recallMessage=function(a,b){if(!a)throw new Error("Must specify the message to recall.");var c={msgid:a};this.sendRequest("POST","recallMessage",c,function(a){k.debug("recallMessage succeeded"),b&&g.isFunction(b.onResult)&&b.onResult(a.unread)},function(a){k.warn("recallMessage failed"),b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype.startRecordingConversation=function(a,b,c){this._recordConversationInternal(!0,a,b,c)},A.prototype.stopRecordingConversation=function(a,b,c){this._recordConversationInternal(!1,a,b,c)},A.prototype._recordConversationInternal=function(a,b,c,e){var f=this,h=this.sdk.config;if(!b)throw new Error("Must specify the other party of the conversation.");c||(c=""),b=d(b,h.defaultDomain)[0];var i,j={subject:c,otherParty:b};a?i="startRecording":(i="stopRecording",f._cancelRecordingRefreshTask(b,c)),this.sendRequest("POST",i,j,function(d){k.debug("start / stop recording succeeded"),e&&g.isFunction(e.onSuccess)&&e.onSuccess(),a&&(g.isUndefined(d.refreshDelay)||f._setRecordingRefreshTask(b,c,d.refreshDelay))},function(a){k.warn("start / stop recording failed"),e&&g.isFunction(e.onError)&&e.onError(a.code,a.message)})},A.prototype._setRecordingRefreshTask=function(a,b,c){var d=this,e=a+":"+b,f=this.recordingRefreshTasks[e];f||(this.recordingRefreshTasks[e]=setInterval(function(a,b){d.startRecordingConversation(a,b,null)},1e3*c,a,b))},A.prototype._cancelRecordingRefreshTask=function(a,b){var c=a+":"+b,d=this.recordingRefreshTasks[c];d&&(clearInterval(d),delete this.recordingRefreshTasks[c])},A.prototype._cancelAllRecordingRefreshTasks=function(){var a=this;k.debug("Cancelling all");var b=g.keys(a.recordingRefreshTasks);g.each(b,function(b){k.debug("Cancelling key "+b),clearInterval(a.recordingRefreshTasks[b]),delete a.recordingRefreshTasks[b]})},A.prototype.setOptions=function(a){var b=e(a);0!==b.length&&(this.deliveryModes=b)},A.prototype.setArchivedMessageTags=function(a,b,c){if(!g.isArray(b))throw new Error("Tags must be an array of string tags");this.sendRestRequest("POST","tagArchivedMessage/"+a,{tags:b},function(){c&&g.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&g.isFunction(c.onError)&&c.onError(a.code,a.message)})},A.prototype._processArchivedMessage=function(a){var b=this;return a.timestamp=new Date(a.timestamp),a.setTags=function(c,d){b.setArchivedMessageTags(a.msgId,c,d)},a},A.prototype._processArchivedFileTransfer=function(a){var b=this;a.timestamp=new Date(a.timestamp),a.getFile=function(c){b.retrieveArchivedFile(a.ftId,c)}},A.prototype.retrieveArchivedFile=function(a,b){var c=this;this.sendRestRequest("GET","retrieveArchivedFile/"+a,null,function(a){var d=a.content;d.callbacks=b,c.pendingFileTransfers[d.serverId]=d,c._getFile(a.content)})},A.prototype.getArchivedMessage=function(a,b){var c=this;if(!g.isString(a))throw new Error("You must specify a valid message ID");this.sendRestRequest("GET","getArchivedMessage/"+a,null,function(a){c._processArchivedMessage(a),b&&g.isFunction(b.onSuccess)&&b.onSuccess(a)},function(a){b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype.getArchivedMessages=function(a,b){var c=this,d="";b&&(d+=(d?"&":"?")+"token="+b),this.sendRestRequest("GET","getArchivedMessages"+d,null,function(b){g.each(b.messages,function(a){c._processArchivedMessage(a)}),a&&g.isFunction(a.onResult)&&a.onResult(b.messages,!b.token),b.token&&setTimeout(function(){c.getArchivedMessages(a,b.token)},250)},function(b){a&&g.isFunction(a.onError)&&a.onError(b.code,b.message)})},A.prototype.getArchivedMessagesByTag=function(a,b,c){var d=this;if(!g.isString(a))throw new Error("Tag name must be a string");var e="";c&&(e+=(e?"&":"?")+"token="+c),this.sendRestRequest("GET","getArchivedMessagesByTag/"+a+e,null,function(c){g.each(c.messages,function(a){d._processArchivedMessage(a)}),b&&g.isFunction(b.onResult)&&b.onResult(c.messages,!c.token),c.token&&setTimeout(function(){d.getArchivedMessagesByTag(a,b,c.token)},250)},function(a){b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype.getArchivedMessagesByDate=function(a,b,c,d){var e=this,f=g.isDate(a)?parseInt(a.getTime()/1e3,10):a;if(!g.isNumber(f))throw new Error("Start date must be an instance of Date or seconds since 1 Jan 1970");var h=g.isDate(b)?parseInt(b.getTime()/1e3,10):b;if(!g.isNumber(h))throw new Error("End date must be an instance of Date or seconds since 1 Jan 1970");var i=f+"-"+h,j="";d&&(j+=(j?"&":"?")+"token="+d),this.sendRestRequest("GET","getArchivedMessagesByDate/"+i+j,null,function(d){g.each(d.messages,function(a){e._processArchivedMessage(a)}),c&&g.isFunction(c.onResult)&&c.onResult(d.messages,!d.token),d.token&&setTimeout(function(){e.getArchivedMessagesByDate(a,b,c,d.token)},250)},function(a){c&&g.isFunction(c.onError)&&c.onError(a.code,a.message)})},A.prototype.getArchivedMessagesByContact=function(a,b,c){var d=this;if(!g.isString(a))throw new Error("Contact must be the address of the contact");var e="";c&&(e+=(e?"&":"?")+"token="+c),this.sendRestRequest("GET","getArchivedMessagesByRecipient/"+a+e,null,function(c){g.each(c.messages,function(a){d._processArchivedMessage(a)}),b&&g.isFunction(b.onResult)&&b.onResult(c.messages,!c.token),c.token&&setTimeout(function(){d.getArchivedMessagesByContact(a,b,c.token)},250)},function(a){b&&g.isFunction(b.onError)&&b.onError(a.code,a.message)})},A.prototype.getArchivedFileTransfers=function(a,b){var c=this,d="";b&&(d+=(d?"&":"?")+"token="+b),this.sendRestRequest("GET","getArchivedFileTransfers"+d,null,function(b){g.each(b.transfers,function(a){c._processArchivedFileTransfer(a)}),a&&g.isFunction(a.onResult)&&a.onResult(b.transfers,!b.token),b.token&&setTimeout(function(){c.getArchivedFileTransfers(a,b.token)},250)},function(b){a&&g.isFunction(a.onError)&&a.onError(b.code,b.message)})},b.exports=A}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":18,"js-logger":3,"node-uuid":4}],18:[function(a,b){(function(c){"use strict";function d(a){this.wampBaseUri=a}var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("wolfy87-eventemitter"),g=a("../lib/wampy"),h=a("js-logger"),i=h.get("SDK:Net"),j="http://sdk.acision.com/auth/v1.3/setAccessToken",k="error",l="ready";d.prototype=new f,d.prototype.constructor=d,d.prototype.init=function(a,b,c,d){var f=this;if(this.sdk=a,this.enabled=b,this.ready=!1,b){var h=d;if(e.isArray(h)&&(h=e.sample(h)),"/"!==h.slice(-1)&&(h+="/"),this.restUrl=h,this.wampBaseUri&&c&&a.config.persistent){var j;return j=e.isArray(c)?e.sample(c):c,void(this.ws=new g(j,["wamp"],{autoReconnect:!0,onConnect:function(){f.onConnect()},onError:function(){f.ready=!1},onReconnect:function(){i.warn("Reconnecting...")},onClose:function(){f.ws&&(i.error("Max retries reached; aborting"),f.emitEvent(k))}}))}this.ready=!0}},d.prototype.isReady=function(){return!this.enabled||this.ready},d.prototype.onConnect=function(){var a=this;i.info("Connected"),setTimeout(function(){a.refreshConfig()},500)},d.prototype.refreshConfig=function(){var a=this;this.ws&&this.ws.call(j,{callRes:function(){i.debug("Authentication successful"),a.ready=!0,a.emitEvent(l)},callErr:function(){i.debug("Authentication failed"),a.emitEvent(k)}},this.sdk.config.accessToken)},d.prototype.sendRequest=function(a,b,c,d,e){if(!this.enabled)throw new Error("API is disabled");if(this.ws){if(!this.ready)throw new Error("API not ready - did you wait for the onConnected event?");this.ws.call(this.wampBaseUri+b,{callRes:d,callErr:e},c)}else this.sendRestRequest(a,b,c,d,e)},d.prototype.sendRestRequest=function(a,b,c,d,f){if(!this.enabled)throw new Error("API is disabled");var g=new XMLHttpRequest;g.open(a,this.restUrl+b),g.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.responseType="json",g.onload=function(){this.status>=200&&this.status<300?d(this.response):f(404===this.status?{code:"ResourceNotFound",message:"The resource was not found"}:this.response||{code:"RestError",message:"Unknown error: "+this.status})},g.onerror=function(){f({code:"NetworkError",message:"A network error was encountered"})},g.onabort=function(){f({code:"AbortError",message:"The request was aborted"})},g.ontimeout=function(){f({code:"TimeoutError",message:"The request timed out"})},c&&!e.isString(c)&&(c=JSON.stringify(c)),g.send(c)},d.prototype.disconnect=function(){this.ws&&(this.ws.disconnect(),delete this.ws)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/wampy":2,"js-logger":3,"wolfy87-eventemitter":11}],19:[function(a,b){(function(c){"use strict";function d(a){function b(a){var b=c.exec(a),d={};return b[4]&&b[4].split(";").forEach(function(a){var b=a.split("=");d[b[0]]=b[1]}),{user:b[1],host:b[2],port:b[3],params:d,headers:b[5]}}var c=/^([^@]+)@([^:;]+)(?::([^;]+))?(?:;([^\?]+))?(?:\?([^$]+))?$/;e.each(a,function(a){var c=b(a.user);c.params.gr?(a.device=a.user,a.user=c.user+"@"+c.host+(c.port?":"+c.port:"")):a.device=null})}var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("js-logger"),g=a("./network-api"),h=f.get("SDK:Presence"),i="http://sdk.acision.com/presence/v1.3/",j="1.3",k=300,l=function(a){var b=a.config.interfaces.presence,c=null,d=null;b&&(c=b.wsEndpoints[j],d=b.restEndpoints[j]),this.init(a,!!b,c,d),this.callbacks={},this.refreshPresentity={},this.fieldTtl={},this.refreshInterval={},this.recording=!1,e.isUndefined(a.config.recordPresence)||(this.recording=a.config.recordPresence)};l.prototype=new g(i),l.prototype.constructor=l,l.prototype.disconnect=function(){this._stopAllRefreshTimers(),g.prototype.disconnect.call(this)},l.prototype._mergeFields=function(a,b){var c=this;e.each(a,function(a,d){a?(c.refreshPresentity[d]=a,c.fieldTtl[d]=b):(delete c.refreshPresentity[d],delete c.fieldTtl[d])},this)},l.prototype.getPresentities=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.users=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getPresentities",f,function(a){h.debug("getPresentities succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getPresentities failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getPresentitiesForGroups=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.groups=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getPresentities",f,function(a){h.debug("getPresentitiesForGroups succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getPresentitiesForGroups failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getPresentitiesForGroupIds=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.groupIds=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getPresentities",f,function(a){h.debug("getPresentitiesForGroups succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getPresentitiesForGroups failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getAllPresentities=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.addresses=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getAllPresentities",f,function(a){h.debug("getAllPresentities succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getAllPresentities failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getAllPresentitiesForGroups=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.groups=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getAllPresentities",f,function(a){h.debug("getAllPresentitiesForGroups succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getAllPresentitiesForGroups failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.getAllPresentitiesForGroupIds=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var f={};e.isArray(a)||(a=[a]),f.groupIds=a,b&&(e.isArray(b)||(b=[b]),f.fields=b),this.sendRequest("POST","getAllPresentities",f,function(a){h.debug("getAllPresentitiesForGroups succeeded"),e.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){h.debug("getAllPresentitiesForGroups failed"),e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.setOwnPresentity=function(a,b,c){var d=this;if(!a)throw new Error("Missing parameters");if(!e.isObject(a)||b&&!e.isObject(b)||c&&!e.isObject(c))throw new Error("Invalid parameters");b=e.defaults({},b,{refresh:!0});var f=b.ttl,g={};g.user=this.sdk.config.primaryAddress,g.device=this.sdk.uuid,g.fields=a,g.record=d.recording,e.isUndefined(f)||null===f?e.isUndefined(this.sdk.config.presenceTTL)||(g.ttl=this.sdk.config.presenceTTL):g.ttl=f,this.sendRequest("POST","setPresentity",g,function(g){if(h.debug("setOwnPresentity succeeded"),b.refresh){var i=k;e.isUndefined(g.refreshDelay)||(i=g.refreshDelay),d._mergeFields(a,f),d._checkRefreshTimer(f,i)}c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){h.warn("setOwnPresentity failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.deleteOwnPresentity=function(a){var b=this,c={};c.user=this.sdk.config.primaryAddress,c.device=this.sdk.uuid,c.record=b.recording,this.sendRequest("POST","deletePresentity",c,function(){h.debug("deleteOwnPresentity succeeded"),b._stopAllRefreshTimers(),b.refreshPresentity={},a&&e.isFunction(a.onSuccess)&&a.onSuccess()},function(b){h.warn("deleteOwnPresentity failed"),a&&e.isFunction(a.onError)&&a.onError(b.code,b.message)})},l.prototype.refreshOwnPresentity=function(a,b,c){var d=this;if(!a)throw new Error("Missing parameters");if(!e.isObject(a)||b&&!e.isObject(b)||c&&!e.isObject(c))throw new Error("Invalid parameters");b=e.defaults({},b,{refresh:!0});var f=b.ttl,g={};g.user=this.sdk.config.primaryAddress,g.device=this.sdk.uuid,g.fields=a,e.isUndefined(f)||null===f?e.isUndefined(this.sdk.config.presenceTTL)||(g.ttl=this.sdk.config.presenceTTL):g.ttl=f,this.sendRequest("POST","refreshPresentity",g,function(g){if(h.debug("refreshOwnPresentity succeeded"),b.refresh){var i=k;e.isUndefined(g.refreshDelay)||(i=g.refreshDelay),d._mergeFields(a,f),d._checkRefreshTimer(f,i)}c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){h.warn("refreshOwnPresentity failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype._checkRefreshTimer=function(a,b){var c=e.contains(this.fieldTtl,a),d=this.refreshInterval[a];if(c){if(d)return;return void this._startRefreshTimer(a,b)}this._stopRefreshTimer(a)},l.prototype._startRefreshTimer=function(a,b){var c=this;h.debug("Starting refresh interval for TTL "+a),this.refreshInterval[a]=setInterval(function(){if(c.refreshInterval[a]){var b=e.pick(c.refreshPresentity,function(b,d){return c.fieldTtl[d]===a});e.isEmpty(b)?c._stopRefreshTimer(a):c.refreshOwnPresentity(b,{ttl:a})}},1e3*b)},l.prototype._stopRefreshTimer=function(a){this.refreshInterval[a]&&(h.debug("Stopping refresh interval for TTL "+a),clearInterval(this.refreshInterval[a]),delete this.refreshInterval[a])},l.prototype._stopAllRefreshTimers=function(){var a=this,b=e.keys(this.refreshInterval);e.each(b,function(b){a._stopRefreshTimer(b)})},l.prototype.subscribe=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var d={};e.isArray(a)||(a=[a]),d.users=a,b&&(e.isArray(b)||(b=[b]),d.fields=b),this.sendRequest("POST","subscribe",d,function(){
h.debug("subscribe succeeded"),c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){h.debug("subscribe failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.subscribeToGroups=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var d={};e.isArray(a)||(a=[a]),d.groups=a,b&&(e.isArray(b)||(b=[b]),d.fields=b),this.sendRequest("POST","subscribe",d,function(){h.debug("subscribeToGroups succeeded"),c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){h.debug("subscribeToGroups failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.subscribeToGroupIds=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var d={};e.isArray(a)||(a=[a]),d.groupIds=a,b&&(e.isArray(b)||(b=[b]),d.fields=b),this.sendRequest("POST","subscribe",d,function(){h.debug("subscribeToGroups succeeded"),c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){h.debug("subscribeToGroups failed"),c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},l.prototype.unsubscribe=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");var c={};a&&(e.isArray(a)||(a=[a]),c.users=a),this.sendRequest("POST","unsubscribe",c,function(){h.debug("unsubscribe succeeded"),b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){h.debug("unsubscribe failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},l.prototype.unsubscribeFromGroups=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var c={};e.isArray(a)||(a=[a]),c.groups=a,this.sendRequest("POST","unsubscribe",c,function(){h.debug("unsubscribeFromGroups succeeded"),b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){h.debug("unsubscribeFromGroups failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},l.prototype.unsubscribeFromGroupIds=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(e.isEmpty(a))throw new Error("Invalid parameters");var c={};e.isArray(a)||(a=[a]),c.groupIds=a,this.sendRequest("POST","unsubscribe",c,function(){h.debug("unsubscribeFromGroups succeeded"),b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){h.debug("unsubscribeFromGroups failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},l.prototype.setCallbacks=function(a){if(!this.ws)throw new Error("Cannot set callbacks for a non-persistent connection.");if(!a)throw new Error("Missing parameters");this.callbacks=a,a.onPresentity&&this.ws.subscribe(i+"presentity",function(b){d(b),a.onPresentity(b)})},l.prototype.setRecording=function(a){this.recording=a},l.prototype.isRecording=function(){return this.recording},b.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":18,"js-logger":3}],20:[function(a,b){"use strict";var c=a("wolfy87-eventemitter"),d=a("js-logger"),e=a("../lib/jssip"),f=a("./webrtc/sdp"),g=a("./webrtc/session"),h=a("./webrtc/util"),i=a("./webrtc/compat"),j=d.get("SDK:RTC"),k="1.3",l="error",m="ready",n=function(a){var b=this,c=a.config.interfaces.webrtc;if(this.sdk=a,this.enabled=!!c,this.ready=!1,this.sessions=[],this.compat=new i(navigator.userAgent),this.enabled){e.C.USER_AGENT.indexOf("Acision")<0&&(e.C.USER_AGENT="Acision SDK v".concat(a.version,"; ",navigator.userAgent));var d={ws_servers:c.wsEndpoints[k],uri:"sip:"+(a.config.primaryAddress||"anonymous@anonymous.invalid"),authorization_user:c.credentials.username,password:c.credentials.password,register:!1,handle_media:!1,instance_id:a.uuid,no_answer_timeout:120};this.ua=new e.UA(d),this.ua.on("connected",function(){b.emitEvent(m)}),this.ua.on("registrationFailed",function(){b.emitEvent(l)}),this.ua.on("newRTCSession",function(a){var c=a.data;"remote"===c.originator&&b._handleIncoming(c)}),this.ua.on("newRefer",this._handleRefer.bind(this)),this.ua.start()}};n.prototype=new c,n.prototype.constructor=n,n.prototype.isReady=function(){return!this.enabled||this.ua.isConnected()},n.prototype.refreshConfig=function(){if(this.enabled){var a=this.sdk.config.interfaces.webrtc,b={ws_servers:a.wsEndpoints[k],authorization_user:a.credentials.username,password:a.credentials.password};this.ua.updateConfiguration(b);for(var c=0,d=this.sessions.length;d>c;c++)this.sessions[c]._updateIceServers(this.sdk.config.iceServers)}},n.prototype.disconnect=function(){this.ua&&(this.ua.stop(),this.ua=null)},n.prototype.setCallbacks=function(a){a.onIncomingSession?(this.onIncomingSession=a.onIncomingSession,this.ua.register()):(delete this.onIncomingSession,this.ua.unregister())},n.prototype.connect=function(a,b,c){var d=this,f=new e.RTCSession(this.ua);c||(c={}),a.indexOf("@")<0&&(a=a.concat("@",this.sdk.config.defaultDomain));var h=this.sdk.config.iceServers,i=new g(this,f,a,h,c.constraints);return i.setCallbacks(b),i._connect(c.stream,c.streamConfig,c.customHeaders,c.record),this.sessions.push(i),i.on("close",function(){var a=d.sessions;a.splice(a.indexOf(this),1)}),i},n.prototype._handleIncoming=function(a){var b=this,c=new f.Session(a.request.body);if(!c)return void a.sdpInvalid();var d=null;c.attributes.fingerprint||c.media[0].attributes.fingerprint||(d={mandatory:{DtlsSrtpKeyAgreement:!1}});var e=a.session.remote_identity.uri.toAor().replace(/^sip:/,""),i=this.sdk.config.iceServers,k=new g(this,a.session,e,i,d),l=function(){j.log("Remote offer set"),a.sdpValid(),h.fireEvent(b,"onIncomingSession",{session:k})},m=function(b){j.warn("setRemoteDescription failed:",b),a.sdpInvalid(),k.close()};k._handleInitialInvite(a.request,c,l,m),this.sessions.push(k),k.on("close",function(){var a=b.sessions;a.splice(a.indexOf(this),1)})},n.prototype._handleRefer=function(a){var b=a.data;if("remote"===b.originator){b.refer.refer_uri.scheme!==e.C.SIP&&b.refer.reject({status_code:416,reason_phrase:"Unsupported Refer URI Scheme"});var c=b.session;if(!c)return void b.refer.reject({status_code:481,reason_phrase:"Target Session Does Not Exist"});for(var d=null,f=0,g=this.sessions.length;g>f;f++)if(d=this.sessions[f],d.sipSession===c)return void d._handleRefer(b.refer);b.refer.reject({status_code:481,reason_phrase:"Target Session Does Not Exist"})}},b.exports=n},{"../lib/jssip":1,"./webrtc/compat":21,"./webrtc/sdp":25,"./webrtc/session":26,"./webrtc/util":28,"js-logger":3,"wolfy87-eventemitter":11}],21:[function(a,b){"use strict";function c(a){var b=/Chrome\/([0-9]*)/.exec(a);b&&b[1]&&(this.flavour="chrome",this.version=parseInt(b[1],10)),b=/Firefox\/([0-9]*)/.exec(a),b&&b[1]&&(this.flavour="firefox",this.version=parseInt(b[1],10)),e.info("Detected "+this.flavour+" version "+this.version)}var d=a("js-logger"),e=d.get("SDK:Compat");c.prototype.supportsRTCOfferOptionsDict=function(){switch(this.flavour){case"chrome":if(this.version<39)return!1;break;case"firefox":if(this.version<33)return!1}return!0},c.prototype.requiresInactiveStreams=function(){return"chrome"===this.flavour&&this.version<38},c.prototype.supportsIceServerUrlsArray=function(){return"firefox"===this.flavour?!1:!0},c.prototype.supportsIncomingRTXcodec=function(){return"chrome"===this.flavour&&this.version<37?!1:!0},b.exports=c},{"js-logger":3}],22:[function(a,b){"use strict";function c(a){if(a instanceof e.IncomingRequest)this.fromJsSipHeaders(a.headers);else if(a instanceof e.OutgoingRequest)this.fromExtraHeaders(a.extraHeaders);else if(a){var b,c;for(b in a)c=a[b],this.isValidCustomHeader(b,c)?this[b]=c:g.warn("Ignored custom header:",b,c)}}var d=a("js-logger"),e=a("../../lib/jssip"),f=a("./util"),g=d.get("SDK:RTC:CustomHeaders");c.prototype.isValidCustomHeader=function(a,b){var c=/[^a-zA-Z0-9\-\.!%\*_\+`'~]/;return a.match(c)?!1:f.isType(b,"string")?b.match(/[\r\n]/)?!1:!0:!1},c.prototype.equals=function(a){var b=Object.keys(this);if(b.length!==Object.keys(a).length)return!1;for(var c=0,d=b.length;d>c;c++){var e=b[c];if(a[e]!==this[e])return!1}return!0},c.prototype.fromJsSipHeaders=function(a){for(var b in a)if("X-"===b.slice(0,2).toUpperCase()&&"X-ACISION"!==b.slice(0,9).toUpperCase()){var c=a[b][0].raw;this.isValidCustomHeader(b,c)?this[b.slice(2)]=c:g.warn("Ignored custom header:",b,c)}},c.prototype.fromExtraHeaders=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b],e=d.match(/([^:]*)\s*:\s*(.*)/),f=e[1],g=e[2];"X-"===f.slice(0,2).toUpperCase()&&"X-ACISION"!==f.slice(0,9).toUpperCase()&&this.isValidCustomHeader(f,g)&&(this[f.slice(2)]=g)}},c.prototype.toExtraHeaders=function(){for(var a=[],b=Object.keys(this),c=0,d=b.length;d>c;c++){var e=b[c],f=this[e];this.isValidCustomHeader(e,f)?a.push("X-"+e+": "+f):g.warn("Ignored invalid custom header:",e,f)}return a},c.prototype.isEmpty=function(){var a=Object.keys(this);return 0===a.length},b.exports=c},{"../../lib/jssip":1,"./util":28,"js-logger":3}],23:[function(a,b,c){"use strict";var c={},d=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unexpected value error"};d.prototype=new Error,d.prototype.constructor=d,d.prototype.name="ValueError";var e=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unexpected state error"};e.prototype=new Error,e.prototype.constructor=e,e.prototype.name="StateError";var f=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Version error"};f.prototype=new Error,f.prototype.constructor=f,f.prototype.name="VersionError";var g=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unsupported error"};g.prototype=new Error,g.prototype.constructor=g,g.prototype.name="UnsupportedError",c.ValueError=d,c.StateError=e,c.VersionError=f,c.UnsupportedError=g,b.exports=c},{}],24:[function(a,b){(function(c){"use strict";function d(a,b,c){var d=a.config.interfaces[b],e=null;if(!d)return null;var f=d.restEndpoints[c];if(h.isArray(f))e=h.sample(f);else{if(!h.isString(f))return null;e=f}return e&&"/"!==e.slice(-1)&&(e+="/"),e}function e(a,b){this.sdk=a,this.baseUrl=d(a,"recording",k),this.id=b}function f(a){return!!d(a,"recording",k)}function g(a,b,c){var f=d(a,"recording",k);if(!f)return void c("The recording feature is not enabled for this API key");var g=new XMLHttpRequest;g.open("POST",f+"sessions"),g.setRequestHeader("Authorization","Bearer "+a.config.accessToken),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.responseType="json",g.onload=function(){if(this.status>=200&&this.status<300){var b=this.getResponseHeader("Location");if(!b||!this.response.bridgeSdp)return c({code:"RestError",message:"Failed to decode response"});var d=b.slice(b.lastIndexOf("/")+1);if(!d)return c({code:"RestError",message:"Failed to decode response"});j.info("Created session:",d),c(null,new e(a,d),this.response.bridgeSdp)}else c(this.response||{code:"RestError",message:"Unknown error: "+this.status})},g.onerror=function(){c({code:"NetworkError",message:"A network error was encountered"})},g.onabort=function(){c({code:"AbortError",message:"The request was aborted"})},g.ontimeout=function(){c({code:"TimeoutError",message:"The request timed out"})},b&&!h.isString(b)&&(b=JSON.stringify(b)),g.send(b)}var h="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,i=a("js-logger"),j=i.get("SDK:Recording"),k="2.0";e.prototype.updateEndpoint=function(a,b,c){var d=new XMLHttpRequest;d.open("PUT",this.baseUrl+"sessions/"+this.id+"/addresses/"+a),d.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Accept","application/json"),d.responseType="json",d.onload=function(){if(this.status>=200&&this.status<300){if(!this.response.bridgeSdp)return c({code:"RestError",message:"Failed to decode response"});c(null,this.response.bridgeSdp)}else c(this.response||{code:"RestError",message:"Unknown error: "+this.status})},d.onerror=function(){c({code:"NetworkError",message:"A network error was encountered"})},d.onabort=function(){c({code:"AbortError",message:"The request was aborted"})},d.ontimeout=function(){c({code:"TimeoutError",message:"The request timed out"})},b&&!h.isString(b)&&(b=JSON.stringify(b)),d.send(b)},e.prototype.updateMetadata=function(a,b){var c=new XMLHttpRequest;c.open("PUT",this.baseUrl+"sessions/"+this.id+"/metadata"),c.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),c.setRequestHeader("Content-Type","application/json"),c.responseType="json",c.onload=function(){b(this.status>=200&&this.status<300?null:this.response||{code:"RestError",message:"Unknown error: "+this.status})},c.onerror=function(){b({code:"NetworkError",message:"A network error was encountered"})},c.onabort=function(){b({code:"AbortError",message:"The request was aborted"})},c.ontimeout=function(){b({code:"TimeoutError",message:"The request timed out"})},a&&!h.isString(a)&&(a=JSON.stringify(a)),c.send(a)},e.prototype.stop=function(a){var b=new XMLHttpRequest;b.open("DELETE",this.baseUrl+"sessions/"+this.id),b.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),b.onload=function(){a(this.status>=200&&this.status<300?null:this.response||{code:"RestError",message:"Unknown error: "+this.status})},b.onerror=function(){a({code:"NetworkError",message:"A network error was encountered"})},b.onabort=function(){a({code:"AbortError",message:"The request was aborted"})},b.ontimeout=function(){a({code:"TimeoutError",message:"The request timed out"})},b.send()},b.exports={isEnabled:f,createSession:g,RecordingSession:e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"js-logger":3}],25:[function(a,b){"use strict";function c(a){return new Date(1e3*(parseInt(a,10)-n))}function d(a){return parseInt(a.getTime()/1e3,10)+n}function e(a){return a.replace(/%00/g,"\x00").replace(/%0A/gi,"\n").replace(/%0D/gi,"\r").replace(/%22/g,'"').replace(/%25/g,"%")}function f(a){if(a){if(!this.parse(a))return null}else this.reset()}function g(a){if(a){if(!this.parse(a))return null}else this.reset()}function h(a){if(a){if(!this.parse(a))return null}else this.reset()}function i(a){if(a){if(!this.parse(a))return null}else this.reset()}function j(a){if(a){if(!this.parse(a))return null}else this.reset()}var k=a("js-logger"),l=k.get("SDK:RTC:SDP"),m="\r\n",n=2208988800;f.prototype.reset=function(){this.username="-",this.id=d(new Date),this.version=this.sessId,this.netType="IN",this.addrType="IP4",this.address="address.invalid"},f.prototype.parse=function(a){var b;return b=a.split(" "),6!==b.length?(l.log("Unexpected origin line: "+a),!1):(this.username=b[0],this.id=b[1],this.version=b[2],this.netType=b[3],this.addrType=b[4],this.address=b[5],!0)},f.prototype.toString=function(){var a="";return a+=this.username+" ",a+=this.id+" ",a+=this.version+" ",a+=this.netType+" ",a+=this.addrType+" ",a+=this.address},g.prototype.reset=function(){this.netType="IN",this.addrType="IP4",this.address="address.invalid"},g.prototype.parse=function(a){var b;return b=a.split(" "),3!==b.length?(l.log("Unexpected connection line: "+a),!1):(this.netType=b[0],this.addrType=b[1],this.address=b[2],!0)},g.prototype.toString=function(){var a="";return a+=this.netType+" ",a+=this.addrType+" ",a+=this.address},h.prototype.reset=function(){this.start=null,this.stop=null,this.repeat=[]},h.prototype.parse=function(a){var b,d,e;return b=a.split(m),d=b.shift(),e=d.split(" "),2!==e.length?(l.log("Unexpected timing line: "+d),!1):(this.start="0"===e[0]?null:c(e[0]),this.stop="0"===e[1]?null:c(e[1]),this.repeat=b,!0)},h.prototype.toString=function(){var a,b="";b+=this.start?d(this.start):"0",b+=" ",b+=this.stop?d(this.stop):"0";for(a in this.repeat)b+=m+this.repeat[a];return b},i.prototype.reset=function(){this.media="message",this.port=2855,this.proto="TCP/MSRP",this.format="*",this.title=null,this.connection=null,this.bandwidth=[],this.key=null,this.resetAttributes()},i.prototype.addAttribute=function(a,b){this.attributes[a]||(this.attributes[a]=[],this.attributeNameOrder.push(a)),this.attributes[a].push(b)},i.prototype.removeAttribute=function(a){this.attributes[a]&&(delete this.attributes[a],this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1))},i.prototype.resetAttributes=function(){this.attributeNameOrder=[],this.attributes={}},i.prototype.replaceAttribute=function(a,b,c){this.attributes[a]&&(delete this.attributes[a],this.addAttribute(b,c),this.attributeNameOrder.splice(this.attributeNameOrder.lastIndexOf(b),1),this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1,b))},i.prototype.parse=function(a){var b,c,d,e,f;if(this.reset(),b=a.split(m),c=b.shift(),d=c.split(" "),d.length<4)return l.log("Unexpected media line: "+c),!1;this.media=d.shift(),this.port=parseInt(d.shift(),10),this.proto=d.shift(),this.format=d.join(" ");for(e in b){var h,i=b[e].substr(2);switch(b[e].substr(0,2)){case"i=":this.title=i;break;case"c=":if(this.connection=new g(i),!this.connection)return!1;break;case"b=":this.bandwidth.push(i);break;case"k=":this.key=i;break;case"a=":h=i.indexOf(":"),-1===h?(f=i,i=null):(f=i.substr(0,h),i=i.substr(h+1)),this.addAttribute(f,i);break;default:return l.log("Unexpected type (within media): "+b[e]),!1}}return!0},i.prototype.toString=function(){var a,b,c,d="";d+=this.media+" ",d+=this.port+" ",d+=this.proto+" ",d+=this.format,this.title&&(d+=m+"i="+this.title),this.connection&&(d+=m+"c="+this.connection);for(a in this.bandwidth)d+=m+"b="+this.bandwidth[a];this.key&&(d+=m+"k="+this.key);for(var e=0,f=this.attributeNameOrder.length;f>e;e++){b=this.attributeNameOrder[e],c=this.attributes[b];for(a in c)d+=m+"a="+b,c[a]&&(d+=":"+c[a])}return d},i.prototype.parseFileAttributes=function(){var a,b,c,d,f={},g=0,h={};if(!this.attributes["file-selector"])return null;for(var i=this.attributes["file-selector"][0];g<i.length;)if(" "!==i.charAt(g)){if(a=i.indexOf(":",g),-1===a)break;if(b=i.slice(g,a),g=a+1,'"'===i.charAt(g)){if(g++,d=i.indexOf('"',g),-1===d)break;c=i.slice(g,d),g=d+1}else if("type"===b){var j=!1;for(d=g;d<i.length&&(j||" "!==i.charAt(d));)'"'===i.charAt(d)&&(j=!j),d++;c=i.slice(g,d),g=d+1}else d=i.indexOf(" ",g),-1===d&&(d=i.length),c=i.slice(g,d),g=d+1;switch(b){case"name":h.name=e(c);break;case"size":h.size=parseInt(c,10);break;case"type":h.type=c;break;case"hash":h.hash||(h.hash={}),a=c.indexOf(":"),h.hash[c.substring(0,a)]=c.substring(a+1);break;default:continue}}else g++;return f.selector=h,f.id=this.attributes["file-transfer-id"][0],f.disposition=this.attributes["file-disposition"][0]||"render",this.title&&(f.description=this.title),this.attributes["file-icon"]&&(f.icon=this.attributes["file-icon"][0]),f},i.prototype.isSending=function(){return this.attributes.recvonly||this.attributes.inactive?!1:!0},i.prototype.isReceiving=function(){return this.attributes.sendonly||this.attributes.inactive?!1:!0},j.prototype.reset=function(){this.version=0,this.origin=new f,this.sessionName=" ",this.sessionInfo=null,this.uri=null,this.email=null,this.phone=null,this.connection=new g,this.bandwidth=[],this.timing=[new h],this.timezone=null,this.key=null,this.resetAttributes(),this.media=[]},j.prototype.addAttribute=function(a,b){this.attributes[a]||(this.attributes[a]=[],this.attributeNameOrder.push(a)),this.attributes[a].push(b)},j.prototype.removeAttribute=function(a){this.attributes[a]&&(delete this.attributes[a],this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1))},j.prototype.replaceAttribute=function(a,b,c){this.attributes[a]&&(delete this.attributes[a],this.addAttribute(b,c),this.attributeNameOrder.splice(this.attributeNameOrder.lastIndexOf(b),1),this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1,b))},j.prototype.resetAttributes=function(){this.attributeNameOrder=[],this.attributes={}},j.prototype.parse=function(a){var b,c,d,e,j=a.split(m);if(this.reset(),""===j[j.length-1]&&j.pop(),j.length<4)return l.log("Unexpected SDP length: "+j.length),!1;if(b=j.shift(),"v=0"!==b)return l.log("Unexpected SDP version: "+b),!1;if(b=j.shift(),"o="!==b.substr(0,2)||!(this.origin=new f(b.substr(2))))return l.log("Unexpected SDP origin: "+b),!1;if(b=j.shift(),"s="!==b.substr(0,2))return l.log("Unexpected SDP session name: "+b),!1;for(this.sessionName=b.substr(2);j.length>0&&"t"!==j[0].charAt(0);)switch(b=j.shift(),c=b.substr(2),b.substr(0,2)){case"i=":this.sessionInfo=c;break;case"u=":this.uri=c;break;case"e=":this.email=c;break;case"p=":this.phone=c;break;case"c=":if(c=new g(c),!c)return!1;this.connection=c;break;case"b=":this.bandwidth.push(c);break;default:return l.log("Unexpected SDP line (pre-timing): "+b),!1}if(0===j.length)return l.log("Unexpected end of SDP (pre-timing)"),!1;for(this.timing=[];j.length>0&&"t"===j[0].charAt(0);){for(b=j.shift().substr(2);j.length>0&&"r"===j[0].charAt(0);)b+=m+j.shift();if(c=new h(b),!c)return!1;this.timing.push(c)}if(0===this.timing.length)return l.log("No timing line found"),!1;for(;j.length>0&&"m"!==j[0].charAt(0);)switch(b=j.shift(),c=b.substr(2),b.substr(0,2)){case"z=":this.timezone=c;break;case"k=":this.key=c;break;case"a=":d=c.indexOf(":"),-1===d?(e=c,c=null):(e=c.substr(0,d),c=c.substr(d+1)),this.addAttribute(e,c);break;default:return l.log("Unexpected SDP line (pre-media): "+b),!1}for(;j.length>0&&"m"===j[0].charAt(0);){for(b=j.shift().substr(2);j.length>0&&"m"!==j[0].charAt(0);)b+=m+j.shift();if(c=new i(b),!c)return!1;this.media.push(c)}return!0},j.prototype.toString=function(){var a,b,c,d="";d+="v="+this.version+m,d+="o="+this.origin+m,d+="s="+this.sessionName+m,this.sessionInfo&&(d+="i="+this.sessionInfo+m),this.uri&&(d+="u="+this.uri+m),this.email&&(d+="e="+this.email+m),this.phone&&(d+="p="+this.phone+m),this.connection&&(d+="c="+this.connection+m);for(a in this.bandwidth)d+="b="+this.bandwidth[a]+m;for(a in this.timing)d+="t="+this.timing[a]+m;this.timezone&&(d+="z="+this.timezone+m),this.key&&(d+="k="+this.key+m);for(var e=0,f=this.attributeNameOrder.length;f>e;e++){b=this.attributeNameOrder[e],c=this.attributes[b];for(a in c)d+="a="+b,c[a]&&(d+=":"+c[a]),d+=m}for(a in this.media)d+="m="+this.media[a]+m;return d},j.prototype.isHeld=function(){var a,b,c;for(a=0,b=this.media.length;b>a;a++)switch(c=this.media[a],c.media){case"audio":case"index":if(c.isReceiving())return!1}return!0},b.exports={Session:j}},{"js-logger":3}],26:[function(a,b){(function(c){"use strict";function d(a,b){var c,d,e=new n.Session(a.sdp),f=["sendrecv","sendonly","recvonly","inactive"],g=!1;for(var h in e.media){var i=e.media[h],j=b[i.media+"Out"],k=b[i.media+"In"];if("application"!==i.media){c=null;for(var l in f)i.attributes[f[l]]&&(c=f[l]);null===c&&(c="sendrecv",i.addAttribute(c,null),g=!0),d=j?k?"sendrecv":"sendonly":k?"recvonly":"inactive",c!==d&&(i.replaceAttribute(c,d,null),g=!0)}}g&&(a.sdp=e.toString())}function e(a,b){if(!a.compat.supportsIncomingRTXcodec()){var c=b.match(/a=ssrc-group:FID.* ([0-9]+)\r?\n/);if(c&&c.length>=2){var d=c[1];b=b.replace(/a=rtpmap:96 rtx.*\r?\n/,""),b=b.replace(/a=fmtp:96 apt=100.*\r?\n/,""),b=b.replace(/a=ssrc-group:FID.*\r?\n/,"");var e=new RegExp("a=ssrc:"+d+".*\r?\n","g");b=b.replace(e,"")}}return b}function f(a,b){return a.compat.supportsIceServerUrlsArray()?b:j.map(b,function(a){return a.url=j.isArray(a.urls)?a.urls[0]:a.urls,a})}function g(a,b){var c=Date.now(),d=!1,e=setTimeout(function(){z.log("Proceeding without null candidate!",Date.now()-c),e=null,d||(d=!0,b(a.localDescription.sdp))},5e3);a.onicecandidate=function(f){z.log("onicecandidate",Date.now()-c,f.candidate),f.candidate||(e&&(clearTimeout(e),e=null),this.onicecandidate=null,d||(d=!0,b(a.localDescription.sdp)))}}function h(a){var b=function(){z.log("PC: signalling state change:",this.signalingState)};"onsignalingstatechange"in a?a.onsignalingstatechange=b:"onstatechange"in a&&(a.onstatechange=b);var c=function(){z.log("PC: ICE connection state change:",this.iceConnectionState)};"oniceconnectionstatechange"in a?a.oniceconnectionstatechange=c:"onicechange"in a&&(a.onicechange=c)}function i(a,b){a.srcObject=b,window.URL.createObjectURL&&(a.src=window.URL.createObjectURL(b)),a.play()}var j="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,k=a("js-logger"),l=a("wolfy87-eventemitter"),m=a("../../lib/jssip"),n=a("./sdp"),o=a("./stream-config"),p=a("./custom-headers"),q=a("./exceptions"),r=a("./util"),s=a("./recording"),t={PENDING:"pending",ESTABLISHED:"established",CLOSED:"closed"},u=90,v=90,w="X-AcisionSDK-RecordingSession",x="+changefp",y="toggle-recording",z=k.get("SDK:RTC:Session"),A=function(a){this.session=a};A.prototype.onAccepted=function(){this.session.close()},A.prototype.onRejected=function(){this.session.close()},A.prototype._getJsSipHandlers=function(){var a=this;return{accepted:function(){r.fireEvent(a,"onAccepted",{},!0)},failed:function(){a.session.transferFeedback=null,r.fireEvent(a,"onRejected",{},!0)},notify:function(b){var c=b.data;if(c.finalNotify)switch(a.session.transferFeedback=null,c.sessionEvent){case"started":r.fireEvent(a,"onTransferSucceeded",{});break;case"failed":r.fireEvent(a,"onTransferFailed",{});break;default:r.fireEvent(a,"onTransferResultUnknown",{})}}}};var B=function(a,b){var c=this;this.session=a,this.refer=b,this.timer=setTimeout(function(){c.reject(),c.timer=null},3e4),this.address=b.refer_uri.toString().replace(/^sip:/,"")};B.prototype.accept=function(a,b){if(null!==this.timer){clearTimeout(this.timer),this.timer=null,b=b||{},b.streamConfig||(b.streamConfig=this.session.streamConfig);var c=this.session.webrtcApi.connect(this.address,a,b);return this.refer.addSessionNotifyHandlers(c.sipSession),c}},B.prototype.reject=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null,this.refer.reject({status_code:603}))};var C=function(a,b,c,d,e){this.webrtcApi=a,this.sipSession=b,this.state=t.PENDING,this.pcConfig={iceServers:f(a,d)},this.pcConstraints=e,this.peerConnection=null,this.oldPeerConnection=null,this.videoConstraints=null,this.audioConstraints=null,this.localStream=null,this.externalStream=!1,this.accepted=!1,this.offerOutstanding=!1,this.remoteHold=!1,this.remoteHoldStreams=null,this.localHold=!1,this.localHoldStreams=null,this.dtmfSender=null,this.transferFeedback=null,this.recordingSession=null,this.recordingInitiator=!1,this.renegotiateRecording=null,this.remoteCapabilities={},this.renegotiatingMedia=!1,this.address=c,this.displayName=null,this.customHeaders=null,this.streamConfig=null,this.remoteAudioElement=null,this.remoteVideoElement=null,this.localVideoElement=null,this._initPeerConnection();var g=this;b.on("progress",function(){r.fireEvent(g,"onProvisional",{})}),b.on("started",this._handleStarted.bind(this)),b.on("ended",function(a){var b=a.data;if("local"!==b.originator){var c=r.jsSipCauseToSdkStatus(b.cause);g.sipSession=null,"system"===b.originator&&b.cause===m.C.causes.SESSION_TIMER&&g.recordingSession&&(g.recordingInitiator=!0),g.close(c)}}),b.on("failed",function(a){var b=r.jsSipCauseToSdkStatus(a.data.cause);g.sipSession=null,g.close(b)}),b.on("reinvite",this._handleReinvite.bind(this)),b.on("refresh",this._handleRefresh.bind(this)),b.contact&&(b.contact+=";"+x)};C.prototype=new l,C.prototype.constructor=C,C.prototype._initPeerConnection=function(){var a=this.peerConnection=new m.WebRTC.RTCPeerConnection(this.pcConfig,this.pcConstraints);h(a),a.onnegotiationneeded=this._handleNegotiationNeeded.bind(this),a.onaddstream=this._handleAddStream.bind(this),a.onremovestream=this._handleRemoveStream.bind(this)},C.prototype._replacePeerConnection=function(){this.oldPeerConnection=this.peerConnection,this._initPeerConnection()},C.prototype._rollbackPeerConnection=function(){this.oldPeerConnection&&(this.peerConnection.close(),this.peerConnection=this.oldPeerConnection,this.oldPeerConnection=null)},C.prototype._acceptRecordingChange=function(){"disabling"===this.renegotiateRecording&&(this.recordingInitiator&&this.recordingSession.stop(function(a){a&&z.warn("Failed to stop recording session")}),this.recordingSession=null,this.recordingInitiator=!1),this.renegotiateRecording=null},C.prototype._rollbackRecordingChange=function(){"enabling"===this.renegotiateRecording&&(this.recordingInitiator&&this.recordingSession.stop(function(a){a&&z.warn("Failed to stop recording session")}),this.recordingSession=null,this.recordingInitiator=!1),this.renegotiateRecording=null},C.prototype._getUserMedia=function(a,b){var c=this,d=a||this.streamConfig,e={audio:d.audioOut,video:d.videoOut};d.videoOut&&(d.mandatoryVideoConstraints||d.optionalVideoConstraints)&&(e.video={mandatory:d.mandatoryVideoConstraints||{},optional:d.optionalVideoConstraints||[]});var f=this.localStream;if(f){var g=this.oldPeerConnection||this.peerConnection;g.removeStream(f),f.stop(),this.localStream=null,this.renegotiatingMedia=!0}var h=function(a){if(c.state===t.CLOSED)return void a.stop();var d=c.localVideoElement;z.log("Got local media stream"),c.localStream=a,c.peerConnection.addStream(a),e.video&&d&&(i(d,a),d.muted=!0),b()},j=function(a){z.warn("getUserMedia failed:",a),c.close()};return e.audio&&(this.audioConstraints&&r.isType(e.audio,"boolean")?e.audio=this.audioConstraints:r.isType(e.audio,"object")&&(this.audioConstraints=e.audio)),e.video&&(this.videoConstraints&&r.isType(e.video,"boolean")?e.video=this.videoConstraints:r.isType(e.video,"object")&&(this.videoConstraints=e.video)),e.audio||e.video?(z.log("Requesting user media:",e),void m.WebRTC.getUserMedia(e,h,j)):void setTimeout(function(){b()},0)},C.prototype._createOffer=function(a,b){var c,e=this,f=this.peerConnection,h=a||this.streamConfig,i=function(){if(!e.recordingInitiator||"disabling"===e.renegotiateRecording)return void b(f.localDescription.sdp);var a=e.webrtcApi.sdk,c={endpointSdp:f.localDescription.sdp,sdpType:"offer"};return e.recordingSession?(z.debug("Updating recording session, local endpoint"),void e.recordingSession.updateEndpoint(a.getDeviceAddress(),c,function(a,c){return a?(z.warn("Failed to update recording session:",a),void e.close()):void b(c)})):(z.debug("Requesting recording session"),c.localAddress=a.getDeviceAddress(),c.remoteAddress=e.address,c.sdpSource="local",c.timeout=u,e.sipSession.id&&(c.callid=e.sipSession.id.slice(0,-e.sipSession.from_tag.length)),void s.createSession(a,c,function(a,c,d){return a?(z.warn("Failed to create recording session:",a),void e.close()):(e.recordingSession=c,void b(d))}))},j=function(){z.log("Local description set, ice gathering state:",f.iceGatheringState),"complete"===f.iceGatheringState?i():g(f,i)},k=function(a){z.warn("setLocalDescription failed:",a),e.close()},l=function(a){z.log("Offer created"),d(a,h),f.setLocalDescription(a,j,k)},m=function(a){z.warn("createOffer failed:",a),e.close()};c=this.webrtcApi.compat.supportsRTCOfferOptionsDict()?{offerToReceiveAudio:h.audioIn?1:0,offerToReceiveVideo:h.videoIn?1:0}:this.webrtcApi.compat.requiresInactiveStreams()?{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}:{mandatory:{OfferToReceiveAudio:h.audioIn,OfferToReceiveVideo:h.videoIn}};try{f.createOffer(l,m,c)}catch(n){z.warn("createOffer failed:",n.stack),e.close()}},C.prototype._handleAnswer=function(a,b,c){var d=this,f=function(a){z.log("Setting remote description");var f=new m.WebRTC.RTCSessionDescription({type:"answer",sdp:e(d.webrtcApi,a)});d.peerConnection.setRemoteDescription(f,b,c)};if(!this.recordingInitiator)return void f(a);if(!this.recordingSession)return z.error("Unexpected recording state - handling answer with no session"),void this.close();z.debug("Updating recording session, remote endpoint");var g={endpointSdp:a,sdpType:"answer"
};this.recordingSession.updateEndpoint(this.address,g,function(a,b){return a?void c("Failed to update recording session:",a):void f(b)})},C.prototype._handleOffer=function(a,b,c){var d=this,f=function(a){z.log("Setting remote description");var f=new m.WebRTC.RTCSessionDescription({type:"offer",sdp:e(d.webrtcApi,a)});d.peerConnection.setRemoteDescription(f,b,c)};if(!d.recordingInitiator||"disabling"===d.renegotiateRecording)return void f(a);var g={endpointSdp:a,sdpType:"offer"};if(!d.recordingSession){var h=d.webrtcApi.sdk;return z.debug("Requesting recording session"),g.localAddress=h.getDeviceAddress(),g.remoteAddress=d.address,g.sdpSource="remote",d.sipSession.id&&(g.callid=d.sipSession.id.slice(0,-d.sipSession.from_tag.length)),void s.createSession(h,g,function(a,b,c){return a?(z.warn("Failed to create recording session:",a),void d.close()):(d.recordingSession=b,void f(c))})}z.debug("Updating recording session, remote endpoint"),this.recordingSession.updateEndpoint(this.address,g,function(a,b){return a?void c("Failed to update recording session:",a):void f(b)})},C.prototype._createAnswer=function(a){var b=this,c=this.peerConnection,e=function(){if(!b.recordingInitiator)return void a(c.localDescription.sdp);if(!b.recordingSession)return z.error("Unexpected recording state - creating answer with no session"),void b.close();z.debug("Updating recording session, local endpoint");var d=b.webrtcApi.sdk,e={endpointSdp:c.localDescription.sdp,sdpType:"answer"};b.recordingSession.updateEndpoint(d.getDeviceAddress(),e,function(c,d){return c?(z.warn("Failed to update recording session:",c),void b.close()):void a(d)})},f=function(){z.log("Local description set, ice gathering state:",c.iceGatheringState),"complete"===c.iceGatheringState?e():g(c,e)},h=function(a){z.warn("setLocalDescription failed:",a),b.close()},i=function(a){z.log("Answer created"),d(a,b.streamConfig),c.setLocalDescription(a,f,h)},j=function(a){z.warn("createOffer failed:",a),b.close()},k=null;c.createAnswer(i,j,k)},C.prototype._updateIceServers=function(a){if(this.pcConfig.iceServers=f(this.webrtcApi,a),this.peerConnection.setConfiguration)this.peerConnection.setConfiguration(this.pcConfig);else try{this.peerConnection.updateIce(this.pcConfig)}catch(b){z.warn("Could not update ICE:",b.message)}},C.prototype._setRemoteStreamOutput=function(){var a,b=this.peerConnection;if(!this.hasOwnProperty("onAddStream")){a=b.getRemoteStreams?b.getRemoteStreams():b.remoteStreams;for(var c=0,d=a.length;d>c;c++)this._handleAddStream({stream:a[c]})}},C.prototype._handleAddStream=function(a){r.fireEvent(this,"onAddStream",a,!0)},C.prototype._handleRemoveStream=function(a){r.fireEvent(this,"onRemoveStream",a,!1)},C.prototype._connect=function(a,b,c,d){var e=this;this.streamConfig=b||new o,this.customHeaders=new p(c),d&&s.isEnabled(this.webrtcApi.sdk)&&(this.recordingInitiator=!0),a?(this.setLocalStream(a),this._sendInvite()):this._getUserMedia(null,function(){e._sendInvite()})},C.prototype._sendInvite=function(){var a=this;this._createOffer(null,function(b){var c={};if(c.sdp=b,c.extraHeaders=a.customHeaders.toExtraHeaders(),c.extraHeaders.push("Expires: "+u),c.extraHeaders.push("Session-Expires: "+v),a.recordingInitiator&&a.recordingSession&&c.extraHeaders.push(w+": "+a.recordingSession.id),c.featureTags=";"+x,a.sipSession.connect(a.address,c),a.recordingInitiator&&a.recordingSession){var d={callid:a.sipSession.id.slice(0,-a.sipSession.from_tag.length)};a.recordingSession.updateMetadata(d,function(a){return a?void z.warn("Failed to update recording session metadata: "+a):void z.debug("Update recording session metadata")})}r.fireEvent(a,"onConnecting",{})})},C.prototype._sendReinvite=function(a,b){var c=this;b=b||this.customHeaders,this._createOffer(a,function(a){var d={};d.sdp=a,d.extraHeaders=b.toExtraHeaders(),c.recordingSession&&"disabling"!==c.renegotiateRecording&&d.extraHeaders.push(w+": "+c.recordingSession.id),c.sipSession.sendReinvite(d)})},C.prototype._handleNegotiationNeeded=function(){return this.state!==t.ESTABLISHED?void z.log("Ignoring negotiationneeded event - session not established"):this.offerOutstanding?void z.log("Ignoring negotiationneeded event - already due"):(z.log("Starting O/A negotiation at PC's request"),this.remoteCapabilities.hasOwnProperty(x)&&this._replacePeerConnection(),void this._sendReinvite())},C.prototype._handleInitialInvite=function(a,b,c,d){this.streamConfig=new o(b),this.customHeaders=new p(a),this.remoteCapabilities=a.parseHeader("contact").parameters;var e=a.getHeader(w);return e&&(this.recordingSession=new s.RecordingSession(this.webrtcApi.sdk,e)),!this.recordingSession&&s.isEnabled(this.webrtcApi.sdk)?(this.initialInvite=a,void c()):void this._handleOffer(a.body,c,d)},C.prototype._handleStarted=function(a){var b=a.data.response;if(this.state=t.ESTABLISHED,b){var c=this,d=b.body;if(this.streamConfig=new o(new n.Session(d),this.streamConfig),this.remoteCapabilities=b.parseHeader("contact").parameters,!this.recordingSession){var e=b.getHeader(w);e&&(this.recordingSession=new s.RecordingSession(this.webrtcApi.sdk,e))}var f=function(){z.log("Remote answer set"),r.fireEvent(c,"onConnect",{})},g=function(a){z.warn("setRemoteDescription failed:",a),c.sipSession.terminate({status_code:488}),c.sipSession=null,c.close()};this._handleAnswer(d,f,g)}},C.prototype._handleReinvite=function(a){var b,c,d=this,e=a.data;if("remote"===e.originator){this.offerOutstanding=!0;var f=e.sdp,g=new n.Session(f),h=!1,i=!1;g||e.reinvite.sdpInvalid();var j=new o(g,this.streamConfig),k=new p(e.request);if(this.remoteHold&&j.isSending()){var l=this.remoteHoldStreams,m=j.getSendingStreams();for(b=0,c=m.length;c>b;b++)-1===l.indexOf(m[b])&&(z.warn("Remote UA tried to activate additional stream during resume:",m[b]),e.reinvite.sdpInvalid())}else j.equals(this.streamConfig)||(z.log("re-INVITE changing stream configuration from %s to %s",JSON.stringify(j),JSON.stringify(this.streamConfig)),h=!0),k.equals(this.customHeaders)||(z.log("re-INVITE changing custom headers"),i=!0);var q=e.request.getHeader(w);q?this.recordingSession?this.recordingSession.id!==q&&(z.warn("Recording session ID changed"),this.recordingSession=new s.RecordingSession(this.webrtcApi.sdk,q)):(this.renegotiateRecording="enabling",this.recordingSession=new s.RecordingSession(this.webrtcApi.sdk,q)):this.recordingSession&&this.remoteCapabilities.hasOwnProperty(x)&&(this.renegotiateRecording="disabling"),!this.remoteCapabilities.hasOwnProperty(x)||!this.renegotiateRecording&&this.recordingSession||this._replacePeerConnection();var t=function(){var a=d.streamConfig;z.log("Remote offer set"),e.reinvite.sdpValid();var b=function(b){d.streamConfig=b?new o(b,d.streamConfig):j,d.customHeaders=k,d._acceptRecordingChange();var c=function(){d._createAnswer(function(a){e.reinvite.accept({sdp:a})})};d.externalStream||d.remoteHold||d.streamConfig.sendingStreamsEqual(a)?(d.oldPeerConnection&&d.peerConnection.addStream(d.localStream),c()):d._getUserMedia(null,c)};if(d.renegotiateRecording||!a.isSending()||j.isSending())if(!d.renegotiateRecording&&d.remoteHold&&j.isSending())b(),d.remoteHold=!1,r.fireEvent(d,"onResume",{});else{var c=function(){e.reinvite.reject({status_code:488}),d._rollbackRecordingChange(),d._rollbackPeerConnection()},f=!0;a.isSafeChange(j)||(f=!1),"enabling"===d.renegotiateRecording&&(f=!1),r.fireEvent(d,"onRenegotiateRequest",{streamConfig:h?j:null,customHeaders:i?k:null,safe:f,recording:(null!==d.recordingSession||"enabling"===d.renegotiateRecording)&&"disabling"!==d.renegotiateRecording,accept:b,reject:c},!0)}else d.remoteHold=!0,d.remoteHoldStreams=a.getSendingStreams(),b(),r.fireEvent(d,"onHold",{})},u=function(a){z.warn("setRemoteDescription failed:",a),e.reinvite.sdpInvalid(),d._rollbackRecordingChange(),d._rollbackPeerConnection()};this._handleOffer(f,t,u)}else e.reinvite.on("succeeded",function(a){var b=function(){z.log("Remote answer set")},c=function(a){z.warn("setRemoteDescription failed:",a),d.sipSession.terminate({status_code:488}),d.sipSession=null,d.close()},f=a.data.sdp;z.log("Received remote description"),d.streamConfig=new o(new n.Session(f),d.streamConfig),d.customHeaders=new p(e.request),d._acceptRecordingChange(),d._handleAnswer(f,b,c),r.fireEvent(d,"onRenegotiateResponse",{accepted:!0})}),e.reinvite.on("failed",function(a){z.log("Reinvite failed",a.data),d._rollbackPeerConnection(),r.fireEvent(d,"onRenegotiateResponse",{accepted:!1}),"stable"!==d.peerConnection.signalingState||d.renegotiatingMedia?(z.log("PeerConnection unstable, closing session",d.peerConnection.signalingState,d.renegotiatingMedia),d.close()):z.log("PeerConnection stable, continuing session")});e.reinvite.on("completed",function(){d.offerOutstanding=!1,d.oldPeerConnection&&(d.oldPeerConnection.close(),d.oldPeerConnection=null),d.renegotiatingMedia=!1,d.peerConnection&&"stable"!==d.peerConnection.signalingState&&z.warn("Renegotiation left PeerConnection in unstable state:",d.peerConnection.signalingState),r.fireEvent(d,"onRenegotiateComplete",{})})},C.prototype._handleRefresh=function(){this.sipSession.isMethodAllowed(m.C.UPDATE,!1)?this.sipSession.sendUpdate():this._sendReinvite()},C.prototype._handleRefer=function(a){var b=new B(this,a);r.fireEvent(this,"onTransferRequest",b,!0)};var D={onConnecting:!0,onProvisional:!0,onConnect:!0,onClose:!0,onRenegotiateRequest:!0,onRenegotiateResponse:!0,onRenegotiateComplete:!0,onHold:!0,onResume:!0,onTransferRequest:!0};C.prototype.setCallbacks=function(a){for(var b in a)D[b]?this[b]=a[b]:z.warn("Unsupported callback: ",b)},C.prototype.setLocalStream=function(a){var b,c;if(this.localStream)throw new q.StateError("Cannot mix external and internal streams");this.externalStream=!0;var d=this.peerConnection.getLocalStreams();for(b=0,c=d.length;c>b;b++)d[b]!==a&&this.peerConnection.removeStream(d[b]);this.peerConnection.addStream(a)},C.prototype.getLocalStreams=function(){if(!this.peerConnection)throw new q.StateError("Cannot get streams for closed session");return this.peerConnection.getLocalStreams()},C.prototype.getRemoteStreams=function(){if(!this.peerConnection)throw new q.StateError("Cannot get streams for closed session");return this.peerConnection.getRemoteStreams()},C.prototype.accept=function(a,b){var c=this;if(a&&(this.streamConfig=a instanceof o?a:new o(a)),this.state!==t.PENDING)throw new q.StateError("Session cannot be accepted in state",this.state);if("incoming"!==this.sipSession.direction)throw new q.StateError("Cannot call accept() on outgoing sessions");var d=function(){c._createAnswer(function(a){if(c.state===t.PENDING){/Firefox/.test(navigator.userAgent)&&c._setRemoteStreamOutput();var b=[];c.recordingInitiator&&b.push(w+": "+c.recordingSession.id),c.sipSession.answer({sdp:a,extraHeaders:b}),r.fireEvent(c,"onConnect",{})}})},e=function(){c.externalStream?d():c._getUserMedia(null,d),c._setRemoteStreamOutput()};if(!this.recordingSession&&s.isEnabled(this.webrtcApi.sdk)){var f=this.initialInvite.body,g=function(a){z.warn("setRemoteDescription failed:",a),c.sipSession.terminate({status_code:488}),c.sipSession=null,c.close()};return b&&b.record&&!this.recordingSession&&(this.recordingInitiator=!0),void this._handleOffer(f,e,g)}e()},C.prototype.isRecording=function(){return null!==this.recordingSession&&"enabling"!==this.renegotiateRecording},C.prototype.checkRemoteFeature=function(a){if(a===y)return this.remoteCapabilities.hasOwnProperty(x);throw new q.ValueError("Unknown feature: "+a)},C.prototype.hold=function(){if(!this.localHold){if(this.offerOutstanding)throw new q.StateError("Existing renegotiation still in progress");this.localHold=!0,this.offerOutstanding=!0;for(var a=this.localStream.getVideoTracks(),b=this.localStream.getAudioTracks(),c=a.concat(b),d=0,e=c.length;e>d;d++)c[d].enabled=!1;var f=new o(this.streamConfig);this.localHoldStreams=f.hold(),this.remoteCapabilities.hasOwnProperty(x)&&!this.recordingSession&&this._replacePeerConnection(),this._sendReinvite(f)}},C.prototype.resume=function(){if(this.localHold){if(this.offerOutstanding)throw new q.StateError("Existing renegotiation still in progress");this.offerOutstanding=!0;var a=new o(this.streamConfig);a.resume(this.localHoldStreams),this.remoteCapabilities.hasOwnProperty(x)&&!this.recordingSession&&this._replacePeerConnection(),this._sendReinvite(a);for(var b=this.localStream.getVideoTracks(),c=this.localStream.getAudioTracks(),d=b.concat(c),e=0,f=d.length;f>e;e++)d[e].enabled=!0;this.localHold=!1}},C.prototype.renegotiate=function(a){a||(a={});var b=a.streamConfig,c=a.customHeaders,d=null;if(!this.recordingSession&&a.record?d="enabling":this.recordingSession&&a.record===!1&&(d="disabling"),b&&(b=new o(b,this.streamConfig)),c&&(c=new p(c)),(this.localHold||this.remoteHold)&&b)throw new q.StateError("Cannot modify streams whilst on hold");if(this.offerOutstanding)throw new q.StateError("Existing renegotiation still in progress");if(this.offerOutstanding=!0,!this.remoteCapabilities.hasOwnProperty(x)||!d&&this.recordingSession){if(d)throw new q.UnsupportedError("Remote party does not fully support renegotiation")}else this._replacePeerConnection();if(a.stream&&this.setLocalStream(a.stream),d&&(this.renegotiateRecording=d,"enabling"===d&&(this.recordingInitiator=!0)),b&&!this.externalStream){var e=this;this._getUserMedia(b,function(){e._sendReinvite(b,c)})}else this.peerConnection.addStream(this.localStream),this._sendReinvite(b,c)},C.prototype.mute=function(){if(this.localStream)for(var a=this.localStream.getAudioTracks(),b=0,c=a.length;c>b;b++)a[b].enabled=!1},C.prototype.unmute=function(){if(this.localStream){if(this.localHold)throw new q.StateError("Cannot unmute a held call");for(var a=this.localStream.getAudioTracks(),b=0,c=a.length;c>b;b++)a[b].enabled=!0}},C.prototype.sendDTMF=function(a,b){b=b||{};var c=b.type||"pc",d=b.duration||200,e=b.interToneGap||"info"===c?500:50,f=this;if(a=a.toString().toUpperCase(),/[^0-9A-D\*#,]/.test(a))throw new q.ValueError("Invalid characters in DTMF tones:",a);if(d=Math.max(d,70),d=Math.min(d,6e3),e=Math.max(e,50),"info"===c)this.sipSession.sendDTMF(a,{duration:d,interToneGap:e});else{var g=this.dtmfSender;if(g)return void g.insertDTMF(g.toneBuffer+a,g.duration,g.interToneGap);var h=this.localStream.getAudioTracks();if(h.length<1)throw new q.ValueError("Cannot send DTMF without an audio track");g=this.peerConnection.createDTMFSender(h[0]),g.insertDTMF(a,d,e),g.ontonechange=function(a){a.tone||(f.dtmfSender=null)},this.dtmfSender=g}},C.prototype.transfer=function(a){if(this.state!==t.ESTABLISHED)throw new q.StateError("Media session not established: "+this.state);if(this.transferFeedback)throw new q.StateError("Previous transfer outstanding");var b=new A(this),c={};c.eventHandlers=b._getJsSipHandlers();try{this.sipSession.sendRefer(a,c)}catch(d){if(d instanceof m.Exceptions.RemoteSupportError)throw new q.UnsupportedError("Remote party does not support transfers")}return this.transferFeedback=b,b},C.prototype.close=function(a){if(this.state!==t.CLOSED){var b=this.state;if(this.state=t.CLOSED,a||(a="normal"),this.recordingInitiator&&this.recordingSession&&this.recordingSession.stop(function(a){a&&z.warn("Failed to stop recording session:",a)}),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.oldPeerConnection&&(this.oldPeerConnection.close(),this.oldPeerConnection=null),this.localStream&&(this.localStream.stop(),this.localStream=null),this.sipSession){var c=null;if(b===t.PENDING&&"incoming"===this.sipSession.direction){var d=r.sdkStatusToSipStatus("invite",a);c={status_code:d}}try{this.sipSession.terminate(c)}catch(e){z.error("Error terminating SIP session:\n",e.stack)}}this.emitEvent("close"),r.fireEvent(this,"onClose",{status:a})}},C.prototype.onConnecting=function(){},C.prototype.onProvisional=function(){},C.prototype.onConnect=function(){},C.prototype.onAddStream=function(a){var b,c,d;b=a.stream,c=b.getAudioTracks(),d=b.getVideoTracks(),d.length>0?this.remoteVideoElement?i(this.remoteVideoElement,b):z.log("Video received, but no remoteVideoElement provided"):c.length>0&&(this.remoteAudioElement?i(this.remoteAudioElement,b):z.log("Audio stream received, but no remoteAudioElement provided"))},C.prototype.onRenegotiateRequest=function(a){return a.safe?(z.log("Auto-accepting re-INVITE (no significant changes)"),void a.accept()):(z.log("Auto-rejecting re-INVITE (significant changes)"),void a.reject())},C.prototype.onTransferRequest=function(a){a.reject()},C.prototype.onClose=function(){},b.exports=C}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../lib/jssip":1,"./custom-headers":22,"./exceptions":23,"./recording":24,"./sdp":25,"./stream-config":27,"./util":28,"js-logger":3,"wolfy87-eventemitter":11}],27:[function(a,b){(function(c){"use strict";var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=a("./sdp"),f=["audio","index"],g=["audioIn","audioOut","videoIn","videoOut"],h=["mandatoryVideoConstraints","optionalVideoConstraints"],i={audioIn:!0,audioOut:!0,videoIn:!1,videoOut:!1},j=function(a,b){if(a instanceof e.Session)return void this.fromSdp(a);if(a||(a=i),"object"!=typeof a)throw new TypeError("Unexpected streamConfig type: "+typeof a);b&&d.each(h,function(a){b[a]&&(this[a]=b[a])},this),d.each(g,function(b){this[b]=a[b]?!0:!1},this),d.each(h,function(b){a[b]&&(this[b]=a[b])},this)};j.prototype.fromSdp=function(a){d.each(f,function(a){this[a+"In"]=!1,this[a+"Out"]=!1},this),d.each(a.media,function(a){-1!==f.indexOf(a.media)&&0!==a.port&&(this[a.media+"In"]=a.isSending(),this[a.media+"Out"]=a.isReceiving())},this)},j.prototype.isSending=function(){return this.audioOut||this.videoOut?!0:!1},j.prototype.getSendingStreams=function(){var a=[];return d.each(f,function(b){this[b+"Out"]&&a.push(b)},this),a},j.prototype.hold=function(){var a=[];return d.each(f,function(b){this[b+"In"]&&(a.push(b),this[b+"In"]=!1)},this),a},j.prototype.resume=function(a){d.each(f,function(b){a.indexOf(b)>=0&&(this[b+"In"]=!0)},this)},j.prototype.equals=function(a){return d.every(g,function(b){return this[b]===a[b]},this)},j.prototype.sendingStreamsEqual=function(a){return d.every(f,function(b){return this[b+"Out"]===a[b+"Out"]},this)},j.prototype.isSafeChange=function(a){return d.every(f,function(b){return!a[b+"Out"]||this[b+"Out"]},this)},b.exports=j}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./sdp":25}],28:[function(a,b){"use strict";var c=a("js-logger"),d=a("../../lib/jssip"),e=c.get("SDK:RTC:Util"),f={},g={string:String,"boolean":Boolean,number:Number,"function":Function};f.isType=function(a,b){if(-1===b.lastIndexOf("[]")){if(typeof a===b)return!0;if("object"==typeof a&&a instanceof g[b])return!0}else if(a instanceof Array){for(var c=b.slice(0,-2),d=0,e=a.length;e>d;d++)if(!f.isType(a[d],c))return!1;return!0}return!1},f.jsSipCauseToSdkStatus=function(a){switch(a){case d.C.causes.BUSY:return"normal";case d.C.causes.CONNECTION_ERROR:return"error";case d.C.causes.REQUEST_TIMEOUT:return"offline";case d.C.causes.REJECTED:return"blocked";case d.C.causes.NOT_FOUND:return"notfound";case d.C.causes.UNAVAILABLE:return"offline";default:return"normal"}};var h={options:{normal:200,blocked:403,notfound:404,offline:480},invite:{normal:486,blocked:403,notfound:404,offline:480}};f.sdkStatusToSipStatus=function(a,b){return h[a][b]},f.fireEvent=function(a,b,c,d){if(d||a.hasOwnProperty(b))try{e.log("Firing event "+a.constructor.name+"."+b+":",c),a[b](c)}catch(f){e.warn(a.constructor.name+"."+b+" handler threw exception:\n",f.stack)}else e.log("No handler registered for event "+a.constructor.name+"."+b+":",c)},b.exports=f},{"../../lib/jssip":1,"js-logger":3}]},{},[12])(12)});
//# sourceMappingURL=sdk.min.map
